!function(){const t=e=>{const r=e.parentElement;return r?"FORM"===r.tagName?r:t(r):null};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===e(r)?r:String(r)}function n(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const o=(t,e)=>e?`${e}-${t}`:t,i=(t,e)=>e?t.slice(e.length+1):t,a=(t,e,r)=>{const n=o(e,r),i=t.querySelector(`[name="${n}"]`);return i||null},s=(t,e)=>`${i(t,e)}-uploads`,l=(t,e,r)=>a(t,e,r)?.value;var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/*!
   * escape-html
   * Copyright(c) 2012-2013 TJ Holowaychuk
   * Copyright(c) 2015 Andreas Lubbe
   * Copyright(c) 2015 Tiancheng "Timothy" Gu
   * MIT Licensed
   */var p=/["'&<>]/,f=function(t){var e,r=""+t,n=p.exec(r);if(!n)return r;var o="",i=0,a=0;for(i=n.index;i<r.length;i++){switch(r.charCodeAt(i)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}a!==i&&(o+=r.substring(a,i)),a=i+1,o+=e}return a!==i?o+r.substring(a,i):o};var d=c(f);class h{constructor(t){let{parent:e,input:r,skipRequired:o,translations:i}=t;n(this,"container",void 0),n(this,"input",void 0),n(this,"translations",void 0),n(this,"errors",void 0),n(this,"createErrorContainer",(t=>{const e=document.createElement("div");return e.className="dff-invalid-files",t.appendChild(e),e})),n(this,"createFilesContainer",(t=>{const e=document.createElement("div");return e.className="dff-files",t.appendChild(e),e})),this.container=this.createFilesContainer(e),this.errors=this.createErrorContainer(e),this.input=r,this.translations=i,o&&(this.input.required=!1)}addNewUpload(t,e){const r=this.addFile(t,e),n=document.createElement("span");n.className="dff-progress";const o=document.createElement("span");o.className="dff-progress-inner",n.appendChild(o),r.appendChild(n);const i=document.createElement("a");return i.className="dff-cancel",i.innerHTML=this.translations.Cancel||"",i.setAttribute("data-index",`${e}`),i.href="#",r.appendChild(i),r}addUploadedFile(t,e,r){const n=this.addFile(t,e);return this.setSuccess(e,r),n}clearInput(){const{input:t}=this;t.value=""}deleteFile(t){const e=this.findFileDiv(t);e&&e.remove()}disableCancel(t){const e=this.findCancelSpan(t);e&&e.classList.add("dff-disabled")}disableDelete(t){const e=this.findDeleteLink(t);e&&e.classList.add("dff-disabled")}findFileDiv(t){return this.container.querySelector(`.dff-file-id-${t}`)}removeDropHint(){const t=this.container.querySelector(".dff-drop-hint");t&&t.remove()}renderDropHint(){if(this.container.querySelector(".dff-drop-hint"))return;const t=document.createElement("div");t.className="dff-drop-hint",t.innerHTML=this.translations["Drop your files here"]||"",this.container.appendChild(t)}setDeleteFailed(t){this.setErrorMessage(t,this.translations["Delete failed"]||""),this.enableDelete(t)}setError(t){this.setErrorMessage(t,this.translations["Upload failed"]||"");const e=this.findFileDiv(t);e&&e.classList.add("dff-upload-fail"),this.removeProgress(t),this.removeCancel(t)}setErrorInvalidFiles(t){const e=document.createElement("ul");for(const r of t){const t=document.createElement("li");t.innerText=`${r.name}: ${this.translations["Invalid file type"]}`,t.className="dff-error",e.appendChild(t)}this.errors.replaceChildren(e),this.clearInput()}setSuccess(t,e){const{translations:r}=this,n=this.findFileDiv(t);if(n){if(n.classList.add("dff-upload-success"),null!=e){const t=document.createElement("span");t.innerHTML=((t,e)=>{if(0===t)return"0 Bytes";const r=e<=0?0:e||2,n=Math.floor(Math.log(t)/Math.log(1024));return`${parseFloat((t/1024**n).toFixed(r))} ${["Bytes","KB","MB","GB"][n]}`})(e,2),t.className="dff-filesize",n.appendChild(t)}const o=document.createElement("a");o.innerHTML=r.Delete||"",o.className="dff-delete",o.setAttribute("data-index",`${t}`),o.href="#",n.appendChild(o)}this.removeProgress(t),this.removeCancel(t)}updateProgress(t,e){const r=this.container.querySelector(`.dff-file-id-${t}`);if(r){const t=r.querySelector(".dff-progress-inner");t&&(t.style.width=`${e}%`)}}addFile(t,e){const r=document.createElement("div");r.className=`dff-file dff-file-id-${e}`;const n=document.createElement("span");return n.innerHTML=d(t),n.className="dff-filename",n.setAttribute("data-index",`${e}`),r.appendChild(n),this.container.appendChild(r),this.input.required=!1,r}removeProgress(t){const e=this.findFileDiv(t);if(e){const t=e.querySelector(".dff-progress");t&&t.remove()}}removeCancel(t){const e=this.findCancelSpan(t);e&&e.remove()}findCancelSpan(t){const e=this.findFileDiv(t);return e?e.querySelector(".dff-cancel"):null}enableDelete(t){const e=this.findDeleteLink(t);e&&e.classList.remove("dff-disabled")}findDeleteLink(t){const e=this.findFileDiv(t);return e?e.querySelector(".dff-delete"):e}setErrorMessage(t,e){const r=this.findFileDiv(t);if(!r)return;const n=r.querySelector(".dff-error");n&&n.remove();const o=document.createElement("span");o.classList.add("dff-error"),o.innerHTML=e,r.appendChild(o)}}function m(){this._types=Object.create(null),this._extensions=Object.create(null);for(let t=0;t<arguments.length;t++)this.define(arguments[t]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}m.prototype.define=function(t,e){for(let r in t){let n=t[r].map((function(t){return t.toLowerCase()}));r=r.toLowerCase();for(let t=0;t<n.length;t++){const o=n[t];if("*"!==o[0]){if(!e&&o in this._types)throw new Error('Attempt to change mapping for "'+o+'" extension from "'+this._types[o]+'" to "'+r+'". Pass `force=true` to allow this, otherwise remove "'+o+'" from the list of extensions for "'+r+'".');this._types[o]=r}}if(e||!this._extensions[r]){const t=n[0];this._extensions[r]="*"!==t[0]?t:t.substr(1)}}},m.prototype.getType=function(t){let e=(t=String(t)).replace(/^.*[/\\]/,"").toLowerCase(),r=e.replace(/^.*\./,"").toLowerCase(),n=e.length<t.length;return(r.length<e.length-1||!n)&&this._types[r]||null},m.prototype.getExtension=function(t){return(t=/^\s*([^;\s]*)/.test(t)&&RegExp.$1)&&this._extensions[t.toLowerCase()]||null};var y=c(new m({"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]})),v=function(t){return t&&t.Math===Math&&t},g=v("object"==typeof globalThis&&globalThis)||v("object"==typeof window&&window)||v("object"==typeof self&&self)||v("object"==typeof u&&u)||function(){return this}()||u||Function("return this")(),b=function(t){try{return!!t()}catch(t){return!0}},x=!b((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),_={exports:{}},w=!b((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),S=w,E=Function.prototype,k=E.call,R=S&&E.bind.bind(k,k),A=S?R:function(t){return function(){return k.apply(t,arguments)}},C="object"==typeof document&&document.all,O={all:C,IS_HTMLDDA:void 0===C&&void 0!==C},T=O.all,j=O.IS_HTMLDDA?function(t){return"function"==typeof t||t===T}:function(t){return"function"==typeof t},P=function(t){return null==t},U=P,L=TypeError,I=function(t){if(U(t))throw L("Can't call method on "+t);return t},H=Object,D=function(t){return H(I(t))},$=A({}.hasOwnProperty),N=Object.hasOwn||function(t,e){return $(D(t),e)},F=x,z=N,q=Function.prototype,M=F&&Object.getOwnPropertyDescriptor,B=z(q,"name"),G={EXISTS:B,PROPER:B&&"something"===function(){}.name,CONFIGURABLE:B&&(!F||F&&M(q,"name").configurable)},K=g,X=Object.defineProperty,Q=function(t,e){try{X(K,t,{value:e,configurable:!0,writable:!0})}catch(r){K[t]=e}return e},W="__core-js_shared__",Y=g[W]||Q(W,{}),Z=j,J=Y,V=A(Function.toString);Z(J.inspectSource)||(J.inspectSource=function(t){return V(t)});var tt,et,rt=J.inspectSource,nt=j,ot=g.WeakMap,it=nt(ot)&&/native code/.test(String(ot)),at=j,st=O.all,lt=O.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:at(t)||t===st}:function(t){return"object"==typeof t?null!==t:at(t)},ut={},ct=lt,pt=g.document,ft=ct(pt)&&ct(pt.createElement),dt=function(t){return ft?pt.createElement(t):{}},ht=!x&&!b((function(){return 7!==Object.defineProperty(dt("div"),"a",{get:function(){return 7}}).a})),mt=x&&b((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),yt=lt,vt=String,gt=TypeError,bt=function(t){if(yt(t))return t;throw gt(vt(t)+" is not an object")},xt=w,_t=Function.prototype.call,wt=xt?_t.bind(_t):function(){return _t.apply(_t,arguments)},St=g,Et=j,kt=A({}.isPrototypeOf),Rt=g,At="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Ct=Rt.process,Ot=Rt.Deno,Tt=Ct&&Ct.versions||Ot&&Ot.version,jt=Tt&&Tt.v8;jt&&(et=(tt=jt.split("."))[0]>0&&tt[0]<4?1:+(tt[0]+tt[1])),!et&&At&&(!(tt=At.match(/Edge\/(\d+)/))||tt[1]>=74)&&(tt=At.match(/Chrome\/(\d+)/))&&(et=+tt[1]);var Pt=et,Ut=b,Lt=g.String,It=!!Object.getOwnPropertySymbols&&!Ut((function(){var t=Symbol("symbol detection");return!Lt(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Pt&&Pt<41})),Ht=It&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Dt=function(t,e){return arguments.length<2?(r=St[t],Et(r)?r:void 0):St[t]&&St[t][e];var r},$t=j,Nt=kt,Ft=Object,zt=Ht?function(t){return"symbol"==typeof t}:function(t){var e=Dt("Symbol");return $t(e)&&Nt(e.prototype,Ft(t))},qt=String,Mt=j,Bt=function(t){try{return qt(t)}catch(t){return"Object"}},Gt=TypeError,Kt=function(t){if(Mt(t))return t;throw Gt(Bt(t)+" is not a function")},Xt=P,Qt=wt,Wt=j,Yt=lt,Zt=TypeError,Jt={exports:{}},Vt=Y;(Jt.exports=function(t,e){return Vt[t]||(Vt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.32.1",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.1/LICENSE",source:"https://github.com/zloirock/core-js"});var te=Jt.exports,ee=A,re=0,ne=Math.random(),oe=ee(1..toString),ie=function(t){return"Symbol("+(void 0===t?"":t)+")_"+oe(++re+ne,36)},ae=te,se=N,le=ie,ue=It,ce=Ht,pe=g.Symbol,fe=ae("wks"),de=ce?pe.for||pe:pe&&pe.withoutSetter||le,he=wt,me=lt,ye=zt,ve=function(t,e){var r=t[e];return Xt(r)?void 0:Kt(r)},ge=function(t,e){var r,n;if("string"===e&&Wt(r=t.toString)&&!Yt(n=Qt(r,t)))return n;if(Wt(r=t.valueOf)&&!Yt(n=Qt(r,t)))return n;if("string"!==e&&Wt(r=t.toString)&&!Yt(n=Qt(r,t)))return n;throw Zt("Can't convert object to primitive value")},be=TypeError,xe=function(t){return se(fe,t)||(fe[t]=ue&&se(pe,t)?pe[t]:de("Symbol."+t)),fe[t]}("toPrimitive"),_e=function(t,e){if(!me(t)||ye(t))return t;var r,n=ve(t,xe);if(n){if(void 0===e&&(e="default"),r=he(n,t,e),!me(r)||ye(r))return r;throw be("Can't convert object to primitive value")}return void 0===e&&(e="number"),ge(t,e)},we=zt,Se=x,Ee=ht,ke=mt,Re=bt,Ae=function(t){var e=_e(t,"string");return we(e)?e:e+""},Ce=TypeError,Oe=Object.defineProperty,Te=Object.getOwnPropertyDescriptor,je="enumerable",Pe="configurable",Ue="writable";ut.f=Se?ke?function(t,e,r){if(Re(t),e=Ae(e),Re(r),"function"==typeof t&&"prototype"===e&&"value"in r&&Ue in r&&!r[Ue]){var n=Te(t,e);n&&n[Ue]&&(t[e]=r.value,r={configurable:Pe in r?r[Pe]:n[Pe],enumerable:je in r?r[je]:n[je],writable:!1})}return Oe(t,e,r)}:Oe:function(t,e,r){if(Re(t),e=Ae(e),Re(r),Ee)try{return Oe(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Ce("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var Le,Ie,He,De=ut,$e=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Ne=x?function(t,e,r){return De.f(t,e,$e(1,r))}:function(t,e,r){return t[e]=r,t},Fe=ie,ze=te("keys"),qe=it,Me=g,Be=lt,Ge=Ne,Ke=N,Xe=Y,Qe=function(t){return ze[t]||(ze[t]=Fe(t))},We={},Ye="Object already initialized",Ze=Me.TypeError,Je=Me.WeakMap;if(qe||Xe.state){var Ve=Xe.state||(Xe.state=new Je);Ve.get=Ve.get,Ve.has=Ve.has,Ve.set=Ve.set,Le=function(t,e){if(Ve.has(t))throw Ze(Ye);return e.facade=t,Ve.set(t,e),e},Ie=function(t){return Ve.get(t)||{}},He=function(t){return Ve.has(t)}}else{var tr=Qe("state");We[tr]=!0,Le=function(t,e){if(Ke(t,tr))throw Ze(Ye);return e.facade=t,Ge(t,tr,e),e},Ie=function(t){return Ke(t,tr)?t[tr]:{}},He=function(t){return Ke(t,tr)}}var er={set:Le,get:Ie,has:He,enforce:function(t){return He(t)?Ie(t):Le(t,{})},getterFor:function(t){return function(e){var r;if(!Be(e)||(r=Ie(e)).type!==t)throw Ze("Incompatible receiver, "+t+" required");return r}}},rr=A,nr=b,or=j,ir=N,ar=x,sr=G.CONFIGURABLE,lr=rt,ur=er.enforce,cr=er.get,pr=String,fr=Object.defineProperty,dr=rr("".slice),hr=rr("".replace),mr=rr([].join),yr=ar&&!nr((function(){return 8!==fr((function(){}),"length",{value:8}).length})),vr=String(String).split("String"),gr=_.exports=function(t,e,r){"Symbol("===dr(pr(e),0,7)&&(e="["+hr(pr(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(e="get "+e),r&&r.setter&&(e="set "+e),(!ir(t,"name")||sr&&t.name!==e)&&(ar?fr(t,"name",{value:e,configurable:!0}):t.name=e),yr&&r&&ir(r,"arity")&&t.length!==r.arity&&fr(t,"length",{value:r.arity});try{r&&ir(r,"constructor")&&r.constructor?ar&&fr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var n=ur(t);return ir(n,"source")||(n.source=mr(vr,"string"==typeof e?e:"")),t};Function.prototype.toString=gr((function(){return or(this)&&cr(this).source||lr(this)}),"toString");var br=_.exports,xr=ut,_r=bt,wr=x,Sr=function(t,e,r){return r.get&&br(r.get,e,{getter:!0}),r.set&&br(r.set,e,{setter:!0}),xr.f(t,e,r)},Er=function(){var t=_r(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},kr=b,Rr=g.RegExp,Ar=Rr.prototype,Cr=wr&&kr((function(){var t=!0;try{Rr(".","d")}catch(e){t=!1}var e={},r="",n=t?"dgimsy":"gimsy",o=function(t,n){Object.defineProperty(e,t,{get:function(){return r+=n,!0}})},i={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in t&&(i.hasIndices="d"),i)o(a,i[a]);return Object.getOwnPropertyDescriptor(Ar,"flags").get.call(e)!==n||r!==n}));Cr&&Sr(Ar,"flags",{configurable:!0,get:Er});var Or={basename:t=>{var e,r=0,n=-1,o=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!o){r=e+1;break}}else-1===n&&(o=!1,n=e+1);return-1===n?"":t.slice(r,n)}},Tr={};const jr="\\\\/",Pr=`[^${jr}]`,Ur="\\.",Lr="\\/",Ir="[^/]",Hr=`(?:${Lr}|$)`,Dr=`(?:^|${Lr})`,$r=`${Ur}{1,2}${Hr}`,Nr={DOT_LITERAL:Ur,PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:Lr,ONE_CHAR:"(?=.)",QMARK:Ir,END_ANCHOR:Hr,DOTS_SLASH:$r,NO_DOT:`(?!${Ur})`,NO_DOTS:`(?!${Dr}${$r})`,NO_DOT_SLASH:`(?!${Ur}{0,1}${Hr})`,NO_DOTS_SLASH:`(?!${$r})`,QMARK_NO_DOT:`[^.${Lr}]`,STAR:`${Ir}*?`,START_ANCHOR:Dr},Fr={...Nr,SLASH_LITERAL:`[${jr}]`,QMARK:Pr,STAR:`${Pr}*?`,DOTS_SLASH:`${Ur}{1,2}(?:[${jr}]|$)`,NO_DOT:`(?!${Ur})`,NO_DOTS:`(?!(?:^|[${jr}])${Ur}{1,2}(?:[${jr}]|$))`,NO_DOT_SLASH:`(?!${Ur}{0,1}(?:[${jr}]|$))`,NO_DOTS_SLASH:`(?!${Ur}{1,2}(?:[${jr}]|$))`,QMARK_NO_DOT:`[^.${jr}]`,START_ANCHOR:`(?:^|[${jr}])`,END_ANCHOR:`(?:[${jr}]|$)`};var zr={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:"/",extglobChars:t=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${t.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars(){return!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])?Fr:Nr}};!function(t){const{REGEX_BACKSLASH:e,REGEX_REMOVE_BACKSLASH:r,REGEX_SPECIAL_CHARS:n,REGEX_SPECIAL_CHARS_GLOBAL:o}=zr;t.isObject=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),t.hasRegexChars=t=>n.test(t),t.isRegexChar=e=>1===e.length&&t.hasRegexChars(e),t.escapeRegex=t=>t.replace(o,"\\$1"),t.toPosixSlashes=t=>t.replace(e,"/"),t.removeBackslashes=t=>t.replace(r,(t=>"\\"===t?"":t)),t.isWindows=t=>!(!t||"boolean"!=typeof t.windows)&&t.windows,t.escapeLast=(e,r,n)=>{const o=e.lastIndexOf(r,n);return-1===o?e:"\\"===e[o-1]?t.escapeLast(e,r,o-1):`${e.slice(0,o)}\\${e.slice(o)}`},t.removePrefix=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t;return r.startsWith("./")&&(r=r.slice(2),e.prefix="./"),r},t.wrapOutput=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let n=`${r.contains?"":"^"}(?:${t})${r.contains?"":"$"}`;return!0===e.negated&&(n=`(?:^(?!${n}).*$)`),n}}(Tr);const qr=Tr,{CHAR_ASTERISK:Mr,CHAR_AT:Br,CHAR_BACKWARD_SLASH:Gr,CHAR_COMMA:Kr,CHAR_DOT:Xr,CHAR_EXCLAMATION_MARK:Qr,CHAR_FORWARD_SLASH:Wr,CHAR_LEFT_CURLY_BRACE:Yr,CHAR_LEFT_PARENTHESES:Zr,CHAR_LEFT_SQUARE_BRACKET:Jr,CHAR_PLUS:Vr,CHAR_QUESTION_MARK:tn,CHAR_RIGHT_CURLY_BRACE:en,CHAR_RIGHT_PARENTHESES:rn,CHAR_RIGHT_SQUARE_BRACKET:nn}=zr,on=t=>t===Wr||t===Gr,an=t=>{!0!==t.isPrefix&&(t.depth=t.isGlobstar?1/0:1)};var sn=(t,e)=>{const r=e||{},n=t.length-1,o=!0===r.parts||!0===r.scanToEnd,i=[],a=[],s=[];let l,u,c=t,p=-1,f=0,d=0,h=!1,m=!1,y=!1,v=!1,g=!1,b=!1,x=!1,_=!1,w=!1,S=!1,E=0,k={value:"",depth:0,isGlob:!1};const R=()=>p>=n,A=()=>(l=u,c.charCodeAt(++p));for(;p<n;){let t;if(u=A(),u!==Gr){if(!0===b||u===Yr){for(E++;!0!==R()&&(u=A());)if(u!==Gr)if(u!==Yr){if(!0!==b&&u===Xr&&(u=A())===Xr){if(h=k.isBrace=!0,y=k.isGlob=!0,S=!0,!0===o)continue;break}if(!0!==b&&u===Kr){if(h=k.isBrace=!0,y=k.isGlob=!0,S=!0,!0===o)continue;break}if(u===en&&(E--,0===E)){b=!1,h=k.isBrace=!0,S=!0;break}}else E++;else x=k.backslashes=!0,A();if(!0===o)continue;break}if(u!==Wr){if(!0!==r.noext){if(!0===(u===Vr||u===Br||u===Mr||u===tn||u===Qr)&&c.charCodeAt(p+1)===Zr){if(y=k.isGlob=!0,v=k.isExtglob=!0,S=!0,u===Qr&&p===f&&(w=!0),!0===o){for(;!0!==R()&&(u=A());)if(u!==Gr){if(u===rn){y=k.isGlob=!0,S=!0;break}}else x=k.backslashes=!0,u=A();continue}break}}if(u===Mr){if(l===Mr&&(g=k.isGlobstar=!0),y=k.isGlob=!0,S=!0,!0===o)continue;break}if(u===tn){if(y=k.isGlob=!0,S=!0,!0===o)continue;break}if(u===Jr){for(;!0!==R()&&(t=A());)if(t!==Gr){if(t===nn){m=k.isBracket=!0,y=k.isGlob=!0,S=!0;break}}else x=k.backslashes=!0,A();if(!0===o)continue;break}if(!0===r.nonegate||u!==Qr||p!==f){if(!0!==r.noparen&&u===Zr){if(y=k.isGlob=!0,!0===o){for(;!0!==R()&&(u=A());)if(u!==Zr){if(u===rn){S=!0;break}}else x=k.backslashes=!0,u=A();continue}break}if(!0===y){if(S=!0,!0===o)continue;break}}else _=k.negated=!0,f++}else{if(i.push(p),a.push(k),k={value:"",depth:0,isGlob:!1},!0===S)continue;if(l===Xr&&p===f+1){f+=2;continue}d=p+1}}else x=k.backslashes=!0,u=A(),u===Yr&&(b=!0)}!0===r.noext&&(v=!1,y=!1);let C=c,O="",T="";f>0&&(O=c.slice(0,f),c=c.slice(f),d-=f),C&&!0===y&&d>0?(C=c.slice(0,d),T=c.slice(d)):!0===y?(C="",T=c):C=c,C&&""!==C&&"/"!==C&&C!==c&&on(C.charCodeAt(C.length-1))&&(C=C.slice(0,-1)),!0===r.unescape&&(T&&(T=qr.removeBackslashes(T)),C&&!0===x&&(C=qr.removeBackslashes(C)));const j={prefix:O,input:t,start:f,base:C,glob:T,isBrace:h,isBracket:m,isGlob:y,isExtglob:v,isGlobstar:g,negated:_,negatedExtglob:w};if(!0===r.tokens&&(j.maxDepth=0,on(u)||a.push(k),j.tokens=a),!0===r.parts||!0===r.tokens){let e;for(let n=0;n<i.length;n++){const o=e?e+1:f,l=i[n],u=t.slice(o,l);r.tokens&&(0===n&&0!==f?(a[n].isPrefix=!0,a[n].value=O):a[n].value=u,an(a[n]),j.maxDepth+=a[n].depth),0===n&&""===u||s.push(u),e=l}if(e&&e+1<t.length){const n=t.slice(e+1);s.push(n),r.tokens&&(a[a.length-1].value=n,an(a[a.length-1]),j.maxDepth+=a[a.length-1].depth)}j.slashes=i,j.parts=s}return j};const ln=zr,un=Tr,{MAX_LENGTH:cn,POSIX_REGEX_SOURCE:pn,REGEX_NON_SPECIAL_CHARS:fn,REGEX_SPECIAL_CHARS_BACKREF:dn,REPLACEMENTS:hn}=ln,mn=(t,e)=>{if("function"==typeof e.expandRange)return e.expandRange(...t,e);t.sort();const r=`[${t.join("-")}]`;try{new RegExp(r)}catch(e){return t.map((t=>un.escapeRegex(t))).join("..")}return r},yn=(t,e)=>`Missing ${t}: "${e}" - use "\\\\${e}" to match literal characters`,vn=(t,e)=>{if("string"!=typeof t)throw new TypeError("Expected a string");t=hn[t]||t;const r={...e},n="number"==typeof r.maxLength?Math.min(cn,r.maxLength):cn;let o=t.length;if(o>n)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${n}`);const i={type:"bos",value:"",output:r.prepend||""},a=[i],s=r.capture?"":"?:",l=ln.globChars(),u=ln.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:p,SLASH_LITERAL:f,ONE_CHAR:d,DOTS_SLASH:h,NO_DOT:m,NO_DOT_SLASH:y,NO_DOTS_SLASH:v,QMARK:g,QMARK_NO_DOT:b,STAR:x,START_ANCHOR:_}=l,w=t=>`(${s}(?:(?!${_}${t.dot?h:c}).)*?)`,S=r.dot?"":m,E=r.dot?g:b;let k=!0===r.bash?w(r):x;r.capture&&(k=`(${k})`),"boolean"==typeof r.noext&&(r.noextglob=r.noext);const R={input:t,index:-1,start:0,dot:!0===r.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};t=un.removePrefix(t,R),o=t.length;const A=[],C=[],O=[];let T,j=i;const P=()=>R.index===o-1,U=R.peek=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return t[R.index+e]},L=R.advance=()=>t[++R.index]||"",I=()=>t.slice(R.index+1),H=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;R.consumed+=t,R.index+=e},D=t=>{R.output+=null!=t.output?t.output:t.value,H(t.value)},$=()=>{let t=1;for(;"!"===U()&&("("!==U(2)||"?"===U(3));)L(),R.start++,t++;return t%2!=0&&(R.negated=!0,R.start++,!0)},N=t=>{R[t]++,O.push(t)},F=t=>{R[t]--,O.pop()},z=t=>{if("globstar"===j.type){const e=R.braces>0&&("comma"===t.type||"brace"===t.type),r=!0===t.extglob||A.length&&("pipe"===t.type||"paren"===t.type);"slash"===t.type||"paren"===t.type||e||r||(R.output=R.output.slice(0,-j.output.length),j.type="star",j.value="*",j.output=k,R.output+=j.output)}if(A.length&&"paren"!==t.type&&(A[A.length-1].inner+=t.value),(t.value||t.output)&&D(t),j&&"text"===j.type&&"text"===t.type)return j.value+=t.value,void(j.output=(j.output||"")+t.value);t.prev=j,a.push(t),j=t},q=(t,e)=>{const n={...u[e],conditions:1,inner:""};n.prev=j,n.parens=R.parens,n.output=R.output;const o=(r.capture?"(":"")+n.open;N("parens"),z({type:t,value:e,output:R.output?"":d}),z({type:"paren",extglob:!0,value:L(),output:o}),A.push(n)},M=t=>{let n,o=t.close+(r.capture?")":"");if("negate"===t.type){let i=k;if(t.inner&&t.inner.length>1&&t.inner.includes("/")&&(i=w(r)),(i!==k||P()||/^\)+$/.test(I()))&&(o=t.close=`)$))${i}`),t.inner.includes("*")&&(n=I())&&/^\.[^\\/.]+$/.test(n)){const r=vn(n,{...e,fastpaths:!1}).output;o=t.close=`)${r})${i})`}"bos"===t.prev.type&&(R.negatedExtglob=!0)}z({type:"paren",extglob:!0,value:T,output:o}),F("parens")};if(!1!==r.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(t)){let n=!1,o=t.replace(dn,((t,e,r,o,i,a)=>"\\"===o?(n=!0,t):"?"===o?e?e+o+(i?g.repeat(i.length):""):0===a?E+(i?g.repeat(i.length):""):g.repeat(r.length):"."===o?c.repeat(r.length):"*"===o?e?e+o+(i?k:""):k:e?t:`\\${t}`));return!0===n&&(o=!0===r.unescape?o.replace(/\\/g,""):o.replace(/\\+/g,(t=>t.length%2==0?"\\\\":t?"\\":""))),o===t&&!0===r.contains?(R.output=t,R):(R.output=un.wrapOutput(o,R,e),R)}for(;!P();){if(T=L(),"\0"===T)continue;if("\\"===T){const t=U();if("/"===t&&!0!==r.bash)continue;if("."===t||";"===t)continue;if(!t){T+="\\",z({type:"text",value:T});continue}const e=/^\\+/.exec(I());let n=0;if(e&&e[0].length>2&&(n=e[0].length,R.index+=n,n%2!=0&&(T+="\\")),!0===r.unescape?T=L():T+=L(),0===R.brackets){z({type:"text",value:T});continue}}if(R.brackets>0&&("]"!==T||"["===j.value||"[^"===j.value)){if(!1!==r.posix&&":"===T){const t=j.value.slice(1);if(t.includes("[")&&(j.posix=!0,t.includes(":"))){const t=j.value.lastIndexOf("["),e=j.value.slice(0,t),r=j.value.slice(t+2),n=pn[r];if(n){j.value=e+n,R.backtrack=!0,L(),i.output||1!==a.indexOf(j)||(i.output=d);continue}}}("["===T&&":"!==U()||"-"===T&&"]"===U())&&(T=`\\${T}`),"]"!==T||"["!==j.value&&"[^"!==j.value||(T=`\\${T}`),!0===r.posix&&"!"===T&&"["===j.value&&(T="^"),j.value+=T,D({value:T});continue}if(1===R.quotes&&'"'!==T){T=un.escapeRegex(T),j.value+=T,D({value:T});continue}if('"'===T){R.quotes=1===R.quotes?0:1,!0===r.keepQuotes&&z({type:"text",value:T});continue}if("("===T){N("parens"),z({type:"paren",value:T});continue}if(")"===T){if(0===R.parens&&!0===r.strictBrackets)throw new SyntaxError(yn("opening","("));const t=A[A.length-1];if(t&&R.parens===t.parens+1){M(A.pop());continue}z({type:"paren",value:T,output:R.parens?")":"\\)"}),F("parens");continue}if("["===T){if(!0!==r.nobracket&&I().includes("]"))N("brackets");else{if(!0!==r.nobracket&&!0===r.strictBrackets)throw new SyntaxError(yn("closing","]"));T=`\\${T}`}z({type:"bracket",value:T});continue}if("]"===T){if(!0===r.nobracket||j&&"bracket"===j.type&&1===j.value.length){z({type:"text",value:T,output:`\\${T}`});continue}if(0===R.brackets){if(!0===r.strictBrackets)throw new SyntaxError(yn("opening","["));z({type:"text",value:T,output:`\\${T}`});continue}F("brackets");const t=j.value.slice(1);if(!0===j.posix||"^"!==t[0]||t.includes("/")||(T=`/${T}`),j.value+=T,D({value:T}),!1===r.literalBrackets||un.hasRegexChars(t))continue;const e=un.escapeRegex(j.value);if(R.output=R.output.slice(0,-j.value.length),!0===r.literalBrackets){R.output+=e,j.value=e;continue}j.value=`(${s}${e}|${j.value})`,R.output+=j.value;continue}if("{"===T&&!0!==r.nobrace){N("braces");const t={type:"brace",value:T,output:"(",outputIndex:R.output.length,tokensIndex:R.tokens.length};C.push(t),z(t);continue}if("}"===T){const t=C[C.length-1];if(!0===r.nobrace||!t){z({type:"text",value:T,output:T});continue}let e=")";if(!0===t.dots){const t=a.slice(),n=[];for(let e=t.length-1;e>=0&&(a.pop(),"brace"!==t[e].type);e--)"dots"!==t[e].type&&n.unshift(t[e].value);e=mn(n,r),R.backtrack=!0}if(!0!==t.comma&&!0!==t.dots){const r=R.output.slice(0,t.outputIndex),n=R.tokens.slice(t.tokensIndex);t.value=t.output="\\{",T=e="\\}",R.output=r;for(const t of n)R.output+=t.output||t.value}z({type:"brace",value:T,output:e}),F("braces"),C.pop();continue}if("|"===T){A.length>0&&A[A.length-1].conditions++,z({type:"text",value:T});continue}if(","===T){let t=T;const e=C[C.length-1];e&&"braces"===O[O.length-1]&&(e.comma=!0,t="|"),z({type:"comma",value:T,output:t});continue}if("/"===T){if("dot"===j.type&&R.index===R.start+1){R.start=R.index+1,R.consumed="",R.output="",a.pop(),j=i;continue}z({type:"slash",value:T,output:f});continue}if("."===T){if(R.braces>0&&"dot"===j.type){"."===j.value&&(j.output=c);const t=C[C.length-1];j.type="dots",j.output+=T,j.value+=T,t.dots=!0;continue}if(R.braces+R.parens===0&&"bos"!==j.type&&"slash"!==j.type){z({type:"text",value:T,output:c});continue}z({type:"dot",value:T,output:c});continue}if("?"===T){if(!(j&&"("===j.value)&&!0!==r.noextglob&&"("===U()&&"?"!==U(2)){q("qmark",T);continue}if(j&&"paren"===j.type){const t=U();let e=T;("("===j.value&&!/[!=<:]/.test(t)||"<"===t&&!/<([!=]|\w+>)/.test(I()))&&(e=`\\${T}`),z({type:"text",value:T,output:e});continue}if(!0!==r.dot&&("slash"===j.type||"bos"===j.type)){z({type:"qmark",value:T,output:b});continue}z({type:"qmark",value:T,output:g});continue}if("!"===T){if(!0!==r.noextglob&&"("===U()&&("?"!==U(2)||!/[!=<:]/.test(U(3)))){q("negate",T);continue}if(!0!==r.nonegate&&0===R.index){$();continue}}if("+"===T){if(!0!==r.noextglob&&"("===U()&&"?"!==U(2)){q("plus",T);continue}if(j&&"("===j.value||!1===r.regex){z({type:"plus",value:T,output:p});continue}if(j&&("bracket"===j.type||"paren"===j.type||"brace"===j.type)||R.parens>0){z({type:"plus",value:T});continue}z({type:"plus",value:p});continue}if("@"===T){if(!0!==r.noextglob&&"("===U()&&"?"!==U(2)){z({type:"at",extglob:!0,value:T,output:""});continue}z({type:"text",value:T});continue}if("*"!==T){"$"!==T&&"^"!==T||(T=`\\${T}`);const t=fn.exec(I());t&&(T+=t[0],R.index+=t[0].length),z({type:"text",value:T});continue}if(j&&("globstar"===j.type||!0===j.star)){j.type="star",j.star=!0,j.value+=T,j.output=k,R.backtrack=!0,R.globstar=!0,H(T);continue}let e=I();if(!0!==r.noextglob&&/^\([^?]/.test(e)){q("star",T);continue}if("star"===j.type){if(!0===r.noglobstar){H(T);continue}const n=j.prev,o=n.prev,i="slash"===n.type||"bos"===n.type,a=o&&("star"===o.type||"globstar"===o.type);if(!0===r.bash&&(!i||e[0]&&"/"!==e[0])){z({type:"star",value:T,output:""});continue}const s=R.braces>0&&("comma"===n.type||"brace"===n.type),l=A.length&&("pipe"===n.type||"paren"===n.type);if(!i&&"paren"!==n.type&&!s&&!l){z({type:"star",value:T,output:""});continue}for(;"/**"===e.slice(0,3);){const r=t[R.index+4];if(r&&"/"!==r)break;e=e.slice(3),H("/**",3)}if("bos"===n.type&&P()){j.type="globstar",j.value+=T,j.output=w(r),R.output=j.output,R.globstar=!0,H(T);continue}if("slash"===n.type&&"bos"!==n.prev.type&&!a&&P()){R.output=R.output.slice(0,-(n.output+j.output).length),n.output=`(?:${n.output}`,j.type="globstar",j.output=w(r)+(r.strictSlashes?")":"|$)"),j.value+=T,R.globstar=!0,R.output+=n.output+j.output,H(T);continue}if("slash"===n.type&&"bos"!==n.prev.type&&"/"===e[0]){const t=void 0!==e[1]?"|$":"";R.output=R.output.slice(0,-(n.output+j.output).length),n.output=`(?:${n.output}`,j.type="globstar",j.output=`${w(r)}${f}|${f}${t})`,j.value+=T,R.output+=n.output+j.output,R.globstar=!0,H(T+L()),z({type:"slash",value:"/",output:""});continue}if("bos"===n.type&&"/"===e[0]){j.type="globstar",j.value+=T,j.output=`(?:^|${f}|${w(r)}${f})`,R.output=j.output,R.globstar=!0,H(T+L()),z({type:"slash",value:"/",output:""});continue}R.output=R.output.slice(0,-j.output.length),j.type="globstar",j.output=w(r),j.value+=T,R.output+=j.output,R.globstar=!0,H(T);continue}const n={type:"star",value:T,output:k};!0!==r.bash?!j||"bracket"!==j.type&&"paren"!==j.type||!0!==r.regex?(R.index!==R.start&&"slash"!==j.type&&"dot"!==j.type||("dot"===j.type?(R.output+=y,j.output+=y):!0===r.dot?(R.output+=v,j.output+=v):(R.output+=S,j.output+=S),"*"!==U()&&(R.output+=d,j.output+=d)),z(n)):(n.output=T,z(n)):(n.output=".*?","bos"!==j.type&&"slash"!==j.type||(n.output=S+n.output),z(n))}for(;R.brackets>0;){if(!0===r.strictBrackets)throw new SyntaxError(yn("closing","]"));R.output=un.escapeLast(R.output,"["),F("brackets")}for(;R.parens>0;){if(!0===r.strictBrackets)throw new SyntaxError(yn("closing",")"));R.output=un.escapeLast(R.output,"("),F("parens")}for(;R.braces>0;){if(!0===r.strictBrackets)throw new SyntaxError(yn("closing","}"));R.output=un.escapeLast(R.output,"{"),F("braces")}if(!0===r.strictSlashes||"star"!==j.type&&"bracket"!==j.type||z({type:"maybe_slash",value:"",output:`${f}?`}),!0===R.backtrack){R.output="";for(const t of R.tokens)R.output+=null!=t.output?t.output:t.value,t.suffix&&(R.output+=t.suffix)}return R};vn.fastpaths=(t,e)=>{const r={...e},n="number"==typeof r.maxLength?Math.min(cn,r.maxLength):cn,o=t.length;if(o>n)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${n}`);t=hn[t]||t;const{DOT_LITERAL:i,SLASH_LITERAL:a,ONE_CHAR:s,DOTS_SLASH:l,NO_DOT:u,NO_DOTS:c,NO_DOTS_SLASH:p,STAR:f,START_ANCHOR:d}=ln.globChars(),h=r.dot?c:u,m=r.dot?p:u,y=r.capture?"":"?:";let v=!0===r.bash?".*?":f;r.capture&&(v=`(${v})`);const g=t=>!0===t.noglobstar?v:`(${y}(?:(?!${d}${t.dot?l:i}).)*?)`,b=t=>{switch(t){case"*":return`${h}${s}${v}`;case".*":return`${i}${s}${v}`;case"*.*":return`${h}${v}${i}${s}${v}`;case"*/*":return`${h}${v}${a}${s}${m}${v}`;case"**":return h+g(r);case"**/*":return`(?:${h}${g(r)}${a})?${m}${s}${v}`;case"**/*.*":return`(?:${h}${g(r)}${a})?${m}${v}${i}${s}${v}`;case"**/.*":return`(?:${h}${g(r)}${a})?${i}${s}${v}`;default:{const e=/^(.*?)\.(\w+)$/.exec(t);if(!e)return;const r=b(e[1]);if(!r)return;return r+i+e[2]}}},x=un.removePrefix(t,{negated:!1,prefix:""});let _=b(x);return _&&!0!==r.strictSlashes&&(_+=`${a}?`),_};const gn=Or,bn=sn,xn=vn,_n=Tr,wn=zr,Sn=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t)){const n=t.map((t=>Sn(t,e,r))),o=t=>{for(const e of n){const r=e(t);if(r)return r}return!1};return o}const n=(o=t)&&"object"==typeof o&&!Array.isArray(o)&&t.tokens&&t.input;var o;if(""===t||"string"!=typeof t&&!n)throw new TypeError("Expected pattern to be a non-empty string");const i=e||{},a=_n.isWindows(e),s=n?Sn.compileRe(t,e):Sn.makeRe(t,e,!1,!0),l=s.state;delete s.state;let u=()=>!1;if(i.ignore){const t={...e,ignore:null,onMatch:null,onResult:null};u=Sn(i.ignore,t,r)}const c=function(r){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{isMatch:o,match:c,output:p}=Sn.test(r,s,e,{glob:t,posix:a}),f={glob:t,state:l,regex:s,posix:a,input:r,output:p,match:c,isMatch:o};return"function"==typeof i.onResult&&i.onResult(f),!1===o?(f.isMatch=!1,!!n&&f):u(r)?("function"==typeof i.onIgnore&&i.onIgnore(f),f.isMatch=!1,!!n&&f):("function"==typeof i.onMatch&&i.onMatch(f),!n||f)};return r&&(c.state=l),c};Sn.test=function(t,e,r){let{glob:n,posix:o}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof t)throw new TypeError("Expected input to be a string");if(""===t)return{isMatch:!1,output:""};const i=r||{},a=i.format||(o?_n.toPosixSlashes:null);let s=t===n,l=s&&a?a(t):t;return!1===s&&(l=a?a(t):t,s=l===n),!1!==s&&!0!==i.capture||(s=!0===i.matchBase||!0===i.basename?Sn.matchBase(t,e,r,o):e.exec(l)),{isMatch:Boolean(s),match:s,output:l}},Sn.matchBase=function(t,e,r){arguments.length>3&&void 0!==arguments[3]||_n.isWindows(r);return(e instanceof RegExp?e:Sn.makeRe(e,r)).test(gn.basename(t))},Sn.isMatch=(t,e,r)=>Sn(e,r)(t),Sn.parse=(t,e)=>Array.isArray(t)?t.map((t=>Sn.parse(t,e))):xn(t,{...e,fastpaths:!1}),Sn.scan=(t,e)=>bn(t,e),Sn.compileRe=function(t,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))return t.output;const n=e||{},o=n.contains?"":"^",i=n.contains?"":"$";let a=`${o}(?:${t.output})${i}`;t&&!0===t.negated&&(a=`^(?!${a}).*$`);const s=Sn.toRegex(a,e);return!0===r&&(s.state=t),s},Sn.makeRe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t||"string"!=typeof t)throw new TypeError("Expected a non-empty string");let o={negated:!1,fastpaths:!0};return!1===e.fastpaths||"."!==t[0]&&"*"!==t[0]||(o.output=xn.fastpaths(t,e)),o.output||(o=xn(t,e)),Sn.compileRe(o,e,r,n)},Sn.toRegex=(t,e)=>{try{const r=e||{};return new RegExp(t,r.flags||(r.nocase?"i":""))}catch(t){if(e&&!0===e.debug)throw t;return/$^/}},Sn.constants=wn;var En=c(Sn);class kn{constructor(t){n(this,"extensions",void 0),n(this,"mimeTypes",void 0);const[e,r]=(t=>{const e=[],r=[];return t.split(",").map((t=>t.trim())).filter(Boolean).forEach((t=>{t.startsWith(".")?e.push(`*${t}`):r.push(t)})),[e,r]})(t);this.extensions=e,this.mimeTypes=r}isAccepted(t){return 0===this.extensions.length&&0===this.mimeTypes.length||(this.isMimeTypeAccepted(y.getType(t))||this.isExtensionAccepted(t))}isMimeTypeAccepted(t){return!(!t||0===this.mimeTypes.length)&&En.isMatch(t,this.mimeTypes)}isExtensionAccepted(t){return 0!==this.extensions.length&&En.isMatch(t,this.extensions)}}const Rn=async t=>new Promise(((e,r)=>t.createReader().readEntries(e,r))),An=async t=>new Promise(((e,r)=>t.file(e,r))),Cn=async t=>{const e=[];for await(const r of t)if(r.isFile){const t=await An(r);e.push(t)}else if(r.isDirectory){const t=await Rn(r);(await Cn(t)).forEach((t=>e.push(t)))}return e};class On{constructor(t){let{container:e,inputAccept:r,onUploadFiles:o,renderer:i}=t;n(this,"acceptedFileTypes",void 0),n(this,"container",void 0),n(this,"onUploadFiles",void 0),n(this,"renderer",void 0),n(this,"onDrop",(t=>{const e=t;this.container.classList.remove("dff-dropping"),e.preventDefault(),e.stopPropagation();(async()=>{try{if(e.dataTransfer){const t=await(async t=>{if(t.items){const e=[...t.items].map((t=>t.webkitGetAsEntry()));return await Cn(e)}return[...t.files]})(e.dataTransfer),r=[],n=[];for(const e of t)this.acceptedFileTypes.isAccepted(e.name)?r.push(e):n.push(e);this.renderer.setErrorInvalidFiles(n),this.onUploadFiles(r)}}catch(t){console.error(t)}})()})),this.container=e,this.onUploadFiles=o,this.acceptedFileTypes=new kn(r),this.renderer=i,e.addEventListener("dragenter",(()=>{e.classList.add("dff-dropping")})),e.addEventListener("dragleave",(()=>{e.classList.remove("dff-dropping")})),e.addEventListener("dragover",(t=>{e.classList.add("dff-dropping"),t.preventDefault()})),e.addEventListener("drop",this.onDrop)}}let Tn=class{constructor(t){let{name:e,status:r,type:o,uploadIndex:i}=t;n(this,"name",void 0),n(this,"status",void 0),n(this,"type",void 0),n(this,"uploadIndex",void 0),this.name=e,this.status=r,this.type=o,this.uploadIndex=i}async abort(){}async delete(){}};function jn(){return function(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);if(t[0].match(/^[^/:]+:\/*$/)&&t.length>1){var r=t.shift();t[0]=r+t[0]}t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<t.length;n++){var o=t[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<t.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),e.push(o))}var i=e.join("/"),a=(i=i.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a.shift()+(a.length>0?"?":"")+a.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}const Pn=(t,e)=>{const r=t.indexOf(e);-1!==r&&t.splice(r,1)};class Un extends Tn{constructor(t){let{csrfToken:e,endpoint:r,file:o,s3UploadDir:i,uploadIndex:a}=t;super({name:o.name,status:"uploading",type:"s3",uploadIndex:a}),n(this,"onError",void 0),n(this,"onProgress",void 0),n(this,"onSuccess",void 0),n(this,"chunkState",void 0),n(this,"chunks",void 0),n(this,"createdPromise",void 0),n(this,"csrfToken",void 0),n(this,"endpoint",void 0),n(this,"file",void 0),n(this,"key",void 0),n(this,"parts",void 0),n(this,"s3UploadDir",void 0),n(this,"uploadId",void 0),n(this,"uploading",void 0),this.csrfToken=e,this.endpoint=r,this.file=o,this.s3UploadDir=i,this.key=null,this.uploadId=null,this.parts=[],this.createdPromise=Promise.reject(),this.chunks=[],this.chunkState=[],this.uploading=[],this.onError=void 0,this.onProgress=void 0,this.onSuccess=void 0,this.initChunks(),this.createdPromise.catch((()=>({})))}async abort(){this.uploading.slice().forEach((t=>{t.abort()})),this.uploading=[],await this.createdPromise,this.key&&this.uploadId&&await(t=>{let{csrfToken:e,key:r,uploadId:n,endpoint:o}=t;const i=encodeURIComponent(r),a=encodeURIComponent(n),s=new Headers({"X-CSRFToken":e}),l=jn(o,a,`?key=${i}`);return fetch(l,{method:"delete",headers:s}).then((t=>t.json()))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,uploadId:this.uploadId})}async delete(){return Promise.resolve()}getId(){return this.uploadId||void 0}getInitialFile(){return{id:this.uploadId||"",name:this.key||"",size:this.file.size,original_name:this.file.name,type:"s3"}}getSize(){return this.file.size}start(){this.createUpload()}initChunks(){const t=[],e=(r=this.file,Math.ceil(r.size/1e4));var r;const n=Math.max(5242880,Math.ceil(this.file.size/1e4)),o=Math.max(e,n);for(let e=0;e<this.file.size;e+=o){const r=Math.min(this.file.size,e+o);t.push(this.file.slice(e,r))}this.chunks=t,this.chunkState=t.map((()=>({uploaded:0,busy:!1,done:!1})))}createUpload(){return this.createdPromise=(t=>{let{csrfToken:e,endpoint:r,file:n,s3UploadDir:o}=t;const i=new Headers({accept:"application/json","content-type":"application/json","X-CSRFToken":e});return fetch(r,{method:"post",headers:i,body:JSON.stringify({filename:n.name,contentType:n.type,s3UploadDir:o})}).then((t=>t.json())).then((t=>t))})({csrfToken:this.csrfToken,endpoint:this.endpoint,file:this.file,s3UploadDir:this.s3UploadDir}),this.createdPromise.then((t=>{if(!("object"==typeof t&&t&&"string"==typeof t.uploadId&&"string"==typeof t.key))throw new TypeError("AwsS3/Multipart: Got incorrect result from `createMultipartUpload()`, expected an object `{ uploadId, key }`.");this.key=t.key,this.uploadId=t.uploadId,this.uploadParts()})).catch((t=>{this.handleError(t)}))}uploadParts(){const t=1-this.uploading.length;if(0===t)return;if(this.chunkState.every((t=>t.done)))return void this.completeUpload();const e=[];for(let r=0;r<this.chunkState.length;r++){const n=this.chunkState[r];if(n&&!n.done&&!n.busy&&(e.push(r),e.length>=t))break}e.forEach((t=>{this.uploadPart(t)}))}uploadPart(t){const e=this.chunkState[t];return e&&(e.busy=!0),this.key&&this.uploadId?(t=>{let{csrfToken:e,endpoint:r,key:n,number:o,uploadId:i}=t;const a=encodeURIComponent(n),s=new Headers({"X-CSRFToken":e}),l=jn(r,i,`${o}`,`?key=${a}`);return fetch(l,{method:"get",headers:s}).then((t=>t.json())).then((t=>t))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,number:t+1,uploadId:this.uploadId}).then((t=>{if(!("object"==typeof t&&t&&"string"==typeof t.url))throw new TypeError("AwsS3/Multipart: Got incorrect result from `prepareUploadPart()`, expected an object `{ url }`.");return t})).then((e=>{let{url:r}=e;this.uploadPartBytes(t,r)}),(t=>{this.handleError(t)})):Promise.resolve()}onPartProgress(t,e){const r=this.chunkState[t];if(r&&(r.uploaded=e),this.onProgress){const t=this.chunkState.reduce(((t,e)=>t+e.uploaded),0);this.onProgress(t,this.file.size)}}onPartComplete(t,e){const r=this.chunkState[t];r&&(r.etag=e,r.done=!0);const n={PartNumber:t+1,ETag:e};this.parts.push(n),this.uploadParts()}uploadPartBytes(t,e){const r=this.chunks[t],n=new XMLHttpRequest;n.open("PUT",e,!0),n.responseType="text",this.uploading.push(n),n.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.onPartProgress(t,e.loaded)})),n.addEventListener("abort",(e=>{Pn(this.uploading,e.target);const r=this.chunkState[t];r&&(r.busy=!1)})),n.addEventListener("load",(e=>{const n=e.target;Pn(this.uploading,n);const o=this.chunkState[t];if(o&&(o.busy=!1),n.status<200||n.status>=300)return void this.handleError(new Error("Non 2xx"));this.onPartProgress(t,r?.size||0);const i=n.getResponseHeader("ETag");null!==i?this.onPartComplete(t,i):this.handleError(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."))})),n.addEventListener("error",(e=>{Pn(this.uploading,e.target);const r=this.chunkState[t];r&&(r.busy=!1);const n=new Error("Unknown error");this.handleError(n)})),n.send(r)}completeUpload(){return this.parts.sort(((t,e)=>t.PartNumber-e.PartNumber)),this.uploadId&&this.key?(t=>{let{csrfToken:e,key:r,uploadId:n,parts:o,endpoint:i}=t;const a=encodeURIComponent(r),s=encodeURIComponent(n),l=new Headers({"X-CSRFToken":e}),u=jn(i,s,"complete",`?key=${a}`);return fetch(u,{method:"post",headers:l,body:JSON.stringify({parts:o})}).then((t=>t.json())).then((t=>t))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,uploadId:this.uploadId,parts:this.parts}).then((()=>{this.onSuccess&&this.onSuccess()}),(t=>{this.handleError(t)})):Promise.resolve()}handleError(t){if(!this.onError)throw t;this.onError(t)}}const Ln=async(t,e)=>new Promise(((r,n)=>{const o=new XMLHttpRequest;o.open("DELETE",t),o.onload=()=>{204===o.status?r():n()},o.setRequestHeader("Tus-Resumable","1.0.0"),o.setRequestHeader("X-CSRFToken",e),o.send(null)}));class In extends Tn{constructor(t){let{name:e,size:r,type:o,uploadIndex:i}=t;super({name:e,status:"done",type:o,uploadIndex:i}),n(this,"size",void 0),this.size=r}async abort(){return Promise.resolve()}async delete(){return Promise.resolve()}getSize(){return this.size}}class Hn extends In{constructor(t,e){super({name:t.name,size:t.size,type:"placeholder",uploadIndex:e}),n(this,"id",void 0),this.id=t.id}getId(){}getInitialFile(){return{id:this.id,name:this.name,size:this.size,type:"placeholder"}}}class Dn extends In{constructor(t,e){super({name:t.original_name||t.name,size:t.size,type:"uploadedS3",uploadIndex:e}),n(this,"id",void 0),n(this,"key",void 0),this.id=t.id,this.key=t.name}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.key,original_name:this.name,size:this.size,type:"s3"}}}class $n extends In{constructor(t,e){super({name:t.name,size:t.size,type:"existing",uploadIndex:e})}getId(){}getInitialFile(){return{name:this.name,size:this.size,type:"existing"}}}class Nn extends In{constructor(t){let{csrfToken:e,initialFile:r,uploadIndex:o,uploadUrl:i}=t;super({name:r.name,size:r.size,type:"uploadedTus",uploadIndex:o}),n(this,"csrfToken",void 0),n(this,"id",void 0),n(this,"url",void 0),this.csrfToken=e,this.id=r.id,this.url=`${i}${r.id}`}async delete(){await Ln(this.url,this.csrfToken)}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.name,size:this.size,type:"tus",url:""}}}const Fn="function"==typeof btoa,zn="function"==typeof Buffer,qn=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),Mn=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Bn=((t=>{let e={};t.forEach(((t,r)=>e[t]=r))})(Mn),String.fromCharCode.bind(String)),Gn=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),t=>t.replace(/=/g,"").replace(/[+\/]/g,(t=>"+"==t?"-":"_"))),Kn=t=>{let e,r,n,o,i="";const a=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|n<<8|o,i+=Mn[e>>18&63]+Mn[e>>12&63]+Mn[e>>6&63]+Mn[63&e]}return a?i.slice(0,a-3)+"===".substring(a):i},Xn=Fn?t=>btoa(t):zn?t=>Buffer.from(t,"binary").toString("base64"):Kn,Qn=zn?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let r=0,n=t.length;r<n;r+=4096)e.push(Bn.apply(null,t.subarray(r,r+4096)));return Xn(e.join(""))},Wn=t=>{if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?Bn(192|e>>>6)+Bn(128|63&e):Bn(224|e>>>12&15)+Bn(128|e>>>6&63)+Bn(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return Bn(240|e>>>18&7)+Bn(128|e>>>12&63)+Bn(128|e>>>6&63)+Bn(128|63&e)},Yn=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Zn=t=>t.replace(Yn,Wn),Jn=zn?t=>Buffer.from(t,"utf8").toString("base64"):qn?t=>Qn(qn.encode(t)):t=>Xn(Zn(t)),Vn=(t,e=!1)=>e?Gn(Jn(t)):Jn(t),to=Vn;var eo={},ro=Object.prototype.hasOwnProperty;function no(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function oo(t){try{return encodeURIComponent(t)}catch(t){return null}}eo.stringify=function(t,e){e=e||"";var r,n,o=[];for(n in"string"!=typeof e&&(e="?"),t)if(ro.call(t,n)){if((r=t[n])||null!=r&&!isNaN(r)||(r=""),n=oo(n),r=oo(r),null===n||null===r)continue;o.push(n+"="+r)}return o.length?e+o.join("&"):""},eo.parse=function(t){for(var e,r=/([^=?#&]+)=?([^&]*)/g,n={};e=r.exec(t);){var o=no(e[1]),i=no(e[2]);null===o||null===i||o in n||(n[o]=i)}return n};var io=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t},ao=eo,so=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,lo=/[\n\r\t]/g,uo=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,co=/:\d+$/,po=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,fo=/^[a-zA-Z]:/;function ho(t){return(t||"").toString().replace(so,"")}var mo=[["#","hash"],["?","query"],function(t,e){return go(e.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],yo={hash:1,query:1};function vo(t){var e,r=("undefined"!=typeof window?window:void 0!==u?u:"undefined"!=typeof self?self:{}).location||{},n={},o=typeof(t=t||r);if("blob:"===t.protocol)n=new xo(unescape(t.pathname),{});else if("string"===o)for(e in n=new xo(t,{}),yo)delete n[e];else if("object"===o){for(e in t)e in yo||(n[e]=t[e]);void 0===n.slashes&&(n.slashes=uo.test(t.href))}return n}function go(t){return"file:"===t||"ftp:"===t||"http:"===t||"https:"===t||"ws:"===t||"wss:"===t}function bo(t,e){t=(t=ho(t)).replace(lo,""),e=e||{};var r,n=po.exec(t),o=n[1]?n[1].toLowerCase():"",i=!!n[2],a=!!n[3],s=0;return i?a?(r=n[2]+n[3]+n[4],s=n[2].length+n[3].length):(r=n[2]+n[4],s=n[2].length):a?(r=n[3]+n[4],s=n[3].length):r=n[4],"file:"===o?s>=2&&(r=r.slice(2)):go(o)?r=n[4]:o?i&&(r=r.slice(2)):s>=2&&go(e.protocol)&&(r=n[4]),{protocol:o,slashes:i||go(o),slashesCount:s,rest:r}}function xo(t,e,r){if(t=(t=ho(t)).replace(lo,""),!(this instanceof xo))return new xo(t,e,r);var n,o,i,a,s,l,u=mo.slice(),c=typeof e,p=this,f=0;for("object"!==c&&"string"!==c&&(r=e,e=null),r&&"function"!=typeof r&&(r=ao.parse),n=!(o=bo(t||"",e=vo(e))).protocol&&!o.slashes,p.slashes=o.slashes||n&&e.slashes,p.protocol=o.protocol||e.protocol||"",t=o.rest,("file:"===o.protocol&&(2!==o.slashesCount||fo.test(t))||!o.slashes&&(o.protocol||o.slashesCount<2||!go(p.protocol)))&&(u[3]=[/(.*)/,"pathname"]);f<u.length;f++)"function"!=typeof(a=u[f])?(i=a[0],l=a[1],i!=i?p[l]=t:"string"==typeof i?~(s="@"===i?t.lastIndexOf(i):t.indexOf(i))&&("number"==typeof a[2]?(p[l]=t.slice(0,s),t=t.slice(s+a[2])):(p[l]=t.slice(s),t=t.slice(0,s))):(s=i.exec(t))&&(p[l]=s[1],t=t.slice(0,s.index)),p[l]=p[l]||n&&a[3]&&e[l]||"",a[4]&&(p[l]=p[l].toLowerCase())):t=a(t,p);r&&(p.query=r(p.query)),n&&e.slashes&&"/"!==p.pathname.charAt(0)&&(""!==p.pathname||""!==e.pathname)&&(p.pathname=function(t,e){if(""===t)return e;for(var r=(e||"/").split("/").slice(0,-1).concat(t.split("/")),n=r.length,o=r[n-1],i=!1,a=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),a++):a&&(0===n&&(i=!0),r.splice(n,1),a--);return i&&r.unshift(""),"."!==o&&".."!==o||r.push(""),r.join("/")}(p.pathname,e.pathname)),"/"!==p.pathname.charAt(0)&&go(p.protocol)&&(p.pathname="/"+p.pathname),io(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(~(s=p.auth.indexOf(":"))?(p.username=p.auth.slice(0,s),p.username=encodeURIComponent(decodeURIComponent(p.username)),p.password=p.auth.slice(s+1),p.password=encodeURIComponent(decodeURIComponent(p.password))):p.username=encodeURIComponent(decodeURIComponent(p.auth)),p.auth=p.password?p.username+":"+p.password:p.username),p.origin="file:"!==p.protocol&&go(p.protocol)&&p.host?p.protocol+"//"+p.host:"null",p.href=p.toString()}xo.prototype={set:function(t,e,r){var n=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(r||ao.parse)(e)),n[t]=e;break;case"port":n[t]=e,io(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[t]="");break;case"hostname":n[t]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[t]=e,co.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(e){var o="pathname"===t?"/":"#";n[t]=e.charAt(0)!==o?o+e:e}else n[t]=e;break;case"username":case"password":n[t]=encodeURIComponent(e);break;case"auth":var i=e.indexOf(":");~i?(n.username=e.slice(0,i),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(i+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var a=0;a<mo.length;a++){var s=mo[a];s[4]&&(n[s[1]]=n[s[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin="file:"!==n.protocol&&go(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(t){t&&"function"==typeof t||(t=ao.stringify);var e,r=this,n=r.host,o=r.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var i=o+(r.protocol&&r.slashes||go(r.protocol)?"//":"");return r.username?(i+=r.username,r.password&&(i+=":"+r.password),i+="@"):r.password?(i+=":"+r.password,i+="@"):"file:"!==r.protocol&&go(r.protocol)&&!n&&"/"!==r.pathname&&(i+="@"),(":"===n[n.length-1]||co.test(r.hostname)&&!r.port)&&(n+=":"),i+=n+r.pathname,(e="object"==typeof r.query?t(r.query):r.query)&&(i+="?"!==e.charAt(0)?"?"+e:e),r.hash&&(i+=r.hash),i}},xo.extractProtocol=bo,xo.location=vo,xo.trimLeft=ho,xo.qs=ao;var _o=c(xo);function wo(t){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wo(t)}function So(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Eo(n.key),n)}}function Eo(t){var e=function(t,e){if("object"!==wo(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==wo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===wo(e)?e:String(e)}function ko(t){var e=Co();return function(){var r,n=To(t);if(e){var o=To(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===wo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Ro(t){var e="function"==typeof Map?new Map:void 0;return Ro=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return Ao(t,arguments,To(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Oo(n,t)},Ro(t)}function Ao(t,e,r){return Ao=Co()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&Oo(o,r.prototype),o},Ao.apply(null,arguments)}function Co(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Oo(t,e){return Oo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Oo(t,e)}function To(t){return To=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},To(t)}var jo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Oo(t,e)}(i,t);var e,r,n,o=ko(i);function i(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).originalRequest=n,e.originalResponse=a,e.causingError=r,null!=r&&(t+=", caused by ".concat(r.toString())),null!=n){var s=n.getHeader("X-Request-ID")||"n/a",l=n.getMethod(),u=n.getURL(),c=a?a.getStatus():"n/a",p=a?a.getBody()||"":"n/a";t+=", originated from request (method: ".concat(l,", url: ").concat(u,", response code: ").concat(c,", response text: ").concat(p,", request id: ").concat(s,")")}return e.message=t,e}return e=i,r&&So(e.prototype,r),n&&So(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(Ro(Error));function Po(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
Po=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,o){var i=e&&e.prototype instanceof f?e:f,a=Object.create(i.prototype),s=new k(o||[]);return n(a,"_invoke",{value:_(t,r,s)}),a}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var p={};function f(){}function d(){}function h(){}var m={};l(m,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(R([])));v&&v!==e&&r.call(v,i)&&(m=v);var g=h.prototype=f.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function o(n,i,a,s){var l=c(t[n],t,i);if("throw"!==l.type){var u=l.arg,p=u.value;return p&&"object"==Ho(p)&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,a,s)}),(function(t){o("throw",t,a,s)})):e.resolve(p).then((function(t){u.value=t,a(u)}),(function(t){return o("throw",t,a,s)}))}s(l.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function _(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function w(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=c(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,p;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function R(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=l(h,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,l(t,s,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(x.prototype),l(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),l(g,s,"Generator"),l(g,i,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=R,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:R(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}function Uo(t,e,r,n,o,i,a){try{var s=t[i](a),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function Lo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);l=!0);}catch(t){u=!0,o=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Io(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Io(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Io(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ho(t){return Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ho(t)}function Do(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Do(Object(r),!0).forEach((function(e){No(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Do(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function No(t,e,r){return(e=zo(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zo(n.key),n)}}function zo(t){var e=function(t,e){if("object"!==Ho(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ho(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ho(e)?e:String(e)}var qo={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:null,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null},Mo=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}var e,r,n;return e=t,r=[{key:"findPreviousUploads",value:function(){var t=this;return this.options.fingerprint(this.file,this.options).then((function(e){return t._urlStorage.findUploadsByFingerprint(e)}))}},{key:"resumeFromPreviousUpload",value:function(t){this.url=t.uploadUrl||null,this._parallelUploadUrls=t.parallelUploadUrls||null,this._urlStorageKey=t.urlStorageKey}},{key:"start",value:function(){var t=this,e=this.file;if(e)if(this.options.endpoint||this.options.uploadUrl||this.url){var r=this.options.retryDelays;if(null==r||"[object Array]"===Object.prototype.toString.call(r)){if(this.options.parallelUploads>1)for(var n=0,o=["uploadUrl","uploadSize","uploadLengthDeferred"];n<o.length;n++){var i=o[n];if(this.options[i])return void this._emitError(new Error("tus: cannot use the ".concat(i," option when parallelUploads is enabled")))}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(e,this.options).then((function(r){return t._fingerprint=r,t._source?t._source:t.options.fileReader.openFile(e,t.options.chunkSize)})).then((function(e){if(t._source=e,t.options.uploadLengthDeferred)t._size=null;else if(null!=t.options.uploadSize){if(t._size=Number(t.options.uploadSize),Number.isNaN(t._size))return void t._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(t._size=t._source.size,null==t._size)return void t._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));t.options.parallelUploads>1||null!=t._parallelUploadUrls?t._startParallelUpload():t._startSingleUpload()})).catch((function(e){t._emitError(e)}))}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: no file or stream to upload provided"))}},{key:"_startParallelUpload",value:function(){var e,r=this,n=this._size,o=0;this._parallelUploads=[];var i=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,a=null!==(e=this.options.parallelUploadBoundaries)&&void 0!==e?e:function(t,e){for(var r=Math.floor(t/e),n=[],o=0;o<e;o++)n.push({start:r*o,end:r*(o+1)});return n[e-1].end=t,n}(this._source.size,i);this._parallelUploadUrls&&a.forEach((function(t,e){t.uploadUrl=r._parallelUploadUrls[e]||null})),this._parallelUploadUrls=new Array(a.length);var s,l=a.map((function(e,i){var s=0;return r._source.slice(e.start,e.end).then((function(l){var u=l.value;return new Promise((function(l,c){var p=$o($o({},r.options),{},{uploadUrl:e.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:{},headers:$o($o({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:l,onError:c,onProgress:function(t){o=o-s+t,s=t,r._emitProgress(o,n)},onUploadUrlAvailable:function(){r._parallelUploadUrls[i]=f.url,r._parallelUploadUrls.filter((function(t){return Boolean(t)})).length===a.length&&r._saveUploadInUrlStorage()}}),f=new t(u,p);f.start(),r._parallelUploads.push(f)}))}))}));Promise.all(l).then((function(){(s=r._openRequest("POST",r.options.endpoint)).setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var t=Bo(r.options.metadata);return""!==t&&s.setHeader("Upload-Metadata",t),r._sendRequest(s,null)})).then((function(t){if(Go(t.getStatus(),200)){var e=t.getHeader("Location");null!=e?(r.url=Yo(r.options.endpoint,e),"Created upload at ".concat(r.url),r._emitSuccess()):r._emitHttpError(s,t,"tus: invalid or missing Location header")}else r._emitHttpError(s,t,"tus: unexpected response while creating upload")})).catch((function(t){r._emitError(t)}))}},{key:"_startSingleUpload",value:function(){return this._aborted=!1,null!=this.url?("Resuming upload from previous URL: ".concat(this.url),void this._resumeUpload()):null!=this.options.uploadUrl?("Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,void this._resumeUpload()):void this._createUpload()}},{key:"abort",value:function(e){var r=this;return null!=this._parallelUploads&&this._parallelUploads.forEach((function(t){t.abort(e)})),null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),e&&null!=this.url?t.terminate(this.url,this.options).then((function(){return r._removeFromUrlStorage()})):Promise.resolve()}},{key:"_emitHttpError",value:function(t,e,r,n){this._emitError(new jo(r,n,t,e))}},{key:"_emitError",value:function(t){var e=this;if(!this._aborted){if(null!=this.options.retryDelays&&(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),Wo(t,this._retryAttempt,this.options))){var r=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout((function(){e.start()}),r))}if("function"!=typeof this.options.onError)throw t;this.options.onError(t)}}},{key:"_emitSuccess",value:function(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess()}},{key:"_emitProgress",value:function(t,e){"function"==typeof this.options.onProgress&&this.options.onProgress(t,e)}},{key:"_emitChunkComplete",value:function(t,e,r){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(t,e,r)}},{key:"_createUpload",value:function(){var t=this;if(this.options.endpoint){var e=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?e.setHeader("Upload-Defer-Length",1):e.setHeader("Upload-Length",this._size);var r,n=Bo(this.options.metadata);""!==n&&e.setHeader("Upload-Metadata",n),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,r=this._addChunkToRequest(e)):r=this._sendRequest(e,null),r.then((function(r){if(Go(r.getStatus(),200)){var n=r.getHeader("Location");if(null!=n){if(t.url=Yo(t.options.endpoint,n),"Created upload at ".concat(t.url),"function"==typeof t.options.onUploadUrlAvailable&&t.options.onUploadUrlAvailable(),0===t._size)return t._emitSuccess(),void t._source.close();t._saveUploadInUrlStorage().then((function(){t.options.uploadDataDuringCreation?t._handleUploadResponse(e,r):(t._offset=0,t._performUpload())}))}else t._emitHttpError(e,r,"tus: invalid or missing Location header")}else t._emitHttpError(e,r,"tus: unexpected response while creating upload")})).catch((function(r){t._emitHttpError(e,null,"tus: failed to create upload",r)}))}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}},{key:"_resumeUpload",value:function(){var t=this,e=this._openRequest("HEAD",this.url);this._sendRequest(e,null).then((function(r){var n=r.getStatus();if(!Go(n,200))return 423===n?void t._emitHttpError(e,r,"tus: upload is currently locked; retry later"):(Go(n,400)&&t._removeFromUrlStorage(),t.options.endpoint?(t.url=null,void t._createUpload()):void t._emitHttpError(e,r,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));var o=parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(o))t._emitHttpError(e,r,"tus: invalid or missing offset value");else{var i=parseInt(r.getHeader("Upload-Length"),10);!Number.isNaN(i)||t.options.uploadLengthDeferred?("function"==typeof t.options.onUploadUrlAvailable&&t.options.onUploadUrlAvailable(),t._saveUploadInUrlStorage().then((function(){if(o===i)return t._emitProgress(i,i),void t._emitSuccess();t._offset=o,t._performUpload()}))):t._emitHttpError(e,r,"tus: invalid or missing length value")}})).catch((function(r){t._emitHttpError(e,null,"tus: failed to resume upload",r)}))}},{key:"_performUpload",value:function(){var t,e=this;this._aborted||(this.options.overridePatchMethod?(t=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):t=this._openRequest("PATCH",this.url),t.setHeader("Upload-Offset",this._offset),this._addChunkToRequest(t).then((function(r){Go(r.getStatus(),200)?e._handleUploadResponse(t,r):e._emitHttpError(t,r,"tus: unexpected response while uploading chunk")})).catch((function(r){e._aborted||e._emitHttpError(t,null,"tus: failed to upload chunk at offset ".concat(e._offset),r)})))}},{key:"_addChunkToRequest",value:function(t){var e=this,r=this._offset,n=this._offset+this.options.chunkSize;return t.setProgressHandler((function(t){e._emitProgress(r+t,e._size)})),t.setHeader("Content-Type","application/offset+octet-stream"),(n===1/0||n>this._size)&&!this.options.uploadLengthDeferred&&(n=this._size),this._source.slice(r,n).then((function(r){var n=r.value,o=r.done,i=n&&n.size?n.size:0;e.options.uploadLengthDeferred&&o&&(e._size=e._offset+i,t.setHeader("Upload-Length",e._size));var a=e._offset+i;return!e.options.uploadLengthDeferred&&o&&a!==e._size?Promise.reject(new Error("upload was configured with a size of ".concat(e._size," bytes, but the source is done after ").concat(a," bytes"))):null===n?e._sendRequest(t):(e._emitProgress(e._offset,e._size),e._sendRequest(t,n))}))}},{key:"_handleUploadResponse",value:function(t,e){var r=parseInt(e.getHeader("Upload-Offset"),10);if(Number.isNaN(r))this._emitHttpError(t,e,"tus: invalid or missing offset value");else{if(this._emitProgress(r,this._size),this._emitChunkComplete(r-this._offset,r,this._size),this._offset=r,r===this._size)return this._emitSuccess(),void this._source.close();this._performUpload()}}},{key:"_openRequest",value:function(t,e){var r=Ko(t,e,this.options);return this._req=r,r}},{key:"_removeFromUrlStorage",value:function(){var t=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch((function(e){t._emitError(e)})),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var t=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();var e={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?e.parallelUploadUrls=this._parallelUploadUrls:e.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,e).then((function(e){t._urlStorageKey=e}))}},{key:"_sendRequest",value:function(t){return Xo(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}],n=[{key:"terminate",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Ko("DELETE",e,r);return Xo(n,null,r).then((function(t){if(204!==t.getStatus())throw new jo("tus: unexpected response while terminating upload",null,n,t)})).catch((function(o){if(o instanceof jo||(o=new jo("tus: failed to terminate upload",o,n,null)),!Wo(o,0,r))throw o;var i=r.retryDelays[0],a=r.retryDelays.slice(1),s=$o($o({},r),{},{retryDelays:a});return new Promise((function(t){return setTimeout(t,i)})).then((function(){return t.terminate(e,s)}))}))}}],r&&Fo(e.prototype,r),n&&Fo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Bo(t){return Object.entries(t).map((function(t){var e=Lo(t,2),r=e[0],n=e[1];return"".concat(r," ").concat(to(String(n)))})).join(",")}function Go(t,e){return t>=e&&t<e+100}function Ko(t,e,r){var n=r.httpStack.createRequest(t,e);n.setHeader("Tus-Resumable","1.0.0");var o=r.headers||{};if(Object.entries(o).forEach((function(t){var e=Lo(t,2),r=e[0],o=e[1];n.setHeader(r,o)})),r.addRequestId){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}));n.setHeader("X-Request-ID",i)}return n}function Xo(t,e,r){return Qo.apply(this,arguments)}function Qo(){var t;return t=Po().mark((function t(e,r,n){var o;return Po().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof n.onBeforeRequest){t.next=3;break}return t.next=3,n.onBeforeRequest(e);case 3:return t.next=5,e.send(r);case 5:if(o=t.sent,"function"!=typeof n.onAfterResponse){t.next=9;break}return t.next=9,n.onAfterResponse(e,o);case 9:return t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)})),Qo=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Uo(i,n,o,a,s,"next",t)}function s(t){Uo(i,n,o,a,s,"throw",t)}a(void 0)}))},Qo.apply(this,arguments)}function Wo(t,e,r){if(null==r.retryDelays||e>=r.retryDelays.length||null==t.originalRequest)return!1;if(r&&"function"==typeof r.onShouldRetry)return r.onShouldRetry(t,e,r);var n,o=t.originalResponse?t.originalResponse.getStatus():0;return(!Go(o,400)||409===o||423===o)&&(n=!0,"undefined"!=typeof window&&"navigator"in window&&!1===window.navigator.onLine&&(n=!1),n)}function Yo(t,e){return new _o(e,t).toString()}function Zo(t){return Zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zo(t)}function Jo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Vo(n.key),n)}}function Vo(t){var e=function(t,e){if("object"!==Zo(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Zo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Zo(e)?e:String(e)}Mo.defaultOptions=qo;var ti=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(t){return Promise.resolve([])}},{key:"removeUpload",value:function(t){return Promise.resolve()}},{key:"addUpload",value:function(t,e){return Promise.resolve(null)}}])&&Jo(e.prototype,r),n&&Jo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ei(t){return ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ei(t)}function ri(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ni(n.key),n)}}function ni(t){var e=function(t,e){if("object"!==ei(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ei(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ei(e)?e:String(e)}var oi=!1;try{oi="localStorage"in window;var ii="tusSupport",ai=localStorage.getItem(ii);localStorage.setItem(ii,ai),null===ai&&localStorage.removeItem(ii)}catch(t){if(t.code!==t.SECURITY_ERR&&t.code!==t.QUOTA_EXCEEDED_ERR)throw t;oi=!1}var si=oi,li=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,r=[{key:"findAllUploads",value:function(){var t=this._findEntries("tus::");return Promise.resolve(t)}},{key:"findUploadsByFingerprint",value:function(t){var e=this._findEntries("tus::".concat(t,"::"));return Promise.resolve(e)}},{key:"removeUpload",value:function(t){return localStorage.removeItem(t),Promise.resolve()}},{key:"addUpload",value:function(t,e){var r=Math.round(1e12*Math.random()),n="tus::".concat(t,"::").concat(r);return localStorage.setItem(n,JSON.stringify(e)),Promise.resolve(n)}},{key:"_findEntries",value:function(t){for(var e=[],r=0;r<localStorage.length;r++){var n=localStorage.key(r);if(0===n.indexOf(t))try{var o=JSON.parse(localStorage.getItem(n));o.urlStorageKey=n,e.push(o)}catch(t){}}return e}}],r&&ri(e.prototype,r),n&&ri(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ui(t){return ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ui(t)}function ci(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,di(n.key),n)}}function fi(t,e,r){return e&&pi(t.prototype,e),r&&pi(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function di(t){var e=function(t,e){if("object"!==ui(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ui(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ui(e)?e:String(e)}var hi=function(){function t(){ci(this,t)}return fi(t,[{key:"createRequest",value:function(t,e){return new mi(t,e)}},{key:"getName",value:function(){return"XHRHttpStack"}}]),t}(),mi=function(){function t(e,r){ci(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,r,!0),this._method=e,this._url=r,this._headers={}}return fi(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(t,e){this._xhr.setRequestHeader(t,e),this._headers[t]=e}},{key:"getHeader",value:function(t){return this._headers[t]}},{key:"setProgressHandler",value:function(t){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(e){e.lengthComputable&&t(e.loaded)})}},{key:"send",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise((function(r,n){t._xhr.onload=function(){r(new yi(t._xhr))},t._xhr.onerror=function(t){n(t)},t._xhr.send(e)}))}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),t}(),yi=function(){function t(e){ci(this,t),this._xhr=e}return fi(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(t){return this._xhr.getResponseHeader(t)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),t}(),vi=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()};function gi(t){return new Promise((function(e,r){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var t=n.response;e(t)},n.onerror=function(t){r(t)},n.open("GET",t),n.send()}))}function bi(t){return bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bi(t)}function xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_i(n.key),n)}}function _i(t){var e=function(t,e){if("object"!==bi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===bi(e)?e:String(e)}var wi=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._file=e,this.size=e.size}var e,r,n;return e=t,r=[{key:"slice",value:function(t,e){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return r=this._file.slice(t,e),new Promise((function(t,e){var n=new FileReader;n.onload=function(){var e=new Uint8Array(n.result);t({value:e})},n.onerror=function(t){e(t)},n.readAsArrayBuffer(r)}));var r,n=this._file.slice(t,e),o=e>=this.size;return Promise.resolve({value:n,done:o})}},{key:"close",value:function(){}}],r&&xi(e.prototype,r),n&&xi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Si(t){return Si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Si(t)}function Ei(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ki(n.key),n)}}function ki(t){var e=function(t,e){if("object"!==Si(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Si(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Si(e)?e:String(e)}function Ri(t){return void 0===t?0:void 0!==t.size?t.size:t.length}var Ai=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}var e,r,n;return e=t,(r=[{key:"slice",value:function(t,e){return t<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(t,e)}},{key:"_readUntilEnoughDataOrDone",value:function(t,e){var r=this,n=e<=this._bufferOffset+Ri(this._buffer);if(this._done||n){var o=this._getDataFromBuffer(t,e),i=null==o&&this._done;return Promise.resolve({value:o,done:i})}return this._reader.read().then((function(n){var o=n.value;return n.done?r._done=!0:void 0===r._buffer?r._buffer=o:r._buffer=function(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r}throw new Error("Unknown data type")}(r._buffer,o),r._readUntilEnoughDataOrDone(t,e)}))}},{key:"_getDataFromBuffer",value:function(t,e){t>this._bufferOffset&&(this._buffer=this._buffer.slice(t-this._bufferOffset),this._bufferOffset=t);var r=0===Ri(this._buffer);return this._done&&r?null:this._buffer.slice(0,e-t)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])&&Ei(e.prototype,r),n&&Ei(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ci(t){return Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ci(t)}function Oi(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
Oi=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,o){var i=e&&e.prototype instanceof f?e:f,a=Object.create(i.prototype),s=new k(o||[]);return n(a,"_invoke",{value:_(t,r,s)}),a}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var p={};function f(){}function d(){}function h(){}var m={};l(m,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(R([])));v&&v!==e&&r.call(v,i)&&(m=v);var g=h.prototype=f.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function o(n,i,a,s){var l=c(t[n],t,i);if("throw"!==l.type){var u=l.arg,p=u.value;return p&&"object"==Ci(p)&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,a,s)}),(function(t){o("throw",t,a,s)})):e.resolve(p).then((function(t){u.value=t,a(u)}),(function(t){return o("throw",t,a,s)}))}s(l.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function _(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function w(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=c(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,p;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function R(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=h,n(g,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=l(h,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,l(t,s,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(x.prototype),l(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),l(g,s,"Generator"),l(g,i,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=R,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:R(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}function Ti(t,e,r,n,o,i,a){try{var s=t[i](a),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function ji(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Pi(n.key),n)}}function Pi(t){var e=function(t,e){if("object"!==Ci(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ci(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ci(e)?e:String(e)}var Ui=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n,o,i;return e=t,r=[{key:"openFile",value:(o=Oi().mark((function t(e,r){var n;return Oi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!vi()||!e||void 0===e.uri){t.next=11;break}return t.prev=1,t.next=4,gi(e.uri);case 4:return n=t.sent,t.abrupt("return",new wi(n));case 8:throw t.prev=8,t.t0=t.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(t.t0));case 11:if("function"!=typeof e.slice||void 0===e.size){t.next=13;break}return t.abrupt("return",Promise.resolve(new wi(e)));case 13:if("function"!=typeof e.read){t.next=18;break}if(r=Number(r),Number.isFinite(r)){t.next=17;break}return t.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return t.abrupt("return",Promise.resolve(new Ai(e,r)));case 18:return t.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return t.stop()}}),t,null,[[1,8]])})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){Ti(i,r,n,a,s,"next",t)}function s(t){Ti(i,r,n,a,s,"throw",t)}a(void 0)}))},function(t,e){return i.apply(this,arguments)})}],r&&ji(e.prototype,r),n&&ji(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Li(t){return Li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Li(t)}function Ii(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qi(n.key),n)}}function Hi(t,e){return Hi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hi(t,e)}function Di(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=$i(t);if(e){var o=$i(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Li(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function $i(t){return $i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$i(t)}function Ni(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Fi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ni(Object(r),!0).forEach((function(e){zi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ni(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function zi(t,e,r){return(e=qi(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function qi(t){var e=function(t,e){if("object"!==Li(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Li(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Li(e)?e:String(e)}var Mi=Fi(Fi({},Mo.defaultOptions),{},{httpStack:new hi,fileReader:new Ui,urlStorage:si?new li:new ti,fingerprint:function(t,e){return vi()?Promise.resolve(function(t,e){var r=t.exif?function(t){var e=0;if(0===t.length)return e;for(var r=0;r<t.length;r++){e=(e<<5)-e+t.charCodeAt(r),e&=e}return e}(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",r,e.endpoint].join("/")}(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}}),Bi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hi(t,e)}(i,t);var e,r,n,o=Di(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=Fi(Fi({},Mi),e),o.call(this,t,e)}return e=i,n=[{key:"terminate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=Fi(Fi({},Mi),e),Mo.terminate(t,e)}}],(r=null)&&Ii(e.prototype,r),n&&Ii(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(Mo);class Gi extends Tn{constructor(t){let{chunkSize:e,csrfToken:r,fieldName:o,file:i,formId:a,retryDelays:s,uploadIndex:l,uploadUrl:u}=t;super({name:i.name,status:"uploading",type:"tus",uploadIndex:l}),n(this,"onError",void 0),n(this,"onProgress",void 0),n(this,"onSuccess",void 0),n(this,"id",void 0),n(this,"upload",void 0),n(this,"csrfToken",void 0),n(this,"handleError",(t=>{if(!this.onError)throw t;this.onError(t)})),n(this,"handleProgress",((t,e)=>{this.onProgress&&this.onProgress(t,e)})),n(this,"handleSucces",(()=>{this.onSuccess&&this.onSuccess()})),n(this,"addCsrTokenToRequest",(t=>{t.setHeader("X-CSRFToken",this.csrfToken)})),n(this,"handleAfterReponse",((t,e)=>{const r=e.getHeader("ResourceId");r&&(this.id=r)})),this.csrfToken=r,this.upload=new Bi(i,{chunkSize:e,endpoint:u,metadata:{fieldName:o,filename:i.name,formId:a},onAfterResponse:this.handleAfterReponse,onBeforeRequest:this.addCsrTokenToRequest,onError:this.handleError,onProgress:this.handleProgress,onSuccess:this.handleSucces,retryDelays:s||[0,1e3,3e3,5e3]}),this.onError=void 0,this.onProgress=void 0,this.onSuccess=void 0}async abort(){await this.upload.abort(!0)}async delete(){if(!this.upload.url)return Promise.resolve();await Ln(this.upload.url,this.csrfToken)}getId(){return this.id}getSize(){return this.upload.file.size}start(){this.upload.start()}getInitialFile(){return{id:this.id,name:this.name,size:this.getSize(),type:"tus",url:""}}}class Ki{constructor(t){let{callbacks:e,chunkSize:r,csrfToken:o,eventEmitter:i,fieldName:a,form:s,formId:l,initial:u,input:c,multiple:p,parent:f,prefix:d,retryDelays:m,s3UploadDir:y,skipRequired:v,supportDropArea:g,translations:b,uploadUrl:x}=t;n(this,"acceptedFileTypes",void 0),n(this,"callbacks",void 0),n(this,"chunkSize",void 0),n(this,"csrfToken",void 0),n(this,"eventEmitter",void 0),n(this,"fieldName",void 0),n(this,"form",void 0),n(this,"formId",void 0),n(this,"multiple",void 0),n(this,"nextUploadIndex",void 0),n(this,"prefix",void 0),n(this,"renderer",void 0),n(this,"retryDelays",void 0),n(this,"s3UploadDir",void 0),n(this,"supportDropArea",void 0),n(this,"uploads",void 0),n(this,"uploadUrl",void 0),n(this,"uploadFiles",(async t=>{if(0!==t.length){if(this.multiple)for await(const e of t)await this.uploadFile(e);else{for(const t of this.uploads)this.renderer.deleteFile(t.uploadIndex);this.uploads=[];const e=t[0];e&&await this.uploadFile(e)}this.checkDropHint()}})),n(this,"onChange",(t=>{const e=t.target.files||[],r=[],n=[];for(const t of e)this.acceptedFileTypes.isAccepted(t.name)?r.push(t):n.push(t);n&&this.handleInvalidFiles([...n]),r&&this.uploadFiles([...r]),this.renderer.clearInput()})),n(this,"handleInvalidFiles",(t=>{this.renderer.setErrorInvalidFiles(t)})),n(this,"handleClick",(t=>{const e=t.target,r=()=>{const t=e.getAttribute("data-index");if(!t)return;const r=parseInt(t,10);return this.getUploadByIndex(r)};if(e.classList.contains("dff-delete")&&!e.classList.contains("dff-disabled")){t.preventDefault();const e=r();e&&this.removeExistingUpload(e)}else if(e.classList.contains("dff-cancel")){t.preventDefault();const e=r();e&&this.handleCancel(e)}else if(e.classList.contains("dff-filename")){t.preventDefault();const e=r();"done"===e?.status&&this.callbacks.onClick&&this.callbacks.onClick({fileName:e.name,fieldName:this.fieldName,id:e.getId(),type:e.type})}})),n(this,"handleProgress",((t,e,r)=>{const n=(e/r*100).toFixed(2);this.renderer.updateProgress(t.uploadIndex,n);const{onProgress:o}=this.callbacks;o&&t instanceof Gi&&o(e,r,t)})),n(this,"handleError",((t,e)=>{this.renderer.setError(t.uploadIndex),t.status="error";const{onError:r}=this.callbacks;r&&t instanceof Gi&&r(e,t)})),n(this,"handleSuccess",(t=>{const{renderer:e}=this;this.updatePlaceholderInput(),e.clearInput(),e.setSuccess(t.uploadIndex,t.getSize()),t.status="done";const{onSuccess:r}=this.callbacks,n=this.renderer.findFileDiv(t.uploadIndex);this.emitEvent("uploadComplete",n,t),r&&"tus"===t.type&&r(t)})),this.callbacks=e,this.chunkSize=r,this.csrfToken=o,this.eventEmitter=i,this.fieldName=a,this.form=s,this.formId=l,this.multiple=p,this.prefix=d,this.retryDelays=m,this.s3UploadDir=y,this.supportDropArea=g&&!c.disabled,this.uploadUrl=x,this.acceptedFileTypes=new kn(c.accept),this.uploads=[],this.nextUploadIndex=0,this.renderer=new h({parent:f,input:c,skipRequired:v,translations:b});const _=this.renderer.container;g&&this.initDropArea(_,c.accept),u&&this.addInitialFiles(u),this.checkDropHint(),c.addEventListener("change",this.onChange),_.addEventListener("click",this.handleClick)}addInitialFiles(t){if(0===t.length)return;const{multiple:e,renderer:r}=this,n=t=>{const{size:e}=t,n="s3"===t.type&&t.original_name?t.original_name:t.name,o=r.addUploadedFile(n,this.nextUploadIndex,e),i=(t=>{let{csrfToken:e,initialFile:r,uploadIndex:n,uploadUrl:o}=t;switch(r.type){case"existing":return new $n(r,n);case"placeholder":return new Hn(r,n);case"s3":return new Dn(r,n);case"tus":return new Nn({csrfToken:e,initialFile:r,uploadUrl:o,uploadIndex:n})}})({csrfToken:this.csrfToken,initialFile:t,uploadIndex:this.nextUploadIndex,uploadUrl:this.uploadUrl});this.uploads.push(i),this.emitEvent("addUpload",o,i)};if(e)t.forEach((t=>{n(t),this.nextUploadIndex+=1}));else{const e=t[0];e&&n(e)}}async uploadFile(t){const{fieldName:e,formId:r,renderer:n,uploadUrl:o}=this,i=t.name,a=this.findUploadByName(i),s=a?a.uploadIndex:this.nextUploadIndex;a||(this.nextUploadIndex+=1),a&&await this.removeExistingUpload(a);const l=(()=>{const{csrfToken:n,s3UploadDir:i}=this;return null!=i?new Un({csrfToken:n,endpoint:o,file:t,s3UploadDir:i,uploadIndex:s}):new Gi({chunkSize:this.chunkSize,csrfToken:this.csrfToken,fieldName:e,file:t,formId:r,retryDelays:this.retryDelays,uploadIndex:s,uploadUrl:o})})();l.onError=t=>this.handleError(l,t),l.onProgress=(t,e)=>this.handleProgress(l,t,e),l.onSuccess=()=>this.handleSuccess(l),l.start(),this.uploads.push(l);const u=n.addNewUpload(i,s);this.emitEvent("addUpload",u,l)}getUploadByIndex(t){return this.uploads.find((e=>e.uploadIndex===t))}findUploadByName(t){return this.uploads.find((e=>e.name===t))}async removeExistingUpload(t){const e=this.renderer.findFileDiv(t.uploadIndex);if(e&&this.emitEvent("removeUpload",e,t),"uploading"===t.status)this.renderer.disableCancel(t.uploadIndex),await t.abort();else if("done"===t.status){this.renderer.disableDelete(t.uploadIndex);try{await t.delete()}catch{return void this.renderer.setDeleteFailed(t.uploadIndex)}}this.removeUploadFromList(t),this.updatePlaceholderInput()}removeUploadFromList(t){this.renderer.deleteFile(t.uploadIndex);const e=this.uploads.indexOf(t);e>=0&&this.uploads.splice(e,1),this.checkDropHint();const{onDelete:r}=this.callbacks;r&&r(t)}async handleCancel(t){this.renderer.disableCancel(t.uploadIndex),await t.abort(),this.removeUploadFromList(t)}initDropArea(t,e){new On({container:t,inputAccept:e,onUploadFiles:this.uploadFiles,renderer:this.renderer})}checkDropHint(){if(!this.supportDropArea)return;0===this.uploads.filter((t=>t)).length?this.renderer.renderDropHint():this.renderer.removeDropHint()}updatePlaceholderInput(){const t=a(this.form,s(this.fieldName,this.prefix),this.prefix);if(!t)return;const e=this.uploads.map((t=>t.getInitialFile()));t.value=JSON.stringify(e)}getMetaDataField(){return a(this.form,(t=this.fieldName,e=this.prefix,`${i(t,e)}-metadata`),this.prefix);var t,e}emitEvent(t,e,r){this.eventEmitter&&this.eventEmitter.emit(t,{element:e,fieldName:this.fieldName,fileName:r.name,metaDataField:this.getMetaDataField(),upload:r})}}const Xi=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=()=>e&&e.prefix?e.prefix:null,n=e=>l(t,e,r()),o=n("upload_url"),i=n("form_id"),u=n("s3_upload_dir"),c=e.skipRequired||!1,p=r(),f=a(t,"csrfmiddlewaretoken",null)?.value;if(!f)throw Error("Csrf token not found");i&&o&&t.querySelectorAll(".dff-uploader").forEach((a=>{const l=a.querySelector(".dff-container");if(!l)return;const d=l.querySelector("input[type=file]");if(!d||!(t=>!e||!e.prefix||t.startsWith(`${e.prefix}-`))(d.name))return;const h=d.name,{multiple:m}=d,y=(t=>{const e=n(s(t,r()));return e?JSON.parse(e):[]})(h),v=l.getAttribute("data-translations"),g=v?JSON.parse(v):{},b=!(!1===e.supportDropArea);new Ki({callbacks:e.callbacks||{},chunkSize:e.chunkSize||2621440,csrfToken:f,eventEmitter:e.eventEmitter,fieldName:h,form:t,formId:i,s3UploadDir:u||null,initial:y,input:d,multiple:m,parent:l,prefix:p,retryDelays:e.retryDelays||null,skipRequired:c,supportDropArea:b,translations:g,uploadUrl:o})}))};window.autoInitFileForms=()=>{const e=window.initUploadFields;var r;(r=Array.from(document.querySelectorAll(".dff-uploader")).map(t),Array.from(new Set(r).values())).forEach(e)},window.initFormSet=(t,e)=>{let r;r="string"==typeof e?{prefix:e}:e;const n=r.prefix||"form",i=l(t,"TOTAL_FORMS",n);if(!i)return;const a=parseInt(i,10);for(let e=0;e<a;e+=1){const i=o(`${e}`,null);Xi(t,{...r,prefix:`${n}-${i}`})}},window.initUploadFields=Xi}();
//# sourceMappingURL=file_form.min.js.map
