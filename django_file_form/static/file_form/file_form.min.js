!function(){const e=t=>{const s=t.parentElement;return s?"FORM"===s.tagName?s:e(s):null},t={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(t);var s,o,i,n=window&&window.__classPrivateFieldGet||function(e,t,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(e):o?o.value:t.get(e)};s=new WeakMap,o=new WeakMap,i=new WeakMap;var r=new class{constructor(...e){s.set(this,new Map),o.set(this,new Map),i.set(this,new Map);for(const t of e)this.define(t)}define(e,t=!1){for(let[r,a]of Object.entries(e)){r=r.toLowerCase(),a=a.map((e=>e.toLowerCase())),n(this,i,"f").has(r)||n(this,i,"f").set(r,new Set);const e=n(this,i,"f").get(r);let l=!0;for(let i of a){const a=i.startsWith("*");if(i=a?i.slice(1):i,e?.add(i),l&&n(this,o,"f").set(r,i),l=!1,a)continue;const p=n(this,s,"f").get(i);if(p&&p!=r&&!t)throw new Error(`"${r} -> ${i}" conflicts with "${p} -> ${i}". Pass \`force=true\` to override this definition.`);n(this,s,"f").set(i,r)}}return this}getType(e){if("string"!=typeof e)return null;const t=e.replace(/^.*[/\\]/,"").toLowerCase(),o=t.replace(/^.*\./,"").toLowerCase(),i=t.length<e.length;return!(o.length<t.length-1)&&i?null:n(this,s,"f").get(o)??null}getExtension(e){return"string"!=typeof e?null:(e=e?.split?.(";")[0],(e&&n(this,o,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return"string"!=typeof e?null:n(this,i,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of n(this,i,"f").values())Object.freeze(e);return this}_getTestState(){return{types:n(this,s,"f"),extensions:n(this,o,"f")}}}(t)._freeze(),a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p,c,u,d,h,f,m,g,x,y,v,_={};function b(){if(c)return p;c=1;const e="\\\\/",t=`[^${e}]`,s="\\.",o="\\/",i="[^/]",n=`(?:${o}|$)`,r=`(?:^|${o})`,a=`${s}{1,2}${n}`,l={DOT_LITERAL:s,PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:o,ONE_CHAR:"(?=.)",QMARK:i,END_ANCHOR:n,DOTS_SLASH:a,NO_DOT:`(?!${s})`,NO_DOTS:`(?!${r}${a})`,NO_DOT_SLASH:`(?!${s}{0,1}${n})`,NO_DOTS_SLASH:`(?!${a})`,QMARK_NO_DOT:`[^.${o}]`,STAR:`${i}*?`,START_ANCHOR:r,SEP:"/"},u={...l,SLASH_LITERAL:`[${e}]`,QMARK:t,STAR:`${t}*?`,DOTS_SLASH:`${s}{1,2}(?:[${e}]|$)`,NO_DOT:`(?!${s})`,NO_DOTS:`(?!(?:^|[${e}])${s}{1,2}(?:[${e}]|$))`,NO_DOT_SLASH:`(?!${s}{0,1}(?:[${e}]|$))`,NO_DOTS_SLASH:`(?!${s}{1,2}(?:[${e}]|$))`,QMARK_NO_DOT:`[^.${e}]`,START_ANCHOR:`(?:^|[${e}])`,END_ANCHOR:`(?:[${e}]|$)`,SEP:"\\"};return p={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,extglobChars:e=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:e=>!0===e?u:l}}function E(){return u||(u=1,function(e){const{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:s,REGEX_SPECIAL_CHARS:o,REGEX_SPECIAL_CHARS_GLOBAL:i}=b();e.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),e.hasRegexChars=e=>o.test(e),e.isRegexChar=t=>1===t.length&&e.hasRegexChars(t),e.escapeRegex=e=>e.replace(i,"\\$1"),e.toPosixSlashes=e=>e.replace(t,"/"),e.isWindows=()=>{if("undefined"!=typeof navigator&&navigator.platform){const e=navigator.platform.toLowerCase();return"win32"===e||"windows"===e}return!("undefined"==typeof process||!process.platform)&&"win32"===process.platform},e.removeBackslashes=e=>e.replace(s,(e=>"\\"===e?"":e)),e.escapeLast=(t,s,o)=>{const i=t.lastIndexOf(s,o);return-1===i?t:"\\"===t[i-1]?e.escapeLast(t,s,i-1):`${t.slice(0,i)}\\${t.slice(i)}`},e.removePrefix=(e,t={})=>{let s=e;return s.startsWith("./")&&(s=s.slice(2),t.prefix="./"),s},e.wrapOutput=(e,t={},s={})=>{let o=`${s.contains?"":"^"}(?:${e})${s.contains?"":"$"}`;return!0===t.negated&&(o=`(?:^(?!${o}).*$)`),o},e.basename=(e,{windows:t}={})=>{const s=e.split(t?/[\\/]/:"/"),o=s[s.length-1];return""===o?s[s.length-2]:o}}(_)),_}function S(){if(h)return d;h=1;const e=E(),{CHAR_ASTERISK:t,CHAR_AT:s,CHAR_BACKWARD_SLASH:o,CHAR_COMMA:i,CHAR_DOT:n,CHAR_EXCLAMATION_MARK:r,CHAR_FORWARD_SLASH:a,CHAR_LEFT_CURLY_BRACE:l,CHAR_LEFT_PARENTHESES:p,CHAR_LEFT_SQUARE_BRACKET:c,CHAR_PLUS:u,CHAR_QUESTION_MARK:f,CHAR_RIGHT_CURLY_BRACE:m,CHAR_RIGHT_PARENTHESES:g,CHAR_RIGHT_SQUARE_BRACKET:x}=b(),y=e=>e===a||e===o,v=e=>{!0!==e.isPrefix&&(e.depth=e.isGlobstar?1/0:1)};return d=(d,h)=>{const _=h||{},b=d.length-1,E=!0===_.parts||!0===_.scanToEnd,S=[],R=[],w=[];let A,k,C=d,U=-1,T=0,I=0,$=!1,H=!1,L=!1,D=!1,P=!1,O=!1,N=!1,j=!1,F=!1,z=!1,q=0,M={value:"",depth:0,isGlob:!1};const B=()=>U>=b,G=()=>(A=k,C.charCodeAt(++U));for(;U<b;){let e;if(k=G(),k!==o){if(!0===O||k===l){for(q++;!0!==B()&&(k=G());)if(k!==o)if(k!==l){if(!0!==O&&k===n&&(k=G())===n){if($=M.isBrace=!0,L=M.isGlob=!0,z=!0,!0===E)continue;break}if(!0!==O&&k===i){if($=M.isBrace=!0,L=M.isGlob=!0,z=!0,!0===E)continue;break}if(k===m&&(q--,0===q)){O=!1,$=M.isBrace=!0,z=!0;break}}else q++;else N=M.backslashes=!0,G();if(!0===E)continue;break}if(k!==a){if(!0!==_.noext){if(!0===(k===u||k===s||k===t||k===f||k===r)&&C.charCodeAt(U+1)===p){if(L=M.isGlob=!0,D=M.isExtglob=!0,z=!0,k===r&&U===T&&(F=!0),!0===E){for(;!0!==B()&&(k=G());)if(k!==o){if(k===g){L=M.isGlob=!0,z=!0;break}}else N=M.backslashes=!0,k=G();continue}break}}if(k===t){if(A===t&&(P=M.isGlobstar=!0),L=M.isGlob=!0,z=!0,!0===E)continue;break}if(k===f){if(L=M.isGlob=!0,z=!0,!0===E)continue;break}if(k===c){for(;!0!==B()&&(e=G());)if(e!==o){if(e===x){H=M.isBracket=!0,L=M.isGlob=!0,z=!0;break}}else N=M.backslashes=!0,G();if(!0===E)continue;break}if(!0===_.nonegate||k!==r||U!==T){if(!0!==_.noparen&&k===p){if(L=M.isGlob=!0,!0===E){for(;!0!==B()&&(k=G());)if(k!==p){if(k===g){z=!0;break}}else N=M.backslashes=!0,k=G();continue}break}if(!0===L){if(z=!0,!0===E)continue;break}}else j=M.negated=!0,T++}else{if(S.push(U),R.push(M),M={value:"",depth:0,isGlob:!1},!0===z)continue;if(A===n&&U===T+1){T+=2;continue}I=U+1}}else N=M.backslashes=!0,k=G(),k===l&&(O=!0)}!0===_.noext&&(D=!1,L=!1);let K=C,X="",Q="";T>0&&(X=C.slice(0,T),C=C.slice(T),I-=T),K&&!0===L&&I>0?(K=C.slice(0,I),Q=C.slice(I)):!0===L?(K="",Q=C):K=C,K&&""!==K&&"/"!==K&&K!==C&&y(K.charCodeAt(K.length-1))&&(K=K.slice(0,-1)),!0===_.unescape&&(Q&&(Q=e.removeBackslashes(Q)),K&&!0===N&&(K=e.removeBackslashes(K)));const W={prefix:X,input:d,start:T,base:K,glob:Q,isBrace:$,isBracket:H,isGlob:L,isExtglob:D,isGlobstar:P,negated:j,negatedExtglob:F};if(!0===_.tokens&&(W.maxDepth=0,y(k)||R.push(M),W.tokens=R),!0===_.parts||!0===_.tokens){let e;for(let t=0;t<S.length;t++){const s=e?e+1:T,o=S[t],i=d.slice(s,o);_.tokens&&(0===t&&0!==T?(R[t].isPrefix=!0,R[t].value=X):R[t].value=i,v(R[t]),W.maxDepth+=R[t].depth),0===t&&""===i||w.push(i),e=o}if(e&&e+1<d.length){const t=d.slice(e+1);w.push(t),_.tokens&&(R[R.length-1].value=t,v(R[R.length-1]),W.maxDepth+=R[R.length-1].depth)}W.slashes=S,W.parts=w}return W}}function R(){if(m)return f;m=1;const e=b(),t=E(),{MAX_LENGTH:s,POSIX_REGEX_SOURCE:o,REGEX_NON_SPECIAL_CHARS:i,REGEX_SPECIAL_CHARS_BACKREF:n,REPLACEMENTS:r}=e,a=(e,s)=>{if("function"==typeof s.expandRange)return s.expandRange(...e,s);e.sort();const o=`[${e.join("-")}]`;try{new RegExp(o)}catch(s){return e.map((e=>t.escapeRegex(e))).join("..")}return o},l=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,p=(c,u)=>{if("string"!=typeof c)throw new TypeError("Expected a string");c=r[c]||c;const d={...u},h="number"==typeof d.maxLength?Math.min(s,d.maxLength):s;let f=c.length;if(f>h)throw new SyntaxError(`Input length: ${f}, exceeds maximum allowed length: ${h}`);const m={type:"bos",value:"",output:d.prepend||""},g=[m],x=d.capture?"":"?:",y=e.globChars(d.windows),v=e.extglobChars(y),{DOT_LITERAL:_,PLUS_LITERAL:b,SLASH_LITERAL:E,ONE_CHAR:S,DOTS_SLASH:R,NO_DOT:w,NO_DOT_SLASH:A,NO_DOTS_SLASH:k,QMARK:C,QMARK_NO_DOT:U,STAR:T,START_ANCHOR:I}=y,$=e=>`(${x}(?:(?!${I}${e.dot?R:_}).)*?)`,H=d.dot?"":w,L=d.dot?C:U;let D=!0===d.bash?$(d):T;d.capture&&(D=`(${D})`),"boolean"==typeof d.noext&&(d.noextglob=d.noext);const P={input:c,index:-1,start:0,dot:!0===d.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:g};c=t.removePrefix(c,P),f=c.length;const O=[],N=[],j=[];let F,z=m;const q=()=>P.index===f-1,M=P.peek=(e=1)=>c[P.index+e],B=P.advance=()=>c[++P.index]||"",G=()=>c.slice(P.index+1),K=(e="",t=0)=>{P.consumed+=e,P.index+=t},X=e=>{P.output+=null!=e.output?e.output:e.value,K(e.value)},Q=()=>{let e=1;for(;"!"===M()&&("("!==M(2)||"?"===M(3));)B(),P.start++,e++;return e%2!=0&&(P.negated=!0,P.start++,!0)},W=e=>{P[e]++,j.push(e)},Z=e=>{P[e]--,j.pop()},J=e=>{if("globstar"===z.type){const t=P.braces>0&&("comma"===e.type||"brace"===e.type),s=!0===e.extglob||O.length&&("pipe"===e.type||"paren"===e.type);"slash"===e.type||"paren"===e.type||t||s||(P.output=P.output.slice(0,-z.output.length),z.type="star",z.value="*",z.output=D,P.output+=z.output)}if(O.length&&"paren"!==e.type&&(O[O.length-1].inner+=e.value),(e.value||e.output)&&X(e),z&&"text"===z.type&&"text"===e.type)return z.output=(z.output||z.value)+e.value,void(z.value+=e.value);e.prev=z,g.push(e),z=e},V=(e,t)=>{const s={...v[t],conditions:1,inner:""};s.prev=z,s.parens=P.parens,s.output=P.output;const o=(d.capture?"(":"")+s.open;W("parens"),J({type:e,value:t,output:P.output?"":S}),J({type:"paren",extglob:!0,value:B(),output:o}),O.push(s)},Y=e=>{let t,s=e.close+(d.capture?")":"");if("negate"===e.type){let o=D;if(e.inner&&e.inner.length>1&&e.inner.includes("/")&&(o=$(d)),(o!==D||q()||/^\)+$/.test(G()))&&(s=e.close=`)$))${o}`),e.inner.includes("*")&&(t=G())&&/^\.[^\\/.]+$/.test(t)){const i=p(t,{...u,fastpaths:!1}).output;s=e.close=`)${i})${o})`}"bos"===e.prev.type&&(P.negatedExtglob=!0)}J({type:"paren",extglob:!0,value:F,output:s}),Z("parens")};if(!1!==d.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(c)){let e=!1,s=c.replace(n,((t,s,o,i,n,r)=>"\\"===i?(e=!0,t):"?"===i?s?s+i+(n?C.repeat(n.length):""):0===r?L+(n?C.repeat(n.length):""):C.repeat(o.length):"."===i?_.repeat(o.length):"*"===i?s?s+i+(n?D:""):D:s?t:`\\${t}`));return!0===e&&(s=!0===d.unescape?s.replace(/\\/g,""):s.replace(/\\+/g,(e=>e.length%2==0?"\\\\":e?"\\":""))),s===c&&!0===d.contains?(P.output=c,P):(P.output=t.wrapOutput(s,P,u),P)}for(;!q();){if(F=B(),"\0"===F)continue;if("\\"===F){const e=M();if("/"===e&&!0!==d.bash)continue;if("."===e||";"===e)continue;if(!e){F+="\\",J({type:"text",value:F});continue}const t=/^\\+/.exec(G());let s=0;if(t&&t[0].length>2&&(s=t[0].length,P.index+=s,s%2!=0&&(F+="\\")),!0===d.unescape?F=B():F+=B(),0===P.brackets){J({type:"text",value:F});continue}}if(P.brackets>0&&("]"!==F||"["===z.value||"[^"===z.value)){if(!1!==d.posix&&":"===F){const e=z.value.slice(1);if(e.includes("[")&&(z.posix=!0,e.includes(":"))){const e=z.value.lastIndexOf("["),t=z.value.slice(0,e),s=z.value.slice(e+2),i=o[s];if(i){z.value=t+i,P.backtrack=!0,B(),m.output||1!==g.indexOf(z)||(m.output=S);continue}}}("["===F&&":"!==M()||"-"===F&&"]"===M())&&(F=`\\${F}`),"]"!==F||"["!==z.value&&"[^"!==z.value||(F=`\\${F}`),!0===d.posix&&"!"===F&&"["===z.value&&(F="^"),z.value+=F,X({value:F});continue}if(1===P.quotes&&'"'!==F){F=t.escapeRegex(F),z.value+=F,X({value:F});continue}if('"'===F){P.quotes=1===P.quotes?0:1,!0===d.keepQuotes&&J({type:"text",value:F});continue}if("("===F){W("parens"),J({type:"paren",value:F});continue}if(")"===F){if(0===P.parens&&!0===d.strictBrackets)throw new SyntaxError(l("opening","("));const e=O[O.length-1];if(e&&P.parens===e.parens+1){Y(O.pop());continue}J({type:"paren",value:F,output:P.parens?")":"\\)"}),Z("parens");continue}if("["===F){if(!0!==d.nobracket&&G().includes("]"))W("brackets");else{if(!0!==d.nobracket&&!0===d.strictBrackets)throw new SyntaxError(l("closing","]"));F=`\\${F}`}J({type:"bracket",value:F});continue}if("]"===F){if(!0===d.nobracket||z&&"bracket"===z.type&&1===z.value.length){J({type:"text",value:F,output:`\\${F}`});continue}if(0===P.brackets){if(!0===d.strictBrackets)throw new SyntaxError(l("opening","["));J({type:"text",value:F,output:`\\${F}`});continue}Z("brackets");const e=z.value.slice(1);if(!0===z.posix||"^"!==e[0]||e.includes("/")||(F=`/${F}`),z.value+=F,X({value:F}),!1===d.literalBrackets||t.hasRegexChars(e))continue;const s=t.escapeRegex(z.value);if(P.output=P.output.slice(0,-z.value.length),!0===d.literalBrackets){P.output+=s,z.value=s;continue}z.value=`(${x}${s}|${z.value})`,P.output+=z.value;continue}if("{"===F&&!0!==d.nobrace){W("braces");const e={type:"brace",value:F,output:"(",outputIndex:P.output.length,tokensIndex:P.tokens.length};N.push(e),J(e);continue}if("}"===F){const e=N[N.length-1];if(!0===d.nobrace||!e){J({type:"text",value:F,output:F});continue}let t=")";if(!0===e.dots){const e=g.slice(),s=[];for(let t=e.length-1;t>=0&&(g.pop(),"brace"!==e[t].type);t--)"dots"!==e[t].type&&s.unshift(e[t].value);t=a(s,d),P.backtrack=!0}if(!0!==e.comma&&!0!==e.dots){const s=P.output.slice(0,e.outputIndex),o=P.tokens.slice(e.tokensIndex);e.value=e.output="\\{",F=t="\\}",P.output=s;for(const e of o)P.output+=e.output||e.value}J({type:"brace",value:F,output:t}),Z("braces"),N.pop();continue}if("|"===F){O.length>0&&O[O.length-1].conditions++,J({type:"text",value:F});continue}if(","===F){let e=F;const t=N[N.length-1];t&&"braces"===j[j.length-1]&&(t.comma=!0,e="|"),J({type:"comma",value:F,output:e});continue}if("/"===F){if("dot"===z.type&&P.index===P.start+1){P.start=P.index+1,P.consumed="",P.output="",g.pop(),z=m;continue}J({type:"slash",value:F,output:E});continue}if("."===F){if(P.braces>0&&"dot"===z.type){"."===z.value&&(z.output=_);const e=N[N.length-1];z.type="dots",z.output+=F,z.value+=F,e.dots=!0;continue}if(P.braces+P.parens===0&&"bos"!==z.type&&"slash"!==z.type){J({type:"text",value:F,output:_});continue}J({type:"dot",value:F,output:_});continue}if("?"===F){if(!(z&&"("===z.value)&&!0!==d.noextglob&&"("===M()&&"?"!==M(2)){V("qmark",F);continue}if(z&&"paren"===z.type){const e=M();let t=F;("("===z.value&&!/[!=<:]/.test(e)||"<"===e&&!/<([!=]|\w+>)/.test(G()))&&(t=`\\${F}`),J({type:"text",value:F,output:t});continue}if(!0!==d.dot&&("slash"===z.type||"bos"===z.type)){J({type:"qmark",value:F,output:U});continue}J({type:"qmark",value:F,output:C});continue}if("!"===F){if(!0!==d.noextglob&&"("===M()&&("?"!==M(2)||!/[!=<:]/.test(M(3)))){V("negate",F);continue}if(!0!==d.nonegate&&0===P.index){Q();continue}}if("+"===F){if(!0!==d.noextglob&&"("===M()&&"?"!==M(2)){V("plus",F);continue}if(z&&"("===z.value||!1===d.regex){J({type:"plus",value:F,output:b});continue}if(z&&("bracket"===z.type||"paren"===z.type||"brace"===z.type)||P.parens>0){J({type:"plus",value:F});continue}J({type:"plus",value:b});continue}if("@"===F){if(!0!==d.noextglob&&"("===M()&&"?"!==M(2)){J({type:"at",extglob:!0,value:F,output:""});continue}J({type:"text",value:F});continue}if("*"!==F){"$"!==F&&"^"!==F||(F=`\\${F}`);const e=i.exec(G());e&&(F+=e[0],P.index+=e[0].length),J({type:"text",value:F});continue}if(z&&("globstar"===z.type||!0===z.star)){z.type="star",z.star=!0,z.value+=F,z.output=D,P.backtrack=!0,P.globstar=!0,K(F);continue}let e=G();if(!0!==d.noextglob&&/^\([^?]/.test(e)){V("star",F);continue}if("star"===z.type){if(!0===d.noglobstar){K(F);continue}const t=z.prev,s=t.prev,o="slash"===t.type||"bos"===t.type,i=s&&("star"===s.type||"globstar"===s.type);if(!0===d.bash&&(!o||e[0]&&"/"!==e[0])){J({type:"star",value:F,output:""});continue}const n=P.braces>0&&("comma"===t.type||"brace"===t.type),r=O.length&&("pipe"===t.type||"paren"===t.type);if(!o&&"paren"!==t.type&&!n&&!r){J({type:"star",value:F,output:""});continue}for(;"/**"===e.slice(0,3);){const t=c[P.index+4];if(t&&"/"!==t)break;e=e.slice(3),K("/**",3)}if("bos"===t.type&&q()){z.type="globstar",z.value+=F,z.output=$(d),P.output=z.output,P.globstar=!0,K(F);continue}if("slash"===t.type&&"bos"!==t.prev.type&&!i&&q()){P.output=P.output.slice(0,-(t.output+z.output).length),t.output=`(?:${t.output}`,z.type="globstar",z.output=$(d)+(d.strictSlashes?")":"|$)"),z.value+=F,P.globstar=!0,P.output+=t.output+z.output,K(F);continue}if("slash"===t.type&&"bos"!==t.prev.type&&"/"===e[0]){const s=void 0!==e[1]?"|$":"";P.output=P.output.slice(0,-(t.output+z.output).length),t.output=`(?:${t.output}`,z.type="globstar",z.output=`${$(d)}${E}|${E}${s})`,z.value+=F,P.output+=t.output+z.output,P.globstar=!0,K(F+B()),J({type:"slash",value:"/",output:""});continue}if("bos"===t.type&&"/"===e[0]){z.type="globstar",z.value+=F,z.output=`(?:^|${E}|${$(d)}${E})`,P.output=z.output,P.globstar=!0,K(F+B()),J({type:"slash",value:"/",output:""});continue}P.output=P.output.slice(0,-z.output.length),z.type="globstar",z.output=$(d),z.value+=F,P.output+=z.output,P.globstar=!0,K(F);continue}const s={type:"star",value:F,output:D};!0!==d.bash?!z||"bracket"!==z.type&&"paren"!==z.type||!0!==d.regex?(P.index!==P.start&&"slash"!==z.type&&"dot"!==z.type||("dot"===z.type?(P.output+=A,z.output+=A):!0===d.dot?(P.output+=k,z.output+=k):(P.output+=H,z.output+=H),"*"!==M()&&(P.output+=S,z.output+=S)),J(s)):(s.output=F,J(s)):(s.output=".*?","bos"!==z.type&&"slash"!==z.type||(s.output=H+s.output),J(s))}for(;P.brackets>0;){if(!0===d.strictBrackets)throw new SyntaxError(l("closing","]"));P.output=t.escapeLast(P.output,"["),Z("brackets")}for(;P.parens>0;){if(!0===d.strictBrackets)throw new SyntaxError(l("closing",")"));P.output=t.escapeLast(P.output,"("),Z("parens")}for(;P.braces>0;){if(!0===d.strictBrackets)throw new SyntaxError(l("closing","}"));P.output=t.escapeLast(P.output,"{"),Z("braces")}if(!0===d.strictSlashes||"star"!==z.type&&"bracket"!==z.type||J({type:"maybe_slash",value:"",output:`${E}?`}),!0===P.backtrack){P.output="";for(const e of P.tokens)P.output+=null!=e.output?e.output:e.value,e.suffix&&(P.output+=e.suffix)}return P};return p.fastpaths=(o,i)=>{const n={...i},a="number"==typeof n.maxLength?Math.min(s,n.maxLength):s,l=o.length;if(l>a)throw new SyntaxError(`Input length: ${l}, exceeds maximum allowed length: ${a}`);o=r[o]||o;const{DOT_LITERAL:p,SLASH_LITERAL:c,ONE_CHAR:u,DOTS_SLASH:d,NO_DOT:h,NO_DOTS:f,NO_DOTS_SLASH:m,STAR:g,START_ANCHOR:x}=e.globChars(n.windows),y=n.dot?f:h,v=n.dot?m:h,_=n.capture?"":"?:";let b=!0===n.bash?".*?":g;n.capture&&(b=`(${b})`);const E=e=>!0===e.noglobstar?b:`(${_}(?:(?!${x}${e.dot?d:p}).)*?)`,S=e=>{switch(e){case"*":return`${y}${u}${b}`;case".*":return`${p}${u}${b}`;case"*.*":return`${y}${b}${p}${u}${b}`;case"*/*":return`${y}${b}${c}${u}${v}${b}`;case"**":return y+E(n);case"**/*":return`(?:${y}${E(n)}${c})?${v}${u}${b}`;case"**/*.*":return`(?:${y}${E(n)}${c})?${v}${b}${p}${u}${b}`;case"**/.*":return`(?:${y}${E(n)}${c})?${p}${u}${b}`;default:{const t=/^(.*?)\.(\w+)$/.exec(e);if(!t)return;const s=S(t[1]);if(!s)return;return s+p+t[2]}}},R=t.removePrefix(o,{negated:!1,prefix:""});let w=S(R);return w&&!0!==n.strictSlashes&&(w+=`${c}?`),w},f=p}function w(){if(x)return g;x=1;const e=S(),t=R(),s=E(),o=b(),i=(e,t,s=!1)=>{if(Array.isArray(e)){const o=e.map((e=>i(e,t,s))),n=e=>{for(const t of o){const s=t(e);if(s)return s}return!1};return n}const o=(n=e)&&"object"==typeof n&&!Array.isArray(n)&&e.tokens&&e.input;var n;if(""===e||"string"!=typeof e&&!o)throw new TypeError("Expected pattern to be a non-empty string");const r=t||{},a=r.windows,l=o?i.compileRe(e,t):i.makeRe(e,t,!1,!0),p=l.state;delete l.state;let c=()=>!1;if(r.ignore){const e={...t,ignore:null,onMatch:null,onResult:null};c=i(r.ignore,e,s)}const u=(s,o=!1)=>{const{isMatch:n,match:u,output:d}=i.test(s,l,t,{glob:e,posix:a}),h={glob:e,state:p,regex:l,posix:a,input:s,output:d,match:u,isMatch:n};return"function"==typeof r.onResult&&r.onResult(h),!1===n?(h.isMatch=!1,!!o&&h):c(s)?("function"==typeof r.onIgnore&&r.onIgnore(h),h.isMatch=!1,!!o&&h):("function"==typeof r.onMatch&&r.onMatch(h),!o||h)};return s&&(u.state=p),u};return i.test=(e,t,o,{glob:n,posix:r}={})=>{if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(""===e)return{isMatch:!1,output:""};const a=o||{},l=a.format||(r?s.toPosixSlashes:null);let p=e===n,c=p&&l?l(e):e;return!1===p&&(c=l?l(e):e,p=c===n),!1!==p&&!0!==a.capture||(p=!0===a.matchBase||!0===a.basename?i.matchBase(e,t,o,r):t.exec(c)),{isMatch:Boolean(p),match:p,output:c}},i.matchBase=(e,t,o)=>(t instanceof RegExp?t:i.makeRe(t,o)).test(s.basename(e)),i.isMatch=(e,t,s)=>i(t,s)(e),i.parse=(e,s)=>Array.isArray(e)?e.map((e=>i.parse(e,s))):t(e,{...s,fastpaths:!1}),i.scan=(t,s)=>e(t,s),i.compileRe=(e,t,s=!1,o=!1)=>{if(!0===s)return e.output;const n=t||{},r=n.contains?"":"^",a=n.contains?"":"$";let l=`${r}(?:${e.output})${a}`;e&&!0===e.negated&&(l=`^(?!${l}).*$`);const p=i.toRegex(l,t);return!0===o&&(p.state=e),p},i.makeRe=(e,s={},o=!1,n=!1)=>{if(!e||"string"!=typeof e)throw new TypeError("Expected a non-empty string");let r={negated:!1,fastpaths:!0};return!1===s.fastpaths||"."!==e[0]&&"*"!==e[0]||(r.output=t.fastpaths(e,s)),r.output||(r=t(e,s)),i.compileRe(r,s,o,n)},i.toRegex=(e,t)=>{try{const s=t||{};return new RegExp(e,s.flags||(s.nocase?"i":""))}catch(e){if(t&&!0===t.debug)throw e;return/$^/}},i.constants=o,g=i}function A(){return v?y:(v=1,y=w())}var k=l(A());class C{constructor(e){const[t,s]=(e=>{const t=[],s=[];return e.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{e.startsWith(".")?t.push(`*${e}`):s.push(e)})),[t,s]})(e);this.extensions=t,this.mimeTypes=s}isAccepted(e){return 0===this.extensions.length&&0===this.mimeTypes.length||(this.isMimeTypeAccepted(r.getType(e))||this.isExtensionAccepted(e))}isExtensionAccepted(e){return 0!==this.extensions.length&&k.isMatch(e,this.extensions)}isMimeTypeAccepted(e){return!(!e||0===this.mimeTypes.length)&&k.isMatch(e,this.mimeTypes)}}const U=async e=>{const t=[];if(e.isFile){const s=await(async e=>new Promise(((t,s)=>{e.file(t,s)})))(e);t.push(s)}else if(e.isDirectory){const s=await(async e=>new Promise(((t,s)=>{e.createReader().readEntries(t,s)})))(e),o=await(async e=>{const t=[];for(const s of e)(await U(s)).forEach((e=>t.push(e)));return t})(s);o.forEach((e=>t.push(e)))}return t};class T{constructor(e){let{container:t,inputAccept:s,onUploadFiles:o,renderer:i}=e;this.container=t,this.onUploadFiles=o,this.acceptedFileTypes=new C(s),this.renderer=i,t.addEventListener("dragenter",(()=>{t.classList.add("dff-dropping")})),t.addEventListener("dragleave",(()=>{t.classList.remove("dff-dropping")})),t.addEventListener("dragover",(e=>{t.classList.add("dff-dropping"),e.preventDefault()})),t.addEventListener("drop",this.onDrop)}onDrop=e=>{const t=e;this.container.classList.remove("dff-dropping"),t.preventDefault(),t.stopPropagation();(async()=>{try{if(t.dataTransfer){const e=await(async e=>{if(e.items){const t=[];for(const s of e.items){const e=s.webkitGetAsEntry();if(e)(await U(e)).forEach((e=>t.push(e)));else{const e=s.getAsFile();e&&t.push(e)}}return t}return[...e.files]})(t.dataTransfer),s=[],o=[];for(const t of e)this.acceptedFileTypes.isAccepted(t.name)?s.push(t):o.push(t);this.renderer.setErrorInvalidFiles(o),this.onUploadFiles(s)}}catch(e){console.error(e)}})()}}
/*!
   * escape-html
   * Copyright(c) 2012-2013 TJ Holowaychuk
   * Copyright(c) 2015 Andreas Lubbe
   * Copyright(c) 2015 Tiancheng "Timothy" Gu
   * MIT Licensed
   */var I,$;var H=function(){if($)return I;$=1;var e=/["'&<>]/;return I=function(t){var s,o=""+t,i=e.exec(o);if(!i)return o;var n="",r=0,a=0;for(r=i.index;r<o.length;r++){switch(o.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 39:s="&#39;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}a!==r&&(n+=o.substring(a,r)),a=r+1,n+=s}return a!==r?n+o.substring(a,r):n},I}(),L=l(H);const D=(e,t)=>t?`${t}-${e}`:e,P=(e,t)=>t?e.slice(t.length+1):e,O=(e,t,s)=>{const o=D(t,s),i=e.querySelector(`[name="${o}"]`);return i||null},N=(e,t)=>`${P(e,t)}-uploads`,j=(e,t,s)=>O(e,t,s)?.value;class F{constructor(e){let{input:t,parent:s,skipRequired:o,translations:i}=e;this.container=this.createFilesContainer(s),this.errors=this.createErrorContainer(s),this.input=t,this.translations=i,o&&(this.input.required=!1)}addNewUpload(e,t){const s=this.addFile(e,t),o=document.createElement("span");o.className="dff-progress";const i=document.createElement("span");i.className="dff-progress-inner",o.appendChild(i),s.appendChild(o);const n=document.createElement("a");return n.className="dff-cancel",n.innerHTML=this.translations.Cancel??"",n.setAttribute("data-index",t.toString()),n.href="#",s.appendChild(n),s}addUploadedFile(e,t,s){const o=this.addFile(e,t);return this.setSuccess(t,s),o}clearInput(){const{input:e}=this;e.value=""}deleteFile(e){const t=this.findFileDiv(e);t&&t.remove()}disableCancel(e){const t=this.findCancelSpan(e);t&&t.classList.add("dff-disabled")}disableDelete(e){const t=this.findDeleteLink(e);t&&t.classList.add("dff-disabled")}findFileDiv(e){return this.container.querySelector(`.dff-file-id-${e.toString()}`)}removeDropHint(){const e=this.container.querySelector(".dff-drop-hint");e&&e.remove()}renderDropHint(){if(this.container.querySelector(".dff-drop-hint"))return;const e=document.createElement("div");e.className="dff-drop-hint",e.innerHTML=this.translations["Drop your files here"]??"",this.container.appendChild(e)}setDeleteFailed(e){this.setErrorMessage(e,this.translations["Delete failed"]??""),this.enableDelete(e)}setError(e){this.setErrorMessage(e,this.translations["Upload failed"]??"");const t=this.findFileDiv(e);t&&t.classList.add("dff-upload-fail"),this.removeProgress(e),this.removeCancel(e)}setErrorInvalidFiles(e){const t=document.createElement("ul");for(const s of e){const e=document.createElement("li"),o=this.translations["Invalid file type"]??"";e.innerText=`${s.name}: ${o}`,e.className="dff-error",t.appendChild(e)}this.errors.replaceChildren(t),this.clearInput()}setSuccess(e,t){const{translations:s}=this,o=this.findFileDiv(e);if(o){if(o.classList.add("dff-upload-success"),null!=t){const e=document.createElement("span");e.innerHTML=((e,t)=>{if(0===e)return"0 Bytes";const s=t,o=Math.floor(Math.log(e)/Math.log(1024)),i=parseFloat((e/1024**o).toFixed(s)),n=["Bytes","KB","MB","GB"][o];return null==n?"":`${i.toString()} ${n}`})(t,2),e.className="dff-filesize",o.appendChild(e)}const i=document.createElement("a");i.innerHTML=s.Delete??"",i.className="dff-delete",i.setAttribute("data-index",e.toString()),i.href="#",o.appendChild(i)}this.removeProgress(e),this.removeCancel(e)}updateProgress(e,t){const s=this.container.querySelector(`.dff-file-id-${e.toString()}`);if(s){const e=s.querySelector(".dff-progress-inner");e&&(e.style.width=`${t}%`)}}addFile(e,t){const s=document.createElement("div");s.className=`dff-file dff-file-id-${t.toString()}`;const o=document.createElement("span");return o.innerHTML=L(e),o.className="dff-filename",o.setAttribute("data-index",t.toString()),s.appendChild(o),this.container.appendChild(s),this.input.required=!1,s}createErrorContainer=e=>{const t=document.createElement("div");return t.className="dff-invalid-files",e.appendChild(t),t};createFilesContainer=e=>{const t=document.createElement("div");return t.className="dff-files",e.appendChild(t),t};enableDelete(e){const t=this.findDeleteLink(e);t&&t.classList.remove("dff-disabled")}findCancelSpan(e){const t=this.findFileDiv(e);return t?t.querySelector(".dff-cancel"):null}findDeleteLink(e){const t=this.findFileDiv(e);return t?t.querySelector(".dff-delete"):t}removeCancel(e){const t=this.findCancelSpan(e);t&&t.remove()}removeProgress(e){const t=this.findFileDiv(e);if(t){const e=t.querySelector(".dff-progress");e&&e.remove()}}setErrorMessage(e,t){const s=this.findFileDiv(e);if(!s)return;const o=s.querySelector(".dff-error");o&&o.remove();const i=document.createElement("span");i.classList.add("dff-error"),i.innerHTML=t,s.appendChild(i)}}let z=class{constructor(e){let{name:t,status:s,type:o,uploadIndex:i}=e;this.name=t,this.status=s,this.type=o,this.uploadIndex=i}async abort(){}async delete(){}};function q(){return function(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var s=e.shift();e[0]=s+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var o=0;o<e.length;o++){var i=e[o];if("string"!=typeof i)throw new TypeError("Url must be a string. Received "+i);""!==i&&(o>0&&(i=i.replace(/^[\/]+/,"")),i=o<e.length-1?i.replace(/[\/]+$/,""):i.replace(/[\/]+$/,"/"),t.push(i))}var n=t.join("/"),r=(n=n.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return r.shift()+(r.length>0?"?":"")+r.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}const M=(e,t)=>{const s=e.indexOf(t);-1!==s&&e.splice(s,1)};class B extends z{constructor(e){let{csrfToken:t,endpoint:s,file:o,s3UploadDir:i,uploadIndex:n}=e;super({name:o.name,status:"uploading",type:"s3",uploadIndex:n}),this.csrfToken=t,this.endpoint=s,this.file=o,this.s3UploadDir=i,this.key=null,this.uploadId=null,this.parts=[],this.createdPromise=Promise.reject(new Error),this.chunks=[],this.chunkState=[],this.uploading=[],this.onError=void 0,this.onProgress=void 0,this.onSuccess=void 0,this.initChunks(),this.createdPromise.catch((()=>({})))}async abort(){this.uploading.slice().forEach((e=>{e.abort()})),this.uploading=[],await this.createdPromise,this.key&&this.uploadId&&await(e=>{let{csrfToken:t,endpoint:s,key:o,uploadId:i}=e;const n=encodeURIComponent(o),r=encodeURIComponent(i),a=new Headers({"X-CSRFToken":t}),l=q(s,r,`?key=${n}`);return fetch(l,{headers:a,method:"delete"}).then((e=>e.json()))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,uploadId:this.uploadId})}async delete(){return Promise.resolve()}getId(){return this.uploadId??void 0}getInitialFile(){return{id:this.uploadId??"",name:this.key??"",original_name:this.file.name,size:this.file.size,type:"s3"}}getSize(){return this.file.size}start(){this.createUpload()}completeUpload(){return this.parts.sort(((e,t)=>e.PartNumber-t.PartNumber)),this.uploadId&&this.key?(e=>{let{csrfToken:t,endpoint:s,key:o,parts:i,uploadId:n}=e;const r=encodeURIComponent(o),a=encodeURIComponent(n),l=new Headers({"X-CSRFToken":t}),p=q(s,a,"complete",`?key=${r}`);return fetch(p,{body:JSON.stringify({parts:i}),headers:l,method:"post"}).then((e=>e.json())).then((e=>e))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,parts:this.parts,uploadId:this.uploadId}).then((()=>{this.onSuccess&&this.onSuccess()}),(e=>{this.handleError(e)})):Promise.resolve()}createUpload(){return this.createdPromise=(e=>{let{csrfToken:t,endpoint:s,file:o,s3UploadDir:i}=e;const n=new Headers({accept:"application/json","content-type":"application/json","X-CSRFToken":t});return fetch(s,{body:JSON.stringify({contentType:o.type,filename:o.name,s3UploadDir:i}),headers:n,method:"post"}).then((e=>e.json())).then((e=>e))})({csrfToken:this.csrfToken,endpoint:this.endpoint,file:this.file,s3UploadDir:this.s3UploadDir}),this.createdPromise.then((e=>{if(!("object"==typeof e&&e&&"string"==typeof e.uploadId&&"string"==typeof e.key))throw new TypeError("AwsS3/Multipart: Got incorrect result from `createMultipartUpload()`, expected an object `{ uploadId, key }`.");this.key=e.key,this.uploadId=e.uploadId,this.uploadParts()})).catch((e=>{this.handleError(e)}))}handleError(e){if(!this.onError)throw e;this.onError(e)}initChunks(){const e=[],t=(s=this.file,Math.ceil(s.size/1e4));var s;const o=Math.max(5242880,Math.ceil(this.file.size/1e4)),i=Math.max(t,o);for(let t=0;t<this.file.size;t+=i){const s=Math.min(this.file.size,t+i);e.push(this.file.slice(t,s))}this.chunks=e,this.chunkState=e.map((()=>({busy:!1,done:!1,uploaded:0})))}onPartComplete(e,t){const s=this.chunkState[e];s&&(s.etag=t,s.done=!0);const o={ETag:t,PartNumber:e+1};this.parts.push(o),this.uploadParts()}onPartProgress(e,t){const s=this.chunkState[e];if(s&&(s.uploaded=t),this.onProgress){const e=this.chunkState.reduce(((e,t)=>e+t.uploaded),0);this.onProgress(e,this.file.size)}}uploadPart(e){const t=this.chunkState[e];return t&&(t.busy=!0),this.key&&this.uploadId?(e=>{let{csrfToken:t,endpoint:s,key:o,number:i,uploadId:n}=e;const r=encodeURIComponent(o),a=new Headers({"X-CSRFToken":t}),l=q(s,n,i.toString(),`?key=${r}`);return fetch(l,{headers:a,method:"get"}).then((e=>e.json())).then((e=>e))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,number:e+1,uploadId:this.uploadId}).then((e=>{if(!("object"==typeof e&&"string"==typeof e.url))throw new TypeError("AwsS3/Multipart: Got incorrect result from `prepareUploadPart()`, expected an object `{ url }`.");return e})).then((t=>{let{url:s}=t;this.uploadPartBytes(e,s)}),(e=>{this.handleError(e)})):Promise.resolve()}uploadPartBytes(e,t){const s=this.chunks[e],o=new XMLHttpRequest;o.open("PUT",t,!0),o.responseType="text",this.uploading.push(o),o.upload.addEventListener("progress",(t=>{t.lengthComputable&&this.onPartProgress(e,t.loaded)})),o.addEventListener("abort",(t=>{M(this.uploading,t.target);const s=this.chunkState[e];s&&(s.busy=!1)})),o.addEventListener("load",(t=>{const o=t.target;M(this.uploading,o);const i=this.chunkState[e];if(i&&(i.busy=!1),o.status<200||o.status>=300)return void this.handleError(new Error("Non 2xx"));this.onPartProgress(e,s?.size??0);const n=o.getResponseHeader("ETag");null!==n?this.onPartComplete(e,n):this.handleError(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."))})),o.addEventListener("error",(t=>{M(this.uploading,t.target);const s=this.chunkState[e];s&&(s.busy=!1);const o=new Error("Unknown error");this.handleError(o)})),o.send(s)}uploadParts(){const e=1-this.uploading.length;if(0===e)return;if(this.chunkState.every((e=>e.done)))return void this.completeUpload();const t=[];for(let s=0;s<this.chunkState.length;s++){const o=this.chunkState[s];if(o&&!o.done&&!o.busy&&(t.push(s),t.length>=e))break}t.forEach((e=>{this.uploadPart(e)}))}}class G extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(super(e),this.originalRequest=s,this.originalResponse=o,this.causingError=t,null!=t&&(e+=`, caused by ${t.toString()}`),null!=s){const t=s.getHeader("X-Request-ID")||"n/a";e+=`, originated from request (method: ${s.getMethod()}, url: ${s.getURL()}, response code: ${o?o.getStatus():"n/a"}, response text: ${o?o.getBody()||"":"n/a"}, request id: ${t})`}this.message=e}}const K="function"==typeof Buffer,X=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),Q=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),W=(e=>{let t={};return e.forEach(((e,s)=>t[e]=s)),t})(Q),Z=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,J=String.fromCharCode.bind(String),V=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),Y=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),ee=e=>{let t,s,o,i,n="";const r=e.length%3;for(let r=0;r<e.length;){if((s=e.charCodeAt(r++))>255||(o=e.charCodeAt(r++))>255||(i=e.charCodeAt(r++))>255)throw new TypeError("invalid character found");t=s<<16|o<<8|i,n+=Q[t>>18&63]+Q[t>>12&63]+Q[t>>6&63]+Q[63&t]}return r?n.slice(0,r-3)+"===".substring(r):n},te="function"==typeof btoa?e=>btoa(e):K?e=>Buffer.from(e,"binary").toString("base64"):ee,se=K?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let s=0,o=e.length;s<o;s+=4096)t.push(J.apply(null,e.subarray(s,s+4096)));return te(t.join(""))},oe=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?J(192|t>>>6)+J(128|63&t):J(224|t>>>12&15)+J(128|t>>>6&63)+J(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return J(240|t>>>18&7)+J(128|t>>>12&63)+J(128|t>>>6&63)+J(128|63&t)},ie=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ne=e=>e.replace(ie,oe),re=K?e=>Buffer.from(e,"utf8").toString("base64"):X?e=>se(X.encode(e)):e=>te(ne(e)),ae=(e,t=!1)=>t?V(re(e)):re(e),le=e=>{if(e=e.replace(/\s+/g,""),!Z.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,s,o,i="";for(let n=0;n<e.length;)t=W[e.charAt(n++)]<<18|W[e.charAt(n++)]<<12|(s=W[e.charAt(n++)])<<6|(o=W[e.charAt(n++)]),i+=64===s?J(t>>16&255):64===o?J(t>>16&255,t>>8&255):J(t>>16&255,t>>8&255,255&t);return i},pe=ae;var ce,ue;var de,he,fe,me={};var ge=function(){if(fe)return he;fe=1;var e=ue?ce:(ue=1,ce=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}),t=function(){if(de)return me;de=1;var e=Object.prototype.hasOwnProperty;function t(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function s(e){try{return encodeURIComponent(e)}catch(e){return null}}return me.stringify=function(t,o){o=o||"";var i,n,r=[];for(n in"string"!=typeof o&&(o="?"),t)if(e.call(t,n)){if((i=t[n])||null!=i&&!isNaN(i)||(i=""),n=s(n),i=s(i),null===n||null===i)continue;r.push(n+"="+i)}return r.length?o+r.join("&"):""},me.parse=function(e){for(var s,o=/([^=?#&]+)=?([^&]*)/g,i={};s=o.exec(e);){var n=t(s[1]),r=t(s[2]);null===n||null===r||n in i||(i[n]=r)}return i},me}(),s=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o=/[\n\r\t]/g,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,n=/:\d+$/,r=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,l=/^[a-zA-Z]:/;function p(e){return(e||"").toString().replace(s,"")}var c=[["#","hash"],["?","query"],function(e,t){return h(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],u={hash:1,query:1};function d(e){var t,s=("undefined"!=typeof window?window:void 0!==a?a:"undefined"!=typeof self?self:{}).location||{},o={},n=typeof(e=e||s);if("blob:"===e.protocol)o=new m(unescape(e.pathname),{});else if("string"===n)for(t in o=new m(e,{}),u)delete o[t];else if("object"===n){for(t in e)t in u||(o[t]=e[t]);void 0===o.slashes&&(o.slashes=i.test(e.href))}return o}function h(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function f(e,t){e=(e=p(e)).replace(o,""),t=t||{};var s,i=r.exec(e),n=i[1]?i[1].toLowerCase():"",a=!!i[2],l=!!i[3],c=0;return a?l?(s=i[2]+i[3]+i[4],c=i[2].length+i[3].length):(s=i[2]+i[4],c=i[2].length):l?(s=i[3]+i[4],c=i[3].length):s=i[4],"file:"===n?c>=2&&(s=s.slice(2)):h(n)?s=i[4]:n?a&&(s=s.slice(2)):c>=2&&h(t.protocol)&&(s=i[4]),{protocol:n,slashes:a||h(n),slashesCount:c,rest:s}}function m(s,i,n){if(s=(s=p(s)).replace(o,""),!(this instanceof m))return new m(s,i,n);var r,a,u,g,x,y,v=c.slice(),_=typeof i,b=this,E=0;for("object"!==_&&"string"!==_&&(n=i,i=null),n&&"function"!=typeof n&&(n=t.parse),r=!(a=f(s||"",i=d(i))).protocol&&!a.slashes,b.slashes=a.slashes||r&&i.slashes,b.protocol=a.protocol||i.protocol||"",s=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||l.test(s))||!a.slashes&&(a.protocol||a.slashesCount<2||!h(b.protocol)))&&(v[3]=[/(.*)/,"pathname"]);E<v.length;E++)"function"!=typeof(g=v[E])?(u=g[0],y=g[1],u!=u?b[y]=s:"string"==typeof u?~(x="@"===u?s.lastIndexOf(u):s.indexOf(u))&&("number"==typeof g[2]?(b[y]=s.slice(0,x),s=s.slice(x+g[2])):(b[y]=s.slice(x),s=s.slice(0,x))):(x=u.exec(s))&&(b[y]=x[1],s=s.slice(0,x.index)),b[y]=b[y]||r&&g[3]&&i[y]||"",g[4]&&(b[y]=b[y].toLowerCase())):s=g(s,b);n&&(b.query=n(b.query)),r&&i.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==i.pathname)&&(b.pathname=function(e,t){if(""===e)return t;for(var s=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=s.length,i=s[o-1],n=!1,r=0;o--;)"."===s[o]?s.splice(o,1):".."===s[o]?(s.splice(o,1),r++):r&&(0===o&&(n=!0),s.splice(o,1),r--);return n&&s.unshift(""),"."!==i&&".."!==i||s.push(""),s.join("/")}(b.pathname,i.pathname)),"/"!==b.pathname.charAt(0)&&h(b.protocol)&&(b.pathname="/"+b.pathname),e(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(x=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,x),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(x+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&h(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}return m.prototype={set:function(s,o,i){var r=this;switch(s){case"query":"string"==typeof o&&o.length&&(o=(i||t.parse)(o)),r[s]=o;break;case"port":r[s]=o,e(o,r.protocol)?o&&(r.host=r.hostname+":"+o):(r.host=r.hostname,r[s]="");break;case"hostname":r[s]=o,r.port&&(o+=":"+r.port),r.host=o;break;case"host":r[s]=o,n.test(o)?(o=o.split(":"),r.port=o.pop(),r.hostname=o.join(":")):(r.hostname=o,r.port="");break;case"protocol":r.protocol=o.toLowerCase(),r.slashes=!i;break;case"pathname":case"hash":if(o){var a="pathname"===s?"/":"#";r[s]=o.charAt(0)!==a?a+o:o}else r[s]=o;break;case"username":case"password":r[s]=encodeURIComponent(o);break;case"auth":var l=o.indexOf(":");~l?(r.username=o.slice(0,l),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=o.slice(l+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(o))}for(var p=0;p<c.length;p++){var u=c[p];u[4]&&(r[u[1]]=r[u[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin="file:"!==r.protocol&&h(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(e){e&&"function"==typeof e||(e=t.stringify);var s,o=this,i=o.host,r=o.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var a=r+(o.protocol&&o.slashes||h(o.protocol)?"//":"");return o.username?(a+=o.username,o.password&&(a+=":"+o.password),a+="@"):o.password?(a+=":"+o.password,a+="@"):"file:"!==o.protocol&&h(o.protocol)&&!i&&"/"!==o.pathname&&(a+="@"),(":"===i[i.length-1]||n.test(o.hostname)&&!o.port)&&(i+=":"),a+=i+o.pathname,(s="object"==typeof o.query?e(o.query):o.query)&&(a+="?"!==s.charAt(0)?"?"+s:s),o.hash&&(a+=o.hash),a}},m.extractProtocol=f,m.location=d,m.trimLeft=p,m.qs=t,he=m}(),xe=l(ge);const ye="tus-v1",ve="ietf-draft-03",_e="ietf-draft-05",be={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Ce,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:ye};class Ee{constructor(e,t){"resume"in t&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=t,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}static terminate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=we("DELETE",e,t);return Ae(s,null,t).then((e=>{if(204!==e.getStatus())throw new G("tus: unexpected response while terminating upload",null,s,e)})).catch((o=>{if(o instanceof G||(o=new G("tus: failed to terminate upload",o,s,null)),!ke(o,0,t))throw o;const i=t.retryDelays[0],n=t.retryDelays.slice(1),r={...t,retryDelays:n};return new Promise((e=>setTimeout(e,i))).then((()=>Ee.terminate(e,r)))}))}findPreviousUploads(){return this.options.fingerprint(this.file,this.options).then((e=>this._urlStorage.findUploadsByFingerprint(e)))}resumeFromPreviousUpload(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}start(){const{file:e}=this;if(!e)return void this._emitError(new Error("tus: no file or stream to upload provided"));if(![ye,ve,_e].includes(this.options.protocol))return void this._emitError(new Error(`tus: unsupported protocol ${this.options.protocol}`));if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url)return void this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));const{retryDelays:t}=this.options;if(null==t||"[object Array]"===Object.prototype.toString.call(t)){if(this.options.parallelUploads>1)for(const e of["uploadUrl","uploadSize","uploadLengthDeferred"])if(this.options[e])return void this._emitError(new Error(`tus: cannot use the ${e} option when parallelUploads is enabled`));if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(e,this.options).then((t=>(this._fingerprint=t,this._source?this._source:this.options.fileReader.openFile(e,this.options.chunkSize)))).then((e=>{if(this._source=e,this.options.uploadLengthDeferred)this._size=null;else if(null!=this.options.uploadSize){if(this._size=Number(this.options.uploadSize),Number.isNaN(this._size))return void this._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(this._size=this._source.size,null==this._size)return void this._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));this.options.parallelUploads>1||null!=this._parallelUploadUrls?this._startParallelUpload():this._startSingleUpload()})).catch((e=>{this._emitError(e)}))}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}_startParallelUpload(){const e=this._size;let t=0;this._parallelUploads=[];const s=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,o=this.options.parallelUploadBoundaries??function(e,t){const s=Math.floor(e/t),o=[];for(let e=0;e<t;e++)o.push({start:s*e,end:s*(e+1)});return o[t-1].end=e,o}(this._source.size,s);this._parallelUploadUrls&&o.forEach(((e,t)=>{e.uploadUrl=this._parallelUploadUrls[t]||null})),this._parallelUploadUrls=new Array(o.length);const i=o.map(((s,i)=>{let n=0;return this._source.slice(s.start,s.end).then((r=>{let{value:a}=r;return new Promise(((r,l)=>{const p={...this.options,uploadUrl:s.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:this.options.metadataForPartialUploads,headers:{...this.options.headers,"Upload-Concat":"partial"},onSuccess:r,onError:l,onProgress:s=>{t=t-n+s,n=s,this._emitProgress(t,e)},onUploadUrlAvailable:()=>{this._parallelUploadUrls[i]=c.url,this._parallelUploadUrls.filter((e=>Boolean(e))).length===o.length&&this._saveUploadInUrlStorage()}},c=new Ee(a,p);c.start(),this._parallelUploads.push(c)}))}))}));let n;Promise.all(i).then((()=>{n=this._openRequest("POST",this.options.endpoint),n.setHeader("Upload-Concat",`final;${this._parallelUploadUrls.join(" ")}`);const e=Se(this.options.metadata);return""!==e&&n.setHeader("Upload-Metadata",e),this._sendRequest(n,null)})).then((e=>{if(!Re(e.getStatus(),200))return void this._emitHttpError(n,e,"tus: unexpected response while creating upload");const t=e.getHeader("Location");null!=t?(this.url=Ue(this.options.endpoint,t),this.url,this._emitSuccess(e)):this._emitHttpError(n,e,"tus: invalid or missing Location header")})).catch((e=>{this._emitError(e)}))}_startSingleUpload(){return this._aborted=!1,null!=this.url?(this.url,void this._resumeUpload()):null!=this.options.uploadUrl?(this.options.uploadUrl,this.url=this.options.uploadUrl,void this._resumeUpload()):void this._createUpload()}abort(e){if(null!=this._parallelUploads)for(const t of this._parallelUploads)t.abort(e);return null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),e&&null!=this.url?Ee.terminate(this.url,this.options).then((()=>this._removeFromUrlStorage())):Promise.resolve()}_emitHttpError(e,t,s,o){this._emitError(new G(s,o,e,t))}_emitError(e){if(!this._aborted){if(null!=this.options.retryDelays){if(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),ke(e,this._retryAttempt,this.options)){const e=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout((()=>{this.start()}),e))}}if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}}_emitSuccess(e){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess({lastResponse:e})}_emitProgress(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}_emitChunkComplete(e,t,s){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,s)}_createUpload(){if(!this.options.endpoint)return void this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));const e=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?e.setHeader("Upload-Defer-Length","1"):e.setHeader("Upload-Length",`${this._size}`);const t=Se(this.options.metadata);let s;""!==t&&e.setHeader("Upload-Metadata",t),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,s=this._addChunkToRequest(e)):(this.options.protocol!==ve&&this.options.protocol!==_e||e.setHeader("Upload-Complete","?0"),s=this._sendRequest(e,null)),s.then((t=>{if(!Re(t.getStatus(),200))return void this._emitHttpError(e,t,"tus: unexpected response while creating upload");const s=t.getHeader("Location");if(null!=s){if(this.url=Ue(this.options.endpoint,s),this.url,"function"==typeof this.options.onUploadUrlAvailable&&this.options.onUploadUrlAvailable(),0===this._size)return this._emitSuccess(t),void this._source.close();this._saveUploadInUrlStorage().then((()=>{this.options.uploadDataDuringCreation?this._handleUploadResponse(e,t):(this._offset=0,this._performUpload())}))}else this._emitHttpError(e,t,"tus: invalid or missing Location header")})).catch((t=>{this._emitHttpError(e,null,"tus: failed to create upload",t)}))}_resumeUpload(){const e=this._openRequest("HEAD",this.url);this._sendRequest(e,null).then((t=>{const s=t.getStatus();if(!Re(s,200))return 423===s?void this._emitHttpError(e,t,"tus: upload is currently locked; retry later"):(Re(s,400)&&this._removeFromUrlStorage(),this.options.endpoint?(this.url=null,void this._createUpload()):void this._emitHttpError(e,t,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));const o=Number.parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(o))return void this._emitHttpError(e,t,"tus: invalid or missing offset value");const i=Number.parseInt(t.getHeader("Upload-Length"),10);!Number.isNaN(i)||this.options.uploadLengthDeferred||this.options.protocol!==ye?("function"==typeof this.options.onUploadUrlAvailable&&this.options.onUploadUrlAvailable(),this._saveUploadInUrlStorage().then((()=>{if(o===i)return this._emitProgress(i,i),void this._emitSuccess(t);this._offset=o,this._performUpload()}))):this._emitHttpError(e,t,"tus: invalid or missing length value")})).catch((t=>{this._emitHttpError(e,null,"tus: failed to resume upload",t)}))}_performUpload(){if(this._aborted)return;let e;this.options.overridePatchMethod?(e=this._openRequest("POST",this.url),e.setHeader("X-HTTP-Method-Override","PATCH")):e=this._openRequest("PATCH",this.url),e.setHeader("Upload-Offset",`${this._offset}`);this._addChunkToRequest(e).then((t=>{Re(t.getStatus(),200)?this._handleUploadResponse(e,t):this._emitHttpError(e,t,"tus: unexpected response while uploading chunk")})).catch((t=>{this._aborted||this._emitHttpError(e,null,`tus: failed to upload chunk at offset ${this._offset}`,t)}))}_addChunkToRequest(e){const t=this._offset;let s=this._offset+this.options.chunkSize;return e.setProgressHandler((e=>{this._emitProgress(t+e,this._size)})),this.options.protocol===ye?e.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===_e&&e.setHeader("Content-Type","application/partial-upload"),(s===Number.POSITIVE_INFINITY||s>this._size)&&!this.options.uploadLengthDeferred&&(s=this._size),this._source.slice(t,s).then((t=>{let{value:s,done:o}=t;const i=s?.size?s.size:0;this.options.uploadLengthDeferred&&o&&(this._size=this._offset+i,e.setHeader("Upload-Length",`${this._size}`));const n=this._offset+i;return!this.options.uploadLengthDeferred&&o&&n!==this._size?Promise.reject(new Error(`upload was configured with a size of ${this._size} bytes, but the source is done after ${n} bytes`)):null===s?this._sendRequest(e):(this.options.protocol!==ve&&this.options.protocol!==_e||e.setHeader("Upload-Complete",o?"?1":"?0"),this._emitProgress(this._offset,this._size),this._sendRequest(e,s))}))}_handleUploadResponse(e,t){const s=Number.parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(s))this._emitHttpError(e,t,"tus: invalid or missing offset value");else{if(this._emitProgress(s,this._size),this._emitChunkComplete(s-this._offset,s,this._size),this._offset=s,s===this._size)return this._emitSuccess(t),void this._source.close();this._performUpload()}}_openRequest(e,t){const s=we(e,t,this.options);return this._req=s,s}_removeFromUrlStorage(){this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch((e=>{this._emitError(e)})),this._urlStorageKey=null)}_saveUploadInUrlStorage(){if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();const e={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?e.parallelUploadUrls=this._parallelUploadUrls:e.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,e).then((e=>{this._urlStorageKey=e}))}_sendRequest(e){return Ae(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}function Se(e){return Object.entries(e).map((e=>{let[t,s]=e;return`${t} ${pe(String(s))}`})).join(",")}function Re(e,t){return e>=t&&e<t+100}function we(e,t,s){const o=s.httpStack.createRequest(e,t);s.protocol===ve?o.setHeader("Upload-Draft-Interop-Version","5"):s.protocol===_e?o.setHeader("Upload-Draft-Interop-Version","6"):o.setHeader("Tus-Resumable","1.0.0");const i=s.headers||{};for(const[e,t]of Object.entries(i))o.setHeader(e,t);if(s.addRequestId){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));o.setHeader("X-Request-ID",e)}return o}async function Ae(e,t,s){"function"==typeof s.onBeforeRequest&&await s.onBeforeRequest(e);const o=await e.send(t);return"function"==typeof s.onAfterResponse&&await s.onAfterResponse(e,o),o}function ke(e,t,s){return!(null==s.retryDelays||t>=s.retryDelays.length||null==e.originalRequest)&&(s&&"function"==typeof s.onShouldRetry?s.onShouldRetry(e,t,s):Ce(e))}function Ce(e){const t=e.originalResponse?e.originalResponse.getStatus():0;return(!Re(t,400)||409===t||423===t)&&function(){let e=!0;return"undefined"!=typeof navigator&&!1===navigator.onLine&&(e=!1),e}()}function Ue(e,t){return new xe(t,e).toString()}Ee.defaultOptions=be;const Te=()=>"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Ie{constructor(e){this._file=e,this.size=e.size}slice(e,t){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return s=this._file.slice(e,t),new Promise(((e,t)=>{const o=new FileReader;o.onload=()=>{const t=new Uint8Array(o.result);e({value:t})},o.onerror=e=>{t(e)},o.readAsArrayBuffer(s)}));var s;const o=this._file.slice(e,t),i=t>=this.size;return Promise.resolve({value:o,done:i})}close(){}}function $e(e){return void 0===e?0:void 0!==e.size?e.size:e.length}class He{constructor(e){this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}slice(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}_readUntilEnoughDataOrDone(e,t){const s=t<=this._bufferOffset+$e(this._buffer);if(this._done||s){const s=this._getDataFromBuffer(e,t),o=null==s&&this._done;return Promise.resolve({value:s,done:o})}return this._reader.read().then((s=>{let{value:o,done:i}=s;return i?this._done=!0:void 0===this._buffer?this._buffer=o:this._buffer=function(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){const s=new e.constructor(e.length+t.length);return s.set(e),s.set(t,e.length),s}throw new Error("Unknown data type")}(this._buffer,o),this._readUntilEnoughDataOrDone(e,t)}))}_getDataFromBuffer(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);const s=0===$e(this._buffer);return this._done&&s?null:this._buffer.slice(0,t-e)}close(){this._reader.cancel&&this._reader.cancel()}}class Le{constructor(e,t){this._xhr=new XMLHttpRequest,this._xhr.open(e,t,!0),this._method=e,this._url=t,this._headers={}}getMethod(){return this._method}getURL(){return this._url}setHeader(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}getHeader(e){return this._headers[e]}setProgressHandler(e){"upload"in this._xhr&&(this._xhr.upload.onprogress=t=>{t.lengthComputable&&e(t.loaded)})}send(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(((t,s)=>{this._xhr.onload=()=>{t(new De(this._xhr))},this._xhr.onerror=e=>{s(e)},this._xhr.send(e)}))}abort(){return this._xhr.abort(),Promise.resolve()}getUnderlyingObject(){return this._xhr}}class De{constructor(e){this._xhr=e}getStatus(){return this._xhr.status}getHeader(e){return this._xhr.getResponseHeader(e)}getBody(){return this._xhr.responseText}getUnderlyingObject(){return this._xhr}}let Pe=!1;try{Pe="localStorage"in window;const e="tusSupport",t=localStorage.getItem(e);localStorage.setItem(e,t),null===t&&localStorage.removeItem(e)}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;Pe=!1}const Oe=Pe;const Ne={...Ee.defaultOptions,httpStack:new class{createRequest(e,t){return new Le(e,t)}getName(){return"XHRHttpStack"}},fileReader:new class{async openFile(e,t){if(Te()&&e&&void 0!==e.uri)try{const t=await(s=e.uri,new Promise(((e,t)=>{const o=new XMLHttpRequest;o.responseType="blob",o.onload=()=>{const t=o.response;e(t)},o.onerror=e=>{t(e)},o.open("GET",s),o.send()})));return new Ie(t)}catch(e){throw new Error(`tus: cannot fetch \`file.uri\` as Blob, make sure the uri is correct and accessible. ${e}`)}var s;return"function"==typeof e.slice&&void 0!==e.size?Promise.resolve(new Ie(e)):"function"==typeof e.read?(t=Number(t),Number.isFinite(t)?Promise.resolve(new He(e,t)):Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment"))}},urlStorage:Oe?new class{findAllUploads(){const e=this._findEntries("tus::");return Promise.resolve(e)}findUploadsByFingerprint(e){const t=this._findEntries(`tus::${e}::`);return Promise.resolve(t)}removeUpload(e){return localStorage.removeItem(e),Promise.resolve()}addUpload(e,t){const s=`tus::${e}::${Math.round(1e12*Math.random())}`;return localStorage.setItem(s,JSON.stringify(t)),Promise.resolve(s)}_findEntries(e){const t=[];for(let s=0;s<localStorage.length;s++){const o=localStorage.key(s);if(0===o.indexOf(e))try{const e=JSON.parse(localStorage.getItem(o));e.urlStorageKey=o,t.push(e)}catch(e){}}return t}}:new class{listAllUploads(){return Promise.resolve([])}findUploadsByFingerprint(e){return Promise.resolve([])}removeUpload(e){return Promise.resolve()}addUpload(e,t){return Promise.resolve(null)}},fingerprint:function(e,t){return Te()?Promise.resolve(function(e,t){const s=e.exif?function(e){let t=0;if(0===e.length)return t;for(let s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t&=t}return t}(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",s,t.endpoint].join("/")}(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}};class je extends Ee{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t={...Ne,...t},super(e,t)}static terminate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t={...Ne,...t},Ee.terminate(e,t)}}const Fe=async(e,t)=>new Promise(((s,o)=>{const i=new XMLHttpRequest;i.open("DELETE",e),i.onload=()=>{204===i.status?s():o(new Error)},i.setRequestHeader("Tus-Resumable","1.0.0"),i.setRequestHeader("X-CSRFToken",t),i.send(null)}));class ze extends z{constructor(e){let{chunkSize:t,csrfToken:s,fieldName:o,file:i,formId:n,retryDelays:r,uploadIndex:a,uploadUrl:l}=e;super({name:i.name,status:"uploading",type:"tus",uploadIndex:a}),this.csrfToken=s,this.upload=new je(i,{chunkSize:t,endpoint:l,metadata:{fieldName:o,filename:i.name,formId:n},onAfterResponse:this.handleAfterReponse,onBeforeRequest:this.addCsrTokenToRequest,onError:this.handleError,onProgress:this.handleProgress,onSuccess:this.handleSucces,retryDelays:r??[0,1e3,3e3,5e3]}),this.onError=void 0,this.onProgress=void 0,this.onSuccess=void 0}async abort(){await this.upload.abort(!0)}async delete(){if(!this.upload.url)return Promise.resolve();await Fe(this.upload.url,this.csrfToken)}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.name,size:this.getSize(),type:"tus",url:""}}getSize(){return this.upload.file.size}start(){this.upload.start()}addCsrTokenToRequest=e=>{e.setHeader("X-CSRFToken",this.csrfToken)};handleAfterReponse=(e,t)=>{const s=t.getHeader("ResourceId");s&&(this.id=s)};handleError=e=>{if(!this.onError)throw e;this.onError(e)};handleProgress=(e,t)=>{this.onProgress&&this.onProgress(e,t)};handleSucces=()=>{this.onSuccess&&this.onSuccess()}}class qe extends z{constructor(e){let{name:t,size:s,type:o,uploadIndex:i}=e;super({name:t,status:"done",type:o,uploadIndex:i}),this.size=s}async abort(){return Promise.resolve()}async delete(){return Promise.resolve()}getSize(){return this.size}}class Me extends qe{constructor(e,t){super({name:e.name,size:e.size,type:"placeholder",uploadIndex:t}),this.id=e.id}getId(){}getInitialFile(){return{id:this.id,name:this.name,size:this.size,type:"placeholder"}}}class Be extends qe{constructor(e,t){super({name:e.name,size:e.size,type:"existing",uploadIndex:t})}getId(){}getInitialFile(){return{name:this.name,size:this.size,type:"existing"}}}class Ge extends qe{constructor(e,t){super({name:e.original_name||e.name,size:e.size,type:"uploadedS3",uploadIndex:t}),this.id=e.id,this.key=e.name}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.key,original_name:this.name,size:this.size,type:"s3"}}}class Ke extends qe{constructor(e){let{csrfToken:t,initialFile:s,uploadIndex:o,uploadUrl:i}=e;super({name:s.name,size:s.size,type:"uploadedTus",uploadIndex:o}),this.csrfToken=t,this.id=s.id,this.url=`${i}${s.id}`}async delete(){await Fe(this.url,this.csrfToken)}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.name,size:this.size,type:"tus",url:""}}}class Xe{constructor(e){let{callbacks:t,chunkSize:s,csrfToken:o,eventEmitter:i,fieldName:n,form:r,formId:a,initial:l,input:p,multiple:c,parent:u,prefix:d,retryDelays:h,s3UploadDir:f,skipRequired:m,supportDropArea:g,translations:x,uploadUrl:y}=e;this.callbacks=t,this.chunkSize=s,this.csrfToken=o,this.eventEmitter=i,this.fieldName=n,this.form=r,this.formId=a,this.multiple=c,this.prefix=d,this.retryDelays=h,this.s3UploadDir=f,this.supportDropArea=g&&!p.disabled,this.uploadUrl=y,this.acceptedFileTypes=new C(p.accept),this.uploads=[],this.nextUploadIndex=0,this.renderer=new F({input:p,parent:u,skipRequired:m,translations:x});const v=this.renderer.container;g&&this.initDropArea(v,p.accept),this.addInitialFiles(l),this.checkDropHint(),p.addEventListener("change",this.onChange),v.addEventListener("click",this.handleClick)}addInitialFiles(e){if(0===e.length)return;const{multiple:t,renderer:s}=this,o=e=>{const{size:t}=e,o="s3"===e.type&&e.original_name?e.original_name:e.name,i=s.addUploadedFile(o,this.nextUploadIndex,t),n=(e=>{let{csrfToken:t,initialFile:s,uploadIndex:o,uploadUrl:i}=e;switch(s.type){case"existing":return new Be(s,o);case"placeholder":return new Me(s,o);case"s3":return new Ge(s,o);case"tus":return new Ke({csrfToken:t,initialFile:s,uploadIndex:o,uploadUrl:i})}})({csrfToken:this.csrfToken,initialFile:e,uploadIndex:this.nextUploadIndex,uploadUrl:this.uploadUrl});this.uploads.push(n),this.emitEvent("addUpload",i,n)};if(t)e.forEach((e=>{o(e),this.nextUploadIndex+=1}));else{const t=e[0];t&&o(t)}}checkDropHint(){if(!this.supportDropArea)return;0===this.uploads.filter((e=>Boolean(e))).length?this.renderer.renderDropHint():this.renderer.removeDropHint()}emitEvent(e,t,s){this.eventEmitter&&this.eventEmitter.emit(e,{element:t,fieldName:this.fieldName,fileName:s.name,metaDataField:this.getMetaDataField(),upload:s})}findUploadByName(e){return this.uploads.find((t=>t.name===e))}getMetaDataField(){return O(this.form,(e=this.fieldName,t=this.prefix,`${P(e,t)}-metadata`),this.prefix);var e,t}getUploadByIndex(e){return this.uploads.find((t=>t.uploadIndex===e))}async handleCancel(e){this.renderer.disableCancel(e.uploadIndex),await e.abort(),this.removeUploadFromList(e)}handleClick=e=>{const t=e.target,s=()=>{const e=t.getAttribute("data-index");if(!e)return;const s=parseInt(e,10);return this.getUploadByIndex(s)};if(t.classList.contains("dff-delete")&&!t.classList.contains("dff-disabled")){e.preventDefault();const t=s();t&&this.removeExistingUpload(t)}else if(t.classList.contains("dff-cancel")){e.preventDefault();const t=s();t&&this.handleCancel(t)}else if(t.classList.contains("dff-filename")){e.preventDefault();const t=s();"done"===t?.status&&this.callbacks.onClick&&this.callbacks.onClick({fieldName:this.fieldName,fileName:t.name,id:t.getId(),type:t.type})}};handleError=(e,t)=>{this.renderer.setError(e.uploadIndex),e.status="error";const{onError:s}=this.callbacks;s&&e instanceof ze&&s(t,e)};handleInvalidFiles=e=>{this.renderer.setErrorInvalidFiles(e)};handleProgress=(e,t,s)=>{const o=(t/s*100).toFixed(2);this.renderer.updateProgress(e.uploadIndex,o);const{onProgress:i}=this.callbacks;i&&e instanceof ze&&i(t,s,e)};handleSuccess=e=>{const{renderer:t}=this;this.updatePlaceholderInput(),t.clearInput(),t.setSuccess(e.uploadIndex,e.getSize()),e.status="done";const{onSuccess:s}=this.callbacks,o=this.renderer.findFileDiv(e.uploadIndex);o&&this.emitEvent("uploadComplete",o,e),s&&"tus"===e.type&&s(e)};initDropArea(e,t){new T({container:e,inputAccept:t,onUploadFiles:this.uploadFiles,renderer:this.renderer})}onChange=e=>{const t=e.target.files??[],s=[],o=[];for(const e of t)this.acceptedFileTypes.isAccepted(e.name)?s.push(e):o.push(e);this.handleInvalidFiles([...o]),this.uploadFiles([...s]),this.renderer.clearInput()};async removeExistingUpload(e){const t=this.renderer.findFileDiv(e.uploadIndex);if(t&&this.emitEvent("removeUpload",t,e),"uploading"===e.status)this.renderer.disableCancel(e.uploadIndex),await e.abort();else if("done"===e.status){this.renderer.disableDelete(e.uploadIndex);try{await e.delete()}catch{return void this.renderer.setDeleteFailed(e.uploadIndex)}}this.removeUploadFromList(e),this.updatePlaceholderInput()}removeUploadFromList(e){this.renderer.deleteFile(e.uploadIndex);const t=this.uploads.indexOf(e);t>=0&&this.uploads.splice(t,1),this.checkDropHint();const{onDelete:s}=this.callbacks;s&&s(e)}updatePlaceholderInput(){const e=O(this.form,N(this.fieldName,this.prefix),this.prefix);if(!e)return;const t=this.uploads.map((e=>e.getInitialFile()));e.value=JSON.stringify(t)}async uploadFile(e){const{fieldName:t,formId:s,renderer:o,uploadUrl:i}=this,n=e.name,r=this.findUploadByName(n),a=r?r.uploadIndex:this.nextUploadIndex;r||(this.nextUploadIndex+=1),r&&await this.removeExistingUpload(r);const l=(()=>{const{csrfToken:o,s3UploadDir:n}=this;return null!=n?new B({csrfToken:o,endpoint:i,file:e,s3UploadDir:n,uploadIndex:a}):new ze({chunkSize:this.chunkSize,csrfToken:this.csrfToken,fieldName:t,file:e,formId:s,retryDelays:this.retryDelays,uploadIndex:a,uploadUrl:i})})();l.onError=e=>{this.handleError(l,e)},l.onProgress=(e,t)=>{this.handleProgress(l,e,t)},l.onSuccess=()=>{this.handleSuccess(l)},l.start(),this.uploads.push(l);const p=o.addNewUpload(n,a);this.emitEvent("addUpload",p,l)}uploadFiles=async e=>{if(0!==e.length){if(this.multiple)for(const t of e)await this.uploadFile(t);else{for(const e of this.uploads)this.renderer.deleteFile(e.uploadIndex);this.uploads=[];const t=e[0];t&&await this.uploadFile(t)}this.checkDropHint()}}}const Qe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=()=>t.prefix?t.prefix:null,o=t=>j(e,t,s()),i=o("upload_url"),n=o("form_id"),r=o("s3_upload_dir"),a=t.skipRequired??!1,l=s(),p=O(e,"csrfmiddlewaretoken",null)?.value;if(!p)throw Error("Csrf token not found");n&&i&&e.querySelectorAll(".dff-uploader").forEach((c=>{const u=c.querySelector(".dff-container");if(!u)return;const d=u.querySelector("input[type=file]");if(!d||!(e=>!t.prefix||e.startsWith(`${t.prefix}-`))(d.name))return;const h=d.name,{multiple:f}=d,m=(e=>{const t=o(N(e,s()));return t?JSON.parse(t).filter((e=>e.type)):[]})(h),g=u.getAttribute("data-translations"),x=g?JSON.parse(g):{},y=!(!1===t.supportDropArea);new Xe({callbacks:t.callbacks??{},chunkSize:t.chunkSize??2621440,csrfToken:p,eventEmitter:t.eventEmitter,fieldName:h,form:e,formId:n,initial:m,input:d,multiple:f,parent:u,prefix:l,retryDelays:t.retryDelays??null,s3UploadDir:r??null,skipRequired:a,supportDropArea:y,translations:x,uploadUrl:i})}))};window.autoInitFileForms=()=>{const t=window.initUploadFields;var s;(s=Array.from(document.querySelectorAll(".dff-uploader")).map(e),Array.from(new Set(s).values())).forEach(t)},window.initFormSet=(e,t)=>{let s;s="string"==typeof t?{prefix:t}:t;const o=s.prefix??"form",i=j(e,"TOTAL_FORMS",o);if(!i)return;const n=parseInt(i,10);for(let t=0;t<n;t+=1){const i=D(t.toString(),null);Qe(e,{...s,prefix:`${o}-${i}`})}},window.initUploadFields=Qe}();
//# sourceMappingURL=file_form.min.js.map
