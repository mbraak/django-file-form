!function(){const e=t=>{const i=t.parentElement;return i?"FORM"===i.tagName?i:e(i):null};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function i(e){var i=function(e,i){if("object"!=t(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var o=s.call(e,i||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==t(i)?i:String(i)}function s(e,t,s){return(t=i(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const o=(e,t)=>t?`${t}-${e}`:e,n=(e,t)=>t?e.slice(t.length+1):e,r=(e,t,i)=>{const s=o(t,i),n=e.querySelector(`[name="${s}"]`);return n||null},a=(e,t)=>`${n(e,t)}-uploads`,l=(e,t,i)=>r(e,t,i)?.value;var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}
/*!
   * escape-html
   * Copyright(c) 2012-2013 TJ Holowaychuk
   * Copyright(c) 2015 Andreas Lubbe
   * Copyright(c) 2015 Tiancheng "Timothy" Gu
   * MIT Licensed
   */var u=/["'&<>]/,d=function(e){var t,i=""+e,s=u.exec(i);if(!s)return i;var o="",n=0,r=0;for(n=s.index;n<i.length;n++){switch(i.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}r!==n&&(o+=i.substring(r,n)),r=n+1,o+=t}return r!==n?o+i.substring(r,n):o};var h=c(d);class f{constructor(e){let{parent:t,input:i,skipRequired:o,translations:n}=e;s(this,"container",void 0),s(this,"input",void 0),s(this,"translations",void 0),s(this,"errors",void 0),s(this,"createErrorContainer",(e=>{const t=document.createElement("div");return t.className="dff-invalid-files",e.appendChild(t),t})),s(this,"createFilesContainer",(e=>{const t=document.createElement("div");return t.className="dff-files",e.appendChild(t),t})),this.container=this.createFilesContainer(t),this.errors=this.createErrorContainer(t),this.input=i,this.translations=n,o&&(this.input.required=!1)}addNewUpload(e,t){const i=this.addFile(e,t),s=document.createElement("span");s.className="dff-progress";const o=document.createElement("span");o.className="dff-progress-inner",s.appendChild(o),i.appendChild(s);const n=document.createElement("a");return n.className="dff-cancel",n.innerHTML=this.translations.Cancel||"",n.setAttribute("data-index",`${t}`),n.href="#",i.appendChild(n),i}addUploadedFile(e,t,i){const s=this.addFile(e,t);return this.setSuccess(t,i),s}clearInput(){const{input:e}=this;e.value=""}deleteFile(e){const t=this.findFileDiv(e);t&&t.remove()}disableCancel(e){const t=this.findCancelSpan(e);t&&t.classList.add("dff-disabled")}disableDelete(e){const t=this.findDeleteLink(e);t&&t.classList.add("dff-disabled")}findFileDiv(e){return this.container.querySelector(`.dff-file-id-${e}`)}removeDropHint(){const e=this.container.querySelector(".dff-drop-hint");e&&e.remove()}renderDropHint(){if(this.container.querySelector(".dff-drop-hint"))return;const e=document.createElement("div");e.className="dff-drop-hint",e.innerHTML=this.translations["Drop your files here"]||"",this.container.appendChild(e)}setDeleteFailed(e){this.setErrorMessage(e,this.translations["Delete failed"]||""),this.enableDelete(e)}setError(e){this.setErrorMessage(e,this.translations["Upload failed"]||"");const t=this.findFileDiv(e);t&&t.classList.add("dff-upload-fail"),this.removeProgress(e),this.removeCancel(e)}setErrorInvalidFiles(e){const t=document.createElement("ul");for(const i of e){const e=document.createElement("li");e.innerText=`${i.name}: ${this.translations["Invalid file type"]}`,e.className="dff-error",t.appendChild(e)}this.errors.replaceChildren(t),this.clearInput()}setSuccess(e,t){const{translations:i}=this,s=this.findFileDiv(e);if(s){if(s.classList.add("dff-upload-success"),null!=t){const e=document.createElement("span");e.innerHTML=((e,t)=>{if(0===e)return"0 Bytes";const i=t<=0?0:t||2,s=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/1024**s).toFixed(i))} ${["Bytes","KB","MB","GB"][s]}`})(t,2),e.className="dff-filesize",s.appendChild(e)}const o=document.createElement("a");o.innerHTML=i.Delete||"",o.className="dff-delete",o.setAttribute("data-index",`${e}`),o.href="#",s.appendChild(o)}this.removeProgress(e),this.removeCancel(e)}updateProgress(e,t){const i=this.container.querySelector(`.dff-file-id-${e}`);if(i){const e=i.querySelector(".dff-progress-inner");e&&(e.style.width=`${t}%`)}}addFile(e,t){const i=document.createElement("div");i.className=`dff-file dff-file-id-${t}`;const s=document.createElement("span");return s.innerHTML=h(e),s.className="dff-filename",s.setAttribute("data-index",`${t}`),i.appendChild(s),this.container.appendChild(i),this.input.required=!1,i}removeProgress(e){const t=this.findFileDiv(e);if(t){const e=t.querySelector(".dff-progress");e&&e.remove()}}removeCancel(e){const t=this.findCancelSpan(e);t&&t.remove()}findCancelSpan(e){const t=this.findFileDiv(e);return t?t.querySelector(".dff-cancel"):null}enableDelete(e){const t=this.findDeleteLink(e);t&&t.classList.remove("dff-disabled")}findDeleteLink(e){const t=this.findFileDiv(e);return t?t.querySelector(".dff-delete"):t}setErrorMessage(e,t){const i=this.findFileDiv(e);if(!i)return;const s=i.querySelector(".dff-error");s&&s.remove();const o=document.createElement("span");o.classList.add("dff-error"),o.innerHTML=t,i.appendChild(o)}}const m={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(m);var g,x,v,y=window&&window.__classPrivateFieldGet||function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)};g=new WeakMap,x=new WeakMap,v=new WeakMap;var _=new class{constructor(...e){g.set(this,new Map),x.set(this,new Map),v.set(this,new Map);for(const t of e)this.define(t)}define(e,t=!1){for(let[i,s]of Object.entries(e)){i=i.toLowerCase(),s=s.map((e=>e.toLowerCase())),y(this,v,"f").has(i)||y(this,v,"f").set(i,new Set);const e=y(this,v,"f").get(i);let o=!0;for(let n of s){const s=n.startsWith("*");if(n=s?n.slice(1):n,e?.add(n),o&&y(this,x,"f").set(i,n),o=!1,s)continue;const r=y(this,g,"f").get(n);if(r&&r!=i&&!t)throw new Error(`"${i} -> ${n}" conflicts with "${r} -> ${n}". Pass \`force=true\` to override this definition.`);y(this,g,"f").set(n,i)}}return this}getType(e){if("string"!=typeof e)return null;const t=e.replace(/^.*[/\\]/,"").toLowerCase(),i=t.replace(/^.*\./,"").toLowerCase(),s=t.length<e.length;return!(i.length<t.length-1)&&s?null:y(this,g,"f").get(i)??null}getExtension(e){return"string"!=typeof e?null:(e=e?.split?.(";")[0],(e&&y(this,x,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return"string"!=typeof e?null:y(this,v,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of y(this,v,"f").values())Object.freeze(e);return this}_getTestState(){return{types:y(this,g,"f"),extensions:y(this,x,"f")}}}(m)._freeze(),b={};const E="\\\\/",S=`[^${E}]`,R="\\.",w="\\/",A="[^/]",k=`(?:${w}|$)`,C=`(?:^|${w})`,U=`${R}{1,2}${k}`,T={DOT_LITERAL:R,PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:w,ONE_CHAR:"(?=.)",QMARK:A,END_ANCHOR:k,DOTS_SLASH:U,NO_DOT:`(?!${R})`,NO_DOTS:`(?!${C}${U})`,NO_DOT_SLASH:`(?!${R}{0,1}${k})`,NO_DOTS_SLASH:`(?!${U})`,QMARK_NO_DOT:`[^.${w}]`,STAR:`${A}*?`,START_ANCHOR:C,SEP:"/"},$={...T,SLASH_LITERAL:`[${E}]`,QMARK:S,STAR:`${S}*?`,DOTS_SLASH:`${R}{1,2}(?:[${E}]|$)`,NO_DOT:`(?!${R})`,NO_DOTS:`(?!(?:^|[${E}])${R}{1,2}(?:[${E}]|$))`,NO_DOT_SLASH:`(?!${R}{0,1}(?:[${E}]|$))`,NO_DOTS_SLASH:`(?!${R}{1,2}(?:[${E}]|$))`,QMARK_NO_DOT:`[^.${E}]`,START_ANCHOR:`(?:^|[${E}])`,END_ANCHOR:`(?:[${E}]|$)`,SEP:"\\"};var I={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,extglobChars:e=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:e=>!0===e?$:T};!function(e){const{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:i,REGEX_SPECIAL_CHARS:s,REGEX_SPECIAL_CHARS_GLOBAL:o}=I;e.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),e.hasRegexChars=e=>s.test(e),e.isRegexChar=t=>1===t.length&&e.hasRegexChars(t),e.escapeRegex=e=>e.replace(o,"\\$1"),e.toPosixSlashes=e=>e.replace(t,"/"),e.removeBackslashes=e=>e.replace(i,(e=>"\\"===e?"":e)),e.escapeLast=(t,i,s)=>{const o=t.lastIndexOf(i,s);return-1===o?t:"\\"===t[o-1]?e.escapeLast(t,i,o-1):`${t.slice(0,o)}\\${t.slice(o)}`},e.removePrefix=(e,t={})=>{let i=e;return i.startsWith("./")&&(i=i.slice(2),t.prefix="./"),i},e.wrapOutput=(e,t={},i={})=>{let s=`${i.contains?"":"^"}(?:${e})${i.contains?"":"$"}`;return!0===t.negated&&(s=`(?:^(?!${s}).*$)`),s},e.basename=(e,{windows:t}={})=>{const i=e.split(t?/[\\/]/:"/"),s=i[i.length-1];return""===s?i[i.length-2]:s}}(b);const H=b,{CHAR_ASTERISK:L,CHAR_AT:D,CHAR_BACKWARD_SLASH:P,CHAR_COMMA:O,CHAR_DOT:j,CHAR_EXCLAMATION_MARK:z,CHAR_FORWARD_SLASH:F,CHAR_LEFT_CURLY_BRACE:N,CHAR_LEFT_PARENTHESES:q,CHAR_LEFT_SQUARE_BRACKET:M,CHAR_PLUS:B,CHAR_QUESTION_MARK:G,CHAR_RIGHT_CURLY_BRACE:K,CHAR_RIGHT_PARENTHESES:X,CHAR_RIGHT_SQUARE_BRACKET:Q}=I,W=e=>e===F||e===P,Z=e=>{!0!==e.isPrefix&&(e.depth=e.isGlobstar?1/0:1)};var J=(e,t)=>{const i=t||{},s=e.length-1,o=!0===i.parts||!0===i.scanToEnd,n=[],r=[],a=[];let l,p,c=e,u=-1,d=0,h=0,f=!1,m=!1,g=!1,x=!1,v=!1,y=!1,_=!1,b=!1,E=!1,S=!1,R=0,w={value:"",depth:0,isGlob:!1};const A=()=>u>=s,k=()=>(l=p,c.charCodeAt(++u));for(;u<s;){let e;if(p=k(),p!==P){if(!0===y||p===N){for(R++;!0!==A()&&(p=k());)if(p!==P)if(p!==N){if(!0!==y&&p===j&&(p=k())===j){if(f=w.isBrace=!0,g=w.isGlob=!0,S=!0,!0===o)continue;break}if(!0!==y&&p===O){if(f=w.isBrace=!0,g=w.isGlob=!0,S=!0,!0===o)continue;break}if(p===K&&(R--,0===R)){y=!1,f=w.isBrace=!0,S=!0;break}}else R++;else _=w.backslashes=!0,k();if(!0===o)continue;break}if(p!==F){if(!0!==i.noext){if(!0===(p===B||p===D||p===L||p===G||p===z)&&c.charCodeAt(u+1)===q){if(g=w.isGlob=!0,x=w.isExtglob=!0,S=!0,p===z&&u===d&&(E=!0),!0===o){for(;!0!==A()&&(p=k());)if(p!==P){if(p===X){g=w.isGlob=!0,S=!0;break}}else _=w.backslashes=!0,p=k();continue}break}}if(p===L){if(l===L&&(v=w.isGlobstar=!0),g=w.isGlob=!0,S=!0,!0===o)continue;break}if(p===G){if(g=w.isGlob=!0,S=!0,!0===o)continue;break}if(p===M){for(;!0!==A()&&(e=k());)if(e!==P){if(e===Q){m=w.isBracket=!0,g=w.isGlob=!0,S=!0;break}}else _=w.backslashes=!0,k();if(!0===o)continue;break}if(!0===i.nonegate||p!==z||u!==d){if(!0!==i.noparen&&p===q){if(g=w.isGlob=!0,!0===o){for(;!0!==A()&&(p=k());)if(p!==q){if(p===X){S=!0;break}}else _=w.backslashes=!0,p=k();continue}break}if(!0===g){if(S=!0,!0===o)continue;break}}else b=w.negated=!0,d++}else{if(n.push(u),r.push(w),w={value:"",depth:0,isGlob:!1},!0===S)continue;if(l===j&&u===d+1){d+=2;continue}h=u+1}}else _=w.backslashes=!0,p=k(),p===N&&(y=!0)}!0===i.noext&&(x=!1,g=!1);let C=c,U="",T="";d>0&&(U=c.slice(0,d),c=c.slice(d),h-=d),C&&!0===g&&h>0?(C=c.slice(0,h),T=c.slice(h)):!0===g?(C="",T=c):C=c,C&&""!==C&&"/"!==C&&C!==c&&W(C.charCodeAt(C.length-1))&&(C=C.slice(0,-1)),!0===i.unescape&&(T&&(T=H.removeBackslashes(T)),C&&!0===_&&(C=H.removeBackslashes(C)));const $={prefix:U,input:e,start:d,base:C,glob:T,isBrace:f,isBracket:m,isGlob:g,isExtglob:x,isGlobstar:v,negated:b,negatedExtglob:E};if(!0===i.tokens&&($.maxDepth=0,W(p)||r.push(w),$.tokens=r),!0===i.parts||!0===i.tokens){let t;for(let s=0;s<n.length;s++){const o=t?t+1:d,l=n[s],p=e.slice(o,l);i.tokens&&(0===s&&0!==d?(r[s].isPrefix=!0,r[s].value=U):r[s].value=p,Z(r[s]),$.maxDepth+=r[s].depth),0===s&&""===p||a.push(p),t=l}if(t&&t+1<e.length){const s=e.slice(t+1);a.push(s),i.tokens&&(r[r.length-1].value=s,Z(r[r.length-1]),$.maxDepth+=r[r.length-1].depth)}$.slashes=n,$.parts=a}return $};const Y=I,V=b,{MAX_LENGTH:ee,POSIX_REGEX_SOURCE:te,REGEX_NON_SPECIAL_CHARS:ie,REGEX_SPECIAL_CHARS_BACKREF:se,REPLACEMENTS:oe}=Y,ne=(e,t)=>{if("function"==typeof t.expandRange)return t.expandRange(...e,t);e.sort();const i=`[${e.join("-")}]`;try{new RegExp(i)}catch(t){return e.map((e=>V.escapeRegex(e))).join("..")}return i},re=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,ae=(e,t)=>{if("string"!=typeof e)throw new TypeError("Expected a string");e=oe[e]||e;const i={...t},s="number"==typeof i.maxLength?Math.min(ee,i.maxLength):ee;let o=e.length;if(o>s)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${s}`);const n={type:"bos",value:"",output:i.prepend||""},r=[n],a=i.capture?"":"?:",l=Y.globChars(i.windows),p=Y.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:u,SLASH_LITERAL:d,ONE_CHAR:h,DOTS_SLASH:f,NO_DOT:m,NO_DOT_SLASH:g,NO_DOTS_SLASH:x,QMARK:v,QMARK_NO_DOT:y,STAR:_,START_ANCHOR:b}=l,E=e=>`(${a}(?:(?!${b}${e.dot?f:c}).)*?)`,S=i.dot?"":m,R=i.dot?v:y;let w=!0===i.bash?E(i):_;i.capture&&(w=`(${w})`),"boolean"==typeof i.noext&&(i.noextglob=i.noext);const A={input:e,index:-1,start:0,dot:!0===i.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:r};e=V.removePrefix(e,A),o=e.length;const k=[],C=[],U=[];let T,$=n;const I=()=>A.index===o-1,H=A.peek=(t=1)=>e[A.index+t],L=A.advance=()=>e[++A.index]||"",D=()=>e.slice(A.index+1),P=(e="",t=0)=>{A.consumed+=e,A.index+=t},O=e=>{A.output+=null!=e.output?e.output:e.value,P(e.value)},j=()=>{let e=1;for(;"!"===H()&&("("!==H(2)||"?"===H(3));)L(),A.start++,e++;return e%2!=0&&(A.negated=!0,A.start++,!0)},z=e=>{A[e]++,U.push(e)},F=e=>{A[e]--,U.pop()},N=e=>{if("globstar"===$.type){const t=A.braces>0&&("comma"===e.type||"brace"===e.type),i=!0===e.extglob||k.length&&("pipe"===e.type||"paren"===e.type);"slash"===e.type||"paren"===e.type||t||i||(A.output=A.output.slice(0,-$.output.length),$.type="star",$.value="*",$.output=w,A.output+=$.output)}if(k.length&&"paren"!==e.type&&(k[k.length-1].inner+=e.value),(e.value||e.output)&&O(e),$&&"text"===$.type&&"text"===e.type)return $.output=($.output||$.value)+e.value,void($.value+=e.value);e.prev=$,r.push(e),$=e},q=(e,t)=>{const s={...p[t],conditions:1,inner:""};s.prev=$,s.parens=A.parens,s.output=A.output;const o=(i.capture?"(":"")+s.open;z("parens"),N({type:e,value:t,output:A.output?"":h}),N({type:"paren",extglob:!0,value:L(),output:o}),k.push(s)},M=e=>{let s,o=e.close+(i.capture?")":"");if("negate"===e.type){let n=w;if(e.inner&&e.inner.length>1&&e.inner.includes("/")&&(n=E(i)),(n!==w||I()||/^\)+$/.test(D()))&&(o=e.close=`)$))${n}`),e.inner.includes("*")&&(s=D())&&/^\.[^\\/.]+$/.test(s)){const i=ae(s,{...t,fastpaths:!1}).output;o=e.close=`)${i})${n})`}"bos"===e.prev.type&&(A.negatedExtglob=!0)}N({type:"paren",extglob:!0,value:T,output:o}),F("parens")};if(!1!==i.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(e)){let s=!1,o=e.replace(se,((e,t,i,o,n,r)=>"\\"===o?(s=!0,e):"?"===o?t?t+o+(n?v.repeat(n.length):""):0===r?R+(n?v.repeat(n.length):""):v.repeat(i.length):"."===o?c.repeat(i.length):"*"===o?t?t+o+(n?w:""):w:t?e:`\\${e}`));return!0===s&&(o=!0===i.unescape?o.replace(/\\/g,""):o.replace(/\\+/g,(e=>e.length%2==0?"\\\\":e?"\\":""))),o===e&&!0===i.contains?(A.output=e,A):(A.output=V.wrapOutput(o,A,t),A)}for(;!I();){if(T=L(),"\0"===T)continue;if("\\"===T){const e=H();if("/"===e&&!0!==i.bash)continue;if("."===e||";"===e)continue;if(!e){T+="\\",N({type:"text",value:T});continue}const t=/^\\+/.exec(D());let s=0;if(t&&t[0].length>2&&(s=t[0].length,A.index+=s,s%2!=0&&(T+="\\")),!0===i.unescape?T=L():T+=L(),0===A.brackets){N({type:"text",value:T});continue}}if(A.brackets>0&&("]"!==T||"["===$.value||"[^"===$.value)){if(!1!==i.posix&&":"===T){const e=$.value.slice(1);if(e.includes("[")&&($.posix=!0,e.includes(":"))){const e=$.value.lastIndexOf("["),t=$.value.slice(0,e),i=$.value.slice(e+2),s=te[i];if(s){$.value=t+s,A.backtrack=!0,L(),n.output||1!==r.indexOf($)||(n.output=h);continue}}}("["===T&&":"!==H()||"-"===T&&"]"===H())&&(T=`\\${T}`),"]"!==T||"["!==$.value&&"[^"!==$.value||(T=`\\${T}`),!0===i.posix&&"!"===T&&"["===$.value&&(T="^"),$.value+=T,O({value:T});continue}if(1===A.quotes&&'"'!==T){T=V.escapeRegex(T),$.value+=T,O({value:T});continue}if('"'===T){A.quotes=1===A.quotes?0:1,!0===i.keepQuotes&&N({type:"text",value:T});continue}if("("===T){z("parens"),N({type:"paren",value:T});continue}if(")"===T){if(0===A.parens&&!0===i.strictBrackets)throw new SyntaxError(re("opening","("));const e=k[k.length-1];if(e&&A.parens===e.parens+1){M(k.pop());continue}N({type:"paren",value:T,output:A.parens?")":"\\)"}),F("parens");continue}if("["===T){if(!0!==i.nobracket&&D().includes("]"))z("brackets");else{if(!0!==i.nobracket&&!0===i.strictBrackets)throw new SyntaxError(re("closing","]"));T=`\\${T}`}N({type:"bracket",value:T});continue}if("]"===T){if(!0===i.nobracket||$&&"bracket"===$.type&&1===$.value.length){N({type:"text",value:T,output:`\\${T}`});continue}if(0===A.brackets){if(!0===i.strictBrackets)throw new SyntaxError(re("opening","["));N({type:"text",value:T,output:`\\${T}`});continue}F("brackets");const e=$.value.slice(1);if(!0===$.posix||"^"!==e[0]||e.includes("/")||(T=`/${T}`),$.value+=T,O({value:T}),!1===i.literalBrackets||V.hasRegexChars(e))continue;const t=V.escapeRegex($.value);if(A.output=A.output.slice(0,-$.value.length),!0===i.literalBrackets){A.output+=t,$.value=t;continue}$.value=`(${a}${t}|${$.value})`,A.output+=$.value;continue}if("{"===T&&!0!==i.nobrace){z("braces");const e={type:"brace",value:T,output:"(",outputIndex:A.output.length,tokensIndex:A.tokens.length};C.push(e),N(e);continue}if("}"===T){const e=C[C.length-1];if(!0===i.nobrace||!e){N({type:"text",value:T,output:T});continue}let t=")";if(!0===e.dots){const e=r.slice(),s=[];for(let t=e.length-1;t>=0&&(r.pop(),"brace"!==e[t].type);t--)"dots"!==e[t].type&&s.unshift(e[t].value);t=ne(s,i),A.backtrack=!0}if(!0!==e.comma&&!0!==e.dots){const i=A.output.slice(0,e.outputIndex),s=A.tokens.slice(e.tokensIndex);e.value=e.output="\\{",T=t="\\}",A.output=i;for(const e of s)A.output+=e.output||e.value}N({type:"brace",value:T,output:t}),F("braces"),C.pop();continue}if("|"===T){k.length>0&&k[k.length-1].conditions++,N({type:"text",value:T});continue}if(","===T){let e=T;const t=C[C.length-1];t&&"braces"===U[U.length-1]&&(t.comma=!0,e="|"),N({type:"comma",value:T,output:e});continue}if("/"===T){if("dot"===$.type&&A.index===A.start+1){A.start=A.index+1,A.consumed="",A.output="",r.pop(),$=n;continue}N({type:"slash",value:T,output:d});continue}if("."===T){if(A.braces>0&&"dot"===$.type){"."===$.value&&($.output=c);const e=C[C.length-1];$.type="dots",$.output+=T,$.value+=T,e.dots=!0;continue}if(A.braces+A.parens===0&&"bos"!==$.type&&"slash"!==$.type){N({type:"text",value:T,output:c});continue}N({type:"dot",value:T,output:c});continue}if("?"===T){if(!($&&"("===$.value)&&!0!==i.noextglob&&"("===H()&&"?"!==H(2)){q("qmark",T);continue}if($&&"paren"===$.type){const e=H();let t=T;("("===$.value&&!/[!=<:]/.test(e)||"<"===e&&!/<([!=]|\w+>)/.test(D()))&&(t=`\\${T}`),N({type:"text",value:T,output:t});continue}if(!0!==i.dot&&("slash"===$.type||"bos"===$.type)){N({type:"qmark",value:T,output:y});continue}N({type:"qmark",value:T,output:v});continue}if("!"===T){if(!0!==i.noextglob&&"("===H()&&("?"!==H(2)||!/[!=<:]/.test(H(3)))){q("negate",T);continue}if(!0!==i.nonegate&&0===A.index){j();continue}}if("+"===T){if(!0!==i.noextglob&&"("===H()&&"?"!==H(2)){q("plus",T);continue}if($&&"("===$.value||!1===i.regex){N({type:"plus",value:T,output:u});continue}if($&&("bracket"===$.type||"paren"===$.type||"brace"===$.type)||A.parens>0){N({type:"plus",value:T});continue}N({type:"plus",value:u});continue}if("@"===T){if(!0!==i.noextglob&&"("===H()&&"?"!==H(2)){N({type:"at",extglob:!0,value:T,output:""});continue}N({type:"text",value:T});continue}if("*"!==T){"$"!==T&&"^"!==T||(T=`\\${T}`);const e=ie.exec(D());e&&(T+=e[0],A.index+=e[0].length),N({type:"text",value:T});continue}if($&&("globstar"===$.type||!0===$.star)){$.type="star",$.star=!0,$.value+=T,$.output=w,A.backtrack=!0,A.globstar=!0,P(T);continue}let t=D();if(!0!==i.noextglob&&/^\([^?]/.test(t)){q("star",T);continue}if("star"===$.type){if(!0===i.noglobstar){P(T);continue}const s=$.prev,o=s.prev,n="slash"===s.type||"bos"===s.type,r=o&&("star"===o.type||"globstar"===o.type);if(!0===i.bash&&(!n||t[0]&&"/"!==t[0])){N({type:"star",value:T,output:""});continue}const a=A.braces>0&&("comma"===s.type||"brace"===s.type),l=k.length&&("pipe"===s.type||"paren"===s.type);if(!n&&"paren"!==s.type&&!a&&!l){N({type:"star",value:T,output:""});continue}for(;"/**"===t.slice(0,3);){const i=e[A.index+4];if(i&&"/"!==i)break;t=t.slice(3),P("/**",3)}if("bos"===s.type&&I()){$.type="globstar",$.value+=T,$.output=E(i),A.output=$.output,A.globstar=!0,P(T);continue}if("slash"===s.type&&"bos"!==s.prev.type&&!r&&I()){A.output=A.output.slice(0,-(s.output+$.output).length),s.output=`(?:${s.output}`,$.type="globstar",$.output=E(i)+(i.strictSlashes?")":"|$)"),$.value+=T,A.globstar=!0,A.output+=s.output+$.output,P(T);continue}if("slash"===s.type&&"bos"!==s.prev.type&&"/"===t[0]){const e=void 0!==t[1]?"|$":"";A.output=A.output.slice(0,-(s.output+$.output).length),s.output=`(?:${s.output}`,$.type="globstar",$.output=`${E(i)}${d}|${d}${e})`,$.value+=T,A.output+=s.output+$.output,A.globstar=!0,P(T+L()),N({type:"slash",value:"/",output:""});continue}if("bos"===s.type&&"/"===t[0]){$.type="globstar",$.value+=T,$.output=`(?:^|${d}|${E(i)}${d})`,A.output=$.output,A.globstar=!0,P(T+L()),N({type:"slash",value:"/",output:""});continue}A.output=A.output.slice(0,-$.output.length),$.type="globstar",$.output=E(i),$.value+=T,A.output+=$.output,A.globstar=!0,P(T);continue}const s={type:"star",value:T,output:w};!0!==i.bash?!$||"bracket"!==$.type&&"paren"!==$.type||!0!==i.regex?(A.index!==A.start&&"slash"!==$.type&&"dot"!==$.type||("dot"===$.type?(A.output+=g,$.output+=g):!0===i.dot?(A.output+=x,$.output+=x):(A.output+=S,$.output+=S),"*"!==H()&&(A.output+=h,$.output+=h)),N(s)):(s.output=T,N(s)):(s.output=".*?","bos"!==$.type&&"slash"!==$.type||(s.output=S+s.output),N(s))}for(;A.brackets>0;){if(!0===i.strictBrackets)throw new SyntaxError(re("closing","]"));A.output=V.escapeLast(A.output,"["),F("brackets")}for(;A.parens>0;){if(!0===i.strictBrackets)throw new SyntaxError(re("closing",")"));A.output=V.escapeLast(A.output,"("),F("parens")}for(;A.braces>0;){if(!0===i.strictBrackets)throw new SyntaxError(re("closing","}"));A.output=V.escapeLast(A.output,"{"),F("braces")}if(!0===i.strictSlashes||"star"!==$.type&&"bracket"!==$.type||N({type:"maybe_slash",value:"",output:`${d}?`}),!0===A.backtrack){A.output="";for(const e of A.tokens)A.output+=null!=e.output?e.output:e.value,e.suffix&&(A.output+=e.suffix)}return A};ae.fastpaths=(e,t)=>{const i={...t},s="number"==typeof i.maxLength?Math.min(ee,i.maxLength):ee,o=e.length;if(o>s)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${s}`);e=oe[e]||e;const{DOT_LITERAL:n,SLASH_LITERAL:r,ONE_CHAR:a,DOTS_SLASH:l,NO_DOT:p,NO_DOTS:c,NO_DOTS_SLASH:u,STAR:d,START_ANCHOR:h}=Y.globChars(i.windows),f=i.dot?c:p,m=i.dot?u:p,g=i.capture?"":"?:";let x=!0===i.bash?".*?":d;i.capture&&(x=`(${x})`);const v=e=>!0===e.noglobstar?x:`(${g}(?:(?!${h}${e.dot?l:n}).)*?)`,y=e=>{switch(e){case"*":return`${f}${a}${x}`;case".*":return`${n}${a}${x}`;case"*.*":return`${f}${x}${n}${a}${x}`;case"*/*":return`${f}${x}${r}${a}${m}${x}`;case"**":return f+v(i);case"**/*":return`(?:${f}${v(i)}${r})?${m}${a}${x}`;case"**/*.*":return`(?:${f}${v(i)}${r})?${m}${x}${n}${a}${x}`;case"**/.*":return`(?:${f}${v(i)}${r})?${n}${a}${x}`;default:{const t=/^(.*?)\.(\w+)$/.exec(e);if(!t)return;const i=y(t[1]);if(!i)return;return i+n+t[2]}}},_=V.removePrefix(e,{negated:!1,prefix:""});let b=y(_);return b&&!0!==i.strictSlashes&&(b+=`${r}?`),b};const le=J,pe=ae,ce=b,ue=I,de=(e,t,i=!1)=>{if(Array.isArray(e)){const s=e.map((e=>de(e,t,i))),o=e=>{for(const t of s){const i=t(e);if(i)return i}return!1};return o}const s=(o=e)&&"object"==typeof o&&!Array.isArray(o)&&e.tokens&&e.input;var o;if(""===e||"string"!=typeof e&&!s)throw new TypeError("Expected pattern to be a non-empty string");const n=t||{},r=n.windows,a=s?de.compileRe(e,t):de.makeRe(e,t,!1,!0),l=a.state;delete a.state;let p=()=>!1;if(n.ignore){const e={...t,ignore:null,onMatch:null,onResult:null};p=de(n.ignore,e,i)}const c=(i,s=!1)=>{const{isMatch:o,match:c,output:u}=de.test(i,a,t,{glob:e,posix:r}),d={glob:e,state:l,regex:a,posix:r,input:i,output:u,match:c,isMatch:o};return"function"==typeof n.onResult&&n.onResult(d),!1===o?(d.isMatch=!1,!!s&&d):p(i)?("function"==typeof n.onIgnore&&n.onIgnore(d),d.isMatch=!1,!!s&&d):("function"==typeof n.onMatch&&n.onMatch(d),!s||d)};return i&&(c.state=l),c};de.test=(e,t,i,{glob:s,posix:o}={})=>{if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(""===e)return{isMatch:!1,output:""};const n=i||{},r=n.format||(o?ce.toPosixSlashes:null);let a=e===s,l=a&&r?r(e):e;return!1===a&&(l=r?r(e):e,a=l===s),!1!==a&&!0!==n.capture||(a=!0===n.matchBase||!0===n.basename?de.matchBase(e,t,i,o):t.exec(l)),{isMatch:Boolean(a),match:a,output:l}},de.matchBase=(e,t,i)=>(t instanceof RegExp?t:de.makeRe(t,i)).test(ce.basename(e)),de.isMatch=(e,t,i)=>de(t,i)(e),de.parse=(e,t)=>Array.isArray(e)?e.map((e=>de.parse(e,t))):pe(e,{...t,fastpaths:!1}),de.scan=(e,t)=>le(e,t),de.compileRe=(e,t,i=!1,s=!1)=>{if(!0===i)return e.output;const o=t||{},n=o.contains?"":"^",r=o.contains?"":"$";let a=`${n}(?:${e.output})${r}`;e&&!0===e.negated&&(a=`^(?!${a}).*$`);const l=de.toRegex(a,t);return!0===s&&(l.state=e),l},de.makeRe=(e,t={},i=!1,s=!1)=>{if(!e||"string"!=typeof e)throw new TypeError("Expected a non-empty string");let o={negated:!1,fastpaths:!0};return!1===t.fastpaths||"."!==e[0]&&"*"!==e[0]||(o.output=pe.fastpaths(e,t)),o.output||(o=pe(e,t)),de.compileRe(o,t,i,s)},de.toRegex=(e,t)=>{try{const i=t||{};return new RegExp(e,i.flags||(i.nocase?"i":""))}catch(e){if(t&&!0===t.debug)throw e;return/$^/}},de.constants=ue;var he=c(de);class fe{constructor(e){s(this,"extensions",void 0),s(this,"mimeTypes",void 0);const[t,i]=(e=>{const t=[],i=[];return e.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{e.startsWith(".")?t.push(`*${e}`):i.push(e)})),[t,i]})(e);this.extensions=t,this.mimeTypes=i}isAccepted(e){return 0===this.extensions.length&&0===this.mimeTypes.length||(this.isMimeTypeAccepted(_.getType(e))||this.isExtensionAccepted(e))}isMimeTypeAccepted(e){return!(!e||0===this.mimeTypes.length)&&he.isMatch(e,this.mimeTypes)}isExtensionAccepted(e){return 0!==this.extensions.length&&he.isMatch(e,this.extensions)}}const me=async e=>new Promise(((t,i)=>e.createReader().readEntries(t,i))),ge=async e=>new Promise(((t,i)=>e.file(t,i))),xe=async e=>{const t=[];for await(const i of e)if(i.isFile){const e=await ge(i);t.push(e)}else if(i.isDirectory){const e=await me(i);(await xe(e)).forEach((e=>t.push(e)))}return t};class ve{constructor(e){let{container:t,inputAccept:i,onUploadFiles:o,renderer:n}=e;s(this,"acceptedFileTypes",void 0),s(this,"container",void 0),s(this,"onUploadFiles",void 0),s(this,"renderer",void 0),s(this,"onDrop",(e=>{const t=e;this.container.classList.remove("dff-dropping"),t.preventDefault(),t.stopPropagation();(async()=>{try{if(t.dataTransfer){const e=await(async e=>{if(e.items){const t=[...e.items].map((e=>e.webkitGetAsEntry()));return await xe(t)}return[...e.files]})(t.dataTransfer),i=[],s=[];for(const t of e)this.acceptedFileTypes.isAccepted(t.name)?i.push(t):s.push(t);this.renderer.setErrorInvalidFiles(s),this.onUploadFiles(i)}}catch(e){console.error(e)}})()})),this.container=t,this.onUploadFiles=o,this.acceptedFileTypes=new fe(i),this.renderer=n,t.addEventListener("dragenter",(()=>{t.classList.add("dff-dropping")})),t.addEventListener("dragleave",(()=>{t.classList.remove("dff-dropping")})),t.addEventListener("dragover",(e=>{t.classList.add("dff-dropping"),e.preventDefault()})),t.addEventListener("drop",this.onDrop)}}let ye=class{constructor(e){let{name:t,status:i,type:o,uploadIndex:n}=e;s(this,"name",void 0),s(this,"status",void 0),s(this,"type",void 0),s(this,"uploadIndex",void 0),this.name=t,this.status=i,this.type=o,this.uploadIndex=n}async abort(){}async delete(){}};function _e(){return function(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var i=e.shift();e[0]=i+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var s=0;s<e.length;s++){var o=e[s];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(s>0&&(o=o.replace(/^[\/]+/,"")),o=s<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var n=t.join("/"),r=(n=n.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return r.shift()+(r.length>0?"?":"")+r.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}const be=(e,t)=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)};class Ee extends ye{constructor(e){let{csrfToken:t,endpoint:i,file:o,s3UploadDir:n,uploadIndex:r}=e;super({name:o.name,status:"uploading",type:"s3",uploadIndex:r}),s(this,"onError",void 0),s(this,"onProgress",void 0),s(this,"onSuccess",void 0),s(this,"chunkState",void 0),s(this,"chunks",void 0),s(this,"createdPromise",void 0),s(this,"csrfToken",void 0),s(this,"endpoint",void 0),s(this,"file",void 0),s(this,"key",void 0),s(this,"parts",void 0),s(this,"s3UploadDir",void 0),s(this,"uploadId",void 0),s(this,"uploading",void 0),this.csrfToken=t,this.endpoint=i,this.file=o,this.s3UploadDir=n,this.key=null,this.uploadId=null,this.parts=[],this.createdPromise=Promise.reject(),this.chunks=[],this.chunkState=[],this.uploading=[],this.onError=void 0,this.onProgress=void 0,this.onSuccess=void 0,this.initChunks(),this.createdPromise.catch((()=>({})))}async abort(){this.uploading.slice().forEach((e=>{e.abort()})),this.uploading=[],await this.createdPromise,this.key&&this.uploadId&&await(e=>{let{csrfToken:t,key:i,uploadId:s,endpoint:o}=e;const n=encodeURIComponent(i),r=encodeURIComponent(s),a=new Headers({"X-CSRFToken":t}),l=_e(o,r,`?key=${n}`);return fetch(l,{method:"delete",headers:a}).then((e=>e.json()))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,uploadId:this.uploadId})}async delete(){return Promise.resolve()}getId(){return this.uploadId||void 0}getInitialFile(){return{id:this.uploadId||"",name:this.key||"",size:this.file.size,original_name:this.file.name,type:"s3"}}getSize(){return this.file.size}start(){this.createUpload()}initChunks(){const e=[],t=(i=this.file,Math.ceil(i.size/1e4));var i;const s=Math.max(5242880,Math.ceil(this.file.size/1e4)),o=Math.max(t,s);for(let t=0;t<this.file.size;t+=o){const i=Math.min(this.file.size,t+o);e.push(this.file.slice(t,i))}this.chunks=e,this.chunkState=e.map((()=>({uploaded:0,busy:!1,done:!1})))}createUpload(){return this.createdPromise=(e=>{let{csrfToken:t,endpoint:i,file:s,s3UploadDir:o}=e;const n=new Headers({accept:"application/json","content-type":"application/json","X-CSRFToken":t});return fetch(i,{method:"post",headers:n,body:JSON.stringify({filename:s.name,contentType:s.type,s3UploadDir:o})}).then((e=>e.json())).then((e=>e))})({csrfToken:this.csrfToken,endpoint:this.endpoint,file:this.file,s3UploadDir:this.s3UploadDir}),this.createdPromise.then((e=>{if(!("object"==typeof e&&e&&"string"==typeof e.uploadId&&"string"==typeof e.key))throw new TypeError("AwsS3/Multipart: Got incorrect result from `createMultipartUpload()`, expected an object `{ uploadId, key }`.");this.key=e.key,this.uploadId=e.uploadId,this.uploadParts()})).catch((e=>{this.handleError(e)}))}uploadParts(){const e=1-this.uploading.length;if(0===e)return;if(this.chunkState.every((e=>e.done)))return void this.completeUpload();const t=[];for(let i=0;i<this.chunkState.length;i++){const s=this.chunkState[i];if(s&&!s.done&&!s.busy&&(t.push(i),t.length>=e))break}t.forEach((e=>{this.uploadPart(e)}))}uploadPart(e){const t=this.chunkState[e];return t&&(t.busy=!0),this.key&&this.uploadId?(e=>{let{csrfToken:t,endpoint:i,key:s,number:o,uploadId:n}=e;const r=encodeURIComponent(s),a=new Headers({"X-CSRFToken":t}),l=_e(i,n,`${o}`,`?key=${r}`);return fetch(l,{method:"get",headers:a}).then((e=>e.json())).then((e=>e))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,number:e+1,uploadId:this.uploadId}).then((e=>{if(!("object"==typeof e&&e&&"string"==typeof e.url))throw new TypeError("AwsS3/Multipart: Got incorrect result from `prepareUploadPart()`, expected an object `{ url }`.");return e})).then((t=>{let{url:i}=t;this.uploadPartBytes(e,i)}),(e=>{this.handleError(e)})):Promise.resolve()}onPartProgress(e,t){const i=this.chunkState[e];if(i&&(i.uploaded=t),this.onProgress){const e=this.chunkState.reduce(((e,t)=>e+t.uploaded),0);this.onProgress(e,this.file.size)}}onPartComplete(e,t){const i=this.chunkState[e];i&&(i.etag=t,i.done=!0);const s={PartNumber:e+1,ETag:t};this.parts.push(s),this.uploadParts()}uploadPartBytes(e,t){const i=this.chunks[e],s=new XMLHttpRequest;s.open("PUT",t,!0),s.responseType="text",this.uploading.push(s),s.upload.addEventListener("progress",(t=>{t.lengthComputable&&this.onPartProgress(e,t.loaded)})),s.addEventListener("abort",(t=>{be(this.uploading,t.target);const i=this.chunkState[e];i&&(i.busy=!1)})),s.addEventListener("load",(t=>{const s=t.target;be(this.uploading,s);const o=this.chunkState[e];if(o&&(o.busy=!1),s.status<200||s.status>=300)return void this.handleError(new Error("Non 2xx"));this.onPartProgress(e,i?.size||0);const n=s.getResponseHeader("ETag");null!==n?this.onPartComplete(e,n):this.handleError(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."))})),s.addEventListener("error",(t=>{be(this.uploading,t.target);const i=this.chunkState[e];i&&(i.busy=!1);const s=new Error("Unknown error");this.handleError(s)})),s.send(i)}completeUpload(){return this.parts.sort(((e,t)=>e.PartNumber-t.PartNumber)),this.uploadId&&this.key?(e=>{let{csrfToken:t,key:i,uploadId:s,parts:o,endpoint:n}=e;const r=encodeURIComponent(i),a=encodeURIComponent(s),l=new Headers({"X-CSRFToken":t}),p=_e(n,a,"complete",`?key=${r}`);return fetch(p,{method:"post",headers:l,body:JSON.stringify({parts:o})}).then((e=>e.json())).then((e=>e))})({csrfToken:this.csrfToken,endpoint:this.endpoint,key:this.key,uploadId:this.uploadId,parts:this.parts}).then((()=>{this.onSuccess&&this.onSuccess()}),(e=>{this.handleError(e)})):Promise.resolve()}handleError(e){if(!this.onError)throw e;this.onError(e)}}const Se=async(e,t)=>new Promise(((i,s)=>{const o=new XMLHttpRequest;o.open("DELETE",e),o.onload=()=>{204===o.status?i():s()},o.setRequestHeader("Tus-Resumable","1.0.0"),o.setRequestHeader("X-CSRFToken",t),o.send(null)}));class Re extends ye{constructor(e){let{name:t,size:i,type:o,uploadIndex:n}=e;super({name:t,status:"done",type:o,uploadIndex:n}),s(this,"size",void 0),this.size=i}async abort(){return Promise.resolve()}async delete(){return Promise.resolve()}getSize(){return this.size}}class we extends Re{constructor(e,t){super({name:e.name,size:e.size,type:"placeholder",uploadIndex:t}),s(this,"id",void 0),this.id=e.id}getId(){}getInitialFile(){return{id:this.id,name:this.name,size:this.size,type:"placeholder"}}}class Ae extends Re{constructor(e,t){super({name:e.original_name||e.name,size:e.size,type:"uploadedS3",uploadIndex:t}),s(this,"id",void 0),s(this,"key",void 0),this.id=e.id,this.key=e.name}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.key,original_name:this.name,size:this.size,type:"s3"}}}class ke extends Re{constructor(e,t){super({name:e.name,size:e.size,type:"existing",uploadIndex:t})}getId(){}getInitialFile(){return{name:this.name,size:this.size,type:"existing"}}}class Ce extends Re{constructor(e){let{csrfToken:t,initialFile:i,uploadIndex:o,uploadUrl:n}=e;super({name:i.name,size:i.size,type:"uploadedTus",uploadIndex:o}),s(this,"csrfToken",void 0),s(this,"id",void 0),s(this,"url",void 0),this.csrfToken=t,this.id=i.id,this.url=`${n}${i.id}`}async delete(){await Se(this.url,this.csrfToken)}getId(){return this.id}getInitialFile(){return{id:this.id,name:this.name,size:this.size,type:"tus",url:""}}}const Ue="function"==typeof Buffer,Te=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),$e=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Ie=(e=>{let t={};return e.forEach(((e,i)=>t[e]=i)),t})($e),He=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Le=String.fromCharCode.bind(String),De=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),Pe=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Oe=e=>{let t,i,s,o,n="";const r=e.length%3;for(let r=0;r<e.length;){if((i=e.charCodeAt(r++))>255||(s=e.charCodeAt(r++))>255||(o=e.charCodeAt(r++))>255)throw new TypeError("invalid character found");t=i<<16|s<<8|o,n+=$e[t>>18&63]+$e[t>>12&63]+$e[t>>6&63]+$e[63&t]}return r?n.slice(0,r-3)+"===".substring(r):n},je="function"==typeof btoa?e=>btoa(e):Ue?e=>Buffer.from(e,"binary").toString("base64"):Oe,ze=Ue?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let i=0,s=e.length;i<s;i+=4096)t.push(Le.apply(null,e.subarray(i,i+4096)));return je(t.join(""))},Fe=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?Le(192|t>>>6)+Le(128|63&t):Le(224|t>>>12&15)+Le(128|t>>>6&63)+Le(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return Le(240|t>>>18&7)+Le(128|t>>>12&63)+Le(128|t>>>6&63)+Le(128|63&t)},Ne=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,qe=e=>e.replace(Ne,Fe),Me=Ue?e=>Buffer.from(e,"utf8").toString("base64"):Te?e=>ze(Te.encode(e)):e=>je(qe(e)),Be=(e,t=!1)=>t?De(Me(e)):Me(e),Ge=e=>{if(e=e.replace(/\s+/g,""),!He.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,i,s,o="";for(let n=0;n<e.length;)t=Ie[e.charAt(n++)]<<18|Ie[e.charAt(n++)]<<12|(i=Ie[e.charAt(n++)])<<6|(s=Ie[e.charAt(n++)]),o+=64===i?Le(t>>16&255):64===s?Le(t>>16&255,t>>8&255):Le(t>>16&255,t>>8&255,255&t);return o},Ke=Be;var Xe={},Qe=Object.prototype.hasOwnProperty;function We(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function Ze(e){try{return encodeURIComponent(e)}catch(e){return null}}Xe.stringify=function(e,t){t=t||"";var i,s,o=[];for(s in"string"!=typeof t&&(t="?"),e)if(Qe.call(e,s)){if((i=e[s])||null!=i&&!isNaN(i)||(i=""),s=Ze(s),i=Ze(i),null===s||null===i)continue;o.push(s+"="+i)}return o.length?t+o.join("&"):""},Xe.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,s={};t=i.exec(e);){var o=We(t[1]),n=We(t[2]);null===o||null===n||o in s||(s[o]=n)}return s};var Je=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},Ye=Xe,Ve=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,et=/[\n\r\t]/g,tt=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,it=/:\d+$/,st=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,ot=/^[a-zA-Z]:/;function nt(e){return(e||"").toString().replace(Ve,"")}var rt=[["#","hash"],["?","query"],function(e,t){return pt(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],at={hash:1,query:1};function lt(e){var t,i=("undefined"!=typeof window?window:void 0!==p?p:"undefined"!=typeof self?self:{}).location||{},s={},o=typeof(e=e||i);if("blob:"===e.protocol)s=new ut(unescape(e.pathname),{});else if("string"===o)for(t in s=new ut(e,{}),at)delete s[t];else if("object"===o){for(t in e)t in at||(s[t]=e[t]);void 0===s.slashes&&(s.slashes=tt.test(e.href))}return s}function pt(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function ct(e,t){e=(e=nt(e)).replace(et,""),t=t||{};var i,s=st.exec(e),o=s[1]?s[1].toLowerCase():"",n=!!s[2],r=!!s[3],a=0;return n?r?(i=s[2]+s[3]+s[4],a=s[2].length+s[3].length):(i=s[2]+s[4],a=s[2].length):r?(i=s[3]+s[4],a=s[3].length):i=s[4],"file:"===o?a>=2&&(i=i.slice(2)):pt(o)?i=s[4]:o?n&&(i=i.slice(2)):a>=2&&pt(t.protocol)&&(i=s[4]),{protocol:o,slashes:n||pt(o),slashesCount:a,rest:i}}function ut(e,t,i){if(e=(e=nt(e)).replace(et,""),!(this instanceof ut))return new ut(e,t,i);var s,o,n,r,a,l,p=rt.slice(),c=typeof t,u=this,d=0;for("object"!==c&&"string"!==c&&(i=t,t=null),i&&"function"!=typeof i&&(i=Ye.parse),s=!(o=ct(e||"",t=lt(t))).protocol&&!o.slashes,u.slashes=o.slashes||s&&t.slashes,u.protocol=o.protocol||t.protocol||"",e=o.rest,("file:"===o.protocol&&(2!==o.slashesCount||ot.test(e))||!o.slashes&&(o.protocol||o.slashesCount<2||!pt(u.protocol)))&&(p[3]=[/(.*)/,"pathname"]);d<p.length;d++)"function"!=typeof(r=p[d])?(n=r[0],l=r[1],n!=n?u[l]=e:"string"==typeof n?~(a="@"===n?e.lastIndexOf(n):e.indexOf(n))&&("number"==typeof r[2]?(u[l]=e.slice(0,a),e=e.slice(a+r[2])):(u[l]=e.slice(a),e=e.slice(0,a))):(a=n.exec(e))&&(u[l]=a[1],e=e.slice(0,a.index)),u[l]=u[l]||s&&r[3]&&t[l]||"",r[4]&&(u[l]=u[l].toLowerCase())):e=r(e,u);i&&(u.query=i(u.query)),s&&t.slashes&&"/"!==u.pathname.charAt(0)&&(""!==u.pathname||""!==t.pathname)&&(u.pathname=function(e,t){if(""===e)return t;for(var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),s=i.length,o=i[s-1],n=!1,r=0;s--;)"."===i[s]?i.splice(s,1):".."===i[s]?(i.splice(s,1),r++):r&&(0===s&&(n=!0),i.splice(s,1),r--);return n&&i.unshift(""),"."!==o&&".."!==o||i.push(""),i.join("/")}(u.pathname,t.pathname)),"/"!==u.pathname.charAt(0)&&pt(u.protocol)&&(u.pathname="/"+u.pathname),Je(u.port,u.protocol)||(u.host=u.hostname,u.port=""),u.username=u.password="",u.auth&&(~(a=u.auth.indexOf(":"))?(u.username=u.auth.slice(0,a),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=u.auth.slice(a+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(u.auth)),u.auth=u.password?u.username+":"+u.password:u.username),u.origin="file:"!==u.protocol&&pt(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString()}ut.prototype={set:function(e,t,i){var s=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||Ye.parse)(t)),s[e]=t;break;case"port":s[e]=t,Je(t,s.protocol)?t&&(s.host=s.hostname+":"+t):(s.host=s.hostname,s[e]="");break;case"hostname":s[e]=t,s.port&&(t+=":"+s.port),s.host=t;break;case"host":s[e]=t,it.test(t)?(t=t.split(":"),s.port=t.pop(),s.hostname=t.join(":")):(s.hostname=t,s.port="");break;case"protocol":s.protocol=t.toLowerCase(),s.slashes=!i;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";s[e]=t.charAt(0)!==o?o+t:t}else s[e]=t;break;case"username":case"password":s[e]=encodeURIComponent(t);break;case"auth":var n=t.indexOf(":");~n?(s.username=t.slice(0,n),s.username=encodeURIComponent(decodeURIComponent(s.username)),s.password=t.slice(n+1),s.password=encodeURIComponent(decodeURIComponent(s.password))):s.username=encodeURIComponent(decodeURIComponent(t))}for(var r=0;r<rt.length;r++){var a=rt[r];a[4]&&(s[a[1]]=s[a[1]].toLowerCase())}return s.auth=s.password?s.username+":"+s.password:s.username,s.origin="file:"!==s.protocol&&pt(s.protocol)&&s.host?s.protocol+"//"+s.host:"null",s.href=s.toString(),s},toString:function(e){e&&"function"==typeof e||(e=Ye.stringify);var t,i=this,s=i.host,o=i.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var n=o+(i.protocol&&i.slashes||pt(i.protocol)?"//":"");return i.username?(n+=i.username,i.password&&(n+=":"+i.password),n+="@"):i.password?(n+=":"+i.password,n+="@"):"file:"!==i.protocol&&pt(i.protocol)&&!s&&"/"!==i.pathname&&(n+="@"),(":"===s[s.length-1]||it.test(i.hostname)&&!i.port)&&(s+=":"),n+=s+i.pathname,(t="object"==typeof i.query?e(i.query):i.query)&&(n+="?"!==t.charAt(0)?"?"+t:t),i.hash&&(n+=i.hash),n}},ut.extractProtocol=ct,ut.location=lt,ut.trimLeft=nt,ut.qs=Ye;var dt=c(ut);class ht extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(super(e),this.originalRequest=i,this.originalResponse=s,this.causingError=t,null!=t&&(e+=`, caused by ${t.toString()}`),null!=i){const t=i.getHeader("X-Request-ID")||"n/a";e+=`, originated from request (method: ${i.getMethod()}, url: ${i.getURL()}, response code: ${s?s.getStatus():"n/a"}, response text: ${s?s.getBody()||"":"n/a"}, request id: ${t})`}this.message=e}}const ft={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:bt,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null};class mt{constructor(e,t){"resume"in t&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=t,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}static terminate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=vt("DELETE",e,t);return yt(i,null,t).then((e=>{if(204!==e.getStatus())throw new ht("tus: unexpected response while terminating upload",null,i,e)})).catch((s=>{if(s instanceof ht||(s=new ht("tus: failed to terminate upload",s,i,null)),!_t(s,0,t))throw s;const o=t.retryDelays[0],n=t.retryDelays.slice(1),r={...t,retryDelays:n};return new Promise((e=>setTimeout(e,o))).then((()=>mt.terminate(e,r)))}))}findPreviousUploads(){return this.options.fingerprint(this.file,this.options).then((e=>this._urlStorage.findUploadsByFingerprint(e)))}resumeFromPreviousUpload(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}start(){const{file:e}=this;if(!e)return void this._emitError(new Error("tus: no file or stream to upload provided"));if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url)return void this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));const{retryDelays:t}=this.options;if(null==t||"[object Array]"===Object.prototype.toString.call(t)){if(this.options.parallelUploads>1)for(const e of["uploadUrl","uploadSize","uploadLengthDeferred"])if(this.options[e])return void this._emitError(new Error(`tus: cannot use the ${e} option when parallelUploads is enabled`));if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(e,this.options).then((t=>(this._fingerprint=t,this._source?this._source:this.options.fileReader.openFile(e,this.options.chunkSize)))).then((e=>{if(this._source=e,this.options.uploadLengthDeferred)this._size=null;else if(null!=this.options.uploadSize){if(this._size=Number(this.options.uploadSize),Number.isNaN(this._size))return void this._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(this._size=this._source.size,null==this._size)return void this._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));this.options.parallelUploads>1||null!=this._parallelUploadUrls?this._startParallelUpload():this._startSingleUpload()})).catch((e=>{this._emitError(e)}))}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}_startParallelUpload(){const e=this._size;let t=0;this._parallelUploads=[];const i=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,s=this.options.parallelUploadBoundaries??function(e,t){const i=Math.floor(e/t),s=[];for(let e=0;e<t;e++)s.push({start:i*e,end:i*(e+1)});return s[t-1].end=e,s}(this._source.size,i);this._parallelUploadUrls&&s.forEach(((e,t)=>{e.uploadUrl=this._parallelUploadUrls[t]||null})),this._parallelUploadUrls=new Array(s.length);const o=s.map(((i,o)=>{let n=0;return this._source.slice(i.start,i.end).then((r=>{let{value:a}=r;return new Promise(((r,l)=>{const p={...this.options,uploadUrl:i.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:{},headers:{...this.options.headers,"Upload-Concat":"partial"},onSuccess:r,onError:l,onProgress:i=>{t=t-n+i,n=i,this._emitProgress(t,e)},onUploadUrlAvailable:()=>{this._parallelUploadUrls[o]=c.url,this._parallelUploadUrls.filter((e=>Boolean(e))).length===s.length&&this._saveUploadInUrlStorage()}},c=new mt(a,p);c.start(),this._parallelUploads.push(c)}))}))}));let n;Promise.all(o).then((()=>{n=this._openRequest("POST",this.options.endpoint),n.setHeader("Upload-Concat",`final;${this._parallelUploadUrls.join(" ")}`);const e=gt(this.options.metadata);return""!==e&&n.setHeader("Upload-Metadata",e),this._sendRequest(n,null)})).then((e=>{if(!xt(e.getStatus(),200))return void this._emitHttpError(n,e,"tus: unexpected response while creating upload");const t=e.getHeader("Location");null!=t?(this.url=Et(this.options.endpoint,t),this.url,this._emitSuccess()):this._emitHttpError(n,e,"tus: invalid or missing Location header")})).catch((e=>{this._emitError(e)}))}_startSingleUpload(){return this._aborted=!1,null!=this.url?(this.url,void this._resumeUpload()):null!=this.options.uploadUrl?(this.options.uploadUrl,this.url=this.options.uploadUrl,void this._resumeUpload()):void this._createUpload()}abort(e){return null!=this._parallelUploads&&this._parallelUploads.forEach((t=>{t.abort(e)})),null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),e&&null!=this.url?mt.terminate(this.url,this.options).then((()=>this._removeFromUrlStorage())):Promise.resolve()}_emitHttpError(e,t,i,s){this._emitError(new ht(i,s,e,t))}_emitError(e){if(!this._aborted){if(null!=this.options.retryDelays){if(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),_t(e,this._retryAttempt,this.options)){const e=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout((()=>{this.start()}),e))}}if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}}_emitSuccess(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess()}_emitProgress(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}_emitChunkComplete(e,t,i){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,i)}_createUpload(){if(!this.options.endpoint)return void this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));const e=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?e.setHeader("Upload-Defer-Length",1):e.setHeader("Upload-Length",this._size);const t=gt(this.options.metadata);let i;""!==t&&e.setHeader("Upload-Metadata",t),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,i=this._addChunkToRequest(e)):i=this._sendRequest(e,null),i.then((t=>{if(!xt(t.getStatus(),200))return void this._emitHttpError(e,t,"tus: unexpected response while creating upload");const i=t.getHeader("Location");if(null!=i){if(this.url=Et(this.options.endpoint,i),this.url,"function"==typeof this.options.onUploadUrlAvailable&&this.options.onUploadUrlAvailable(),0===this._size)return this._emitSuccess(),void this._source.close();this._saveUploadInUrlStorage().then((()=>{this.options.uploadDataDuringCreation?this._handleUploadResponse(e,t):(this._offset=0,this._performUpload())}))}else this._emitHttpError(e,t,"tus: invalid or missing Location header")})).catch((t=>{this._emitHttpError(e,null,"tus: failed to create upload",t)}))}_resumeUpload(){const e=this._openRequest("HEAD",this.url);this._sendRequest(e,null).then((t=>{const i=t.getStatus();if(!xt(i,200))return 423===i?void this._emitHttpError(e,t,"tus: upload is currently locked; retry later"):(xt(i,400)&&this._removeFromUrlStorage(),this.options.endpoint?(this.url=null,void this._createUpload()):void this._emitHttpError(e,t,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));const s=parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(s))return void this._emitHttpError(e,t,"tus: invalid or missing offset value");const o=parseInt(t.getHeader("Upload-Length"),10);!Number.isNaN(o)||this.options.uploadLengthDeferred?("function"==typeof this.options.onUploadUrlAvailable&&this.options.onUploadUrlAvailable(),this._saveUploadInUrlStorage().then((()=>{if(s===o)return this._emitProgress(o,o),void this._emitSuccess();this._offset=s,this._performUpload()}))):this._emitHttpError(e,t,"tus: invalid or missing length value")})).catch((t=>{this._emitHttpError(e,null,"tus: failed to resume upload",t)}))}_performUpload(){if(this._aborted)return;let e;this.options.overridePatchMethod?(e=this._openRequest("POST",this.url),e.setHeader("X-HTTP-Method-Override","PATCH")):e=this._openRequest("PATCH",this.url),e.setHeader("Upload-Offset",this._offset);this._addChunkToRequest(e).then((t=>{xt(t.getStatus(),200)?this._handleUploadResponse(e,t):this._emitHttpError(e,t,"tus: unexpected response while uploading chunk")})).catch((t=>{this._aborted||this._emitHttpError(e,null,`tus: failed to upload chunk at offset ${this._offset}`,t)}))}_addChunkToRequest(e){const t=this._offset;let i=this._offset+this.options.chunkSize;return e.setProgressHandler((e=>{this._emitProgress(t+e,this._size)})),e.setHeader("Content-Type","application/offset+octet-stream"),(i===1/0||i>this._size)&&!this.options.uploadLengthDeferred&&(i=this._size),this._source.slice(t,i).then((t=>{let{value:i,done:s}=t;const o=i&&i.size?i.size:0;this.options.uploadLengthDeferred&&s&&(this._size=this._offset+o,e.setHeader("Upload-Length",this._size));const n=this._offset+o;return!this.options.uploadLengthDeferred&&s&&n!==this._size?Promise.reject(new Error(`upload was configured with a size of ${this._size} bytes, but the source is done after ${n} bytes`)):null===i?this._sendRequest(e):(this._emitProgress(this._offset,this._size),this._sendRequest(e,i))}))}_handleUploadResponse(e,t){const i=parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(i))this._emitHttpError(e,t,"tus: invalid or missing offset value");else{if(this._emitProgress(i,this._size),this._emitChunkComplete(i-this._offset,i,this._size),this._offset=i,i===this._size)return this._emitSuccess(),void this._source.close();this._performUpload()}}_openRequest(e,t){const i=vt(e,t,this.options);return this._req=i,i}_removeFromUrlStorage(){this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch((e=>{this._emitError(e)})),this._urlStorageKey=null)}_saveUploadInUrlStorage(){if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();const e={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?e.parallelUploadUrls=this._parallelUploadUrls:e.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,e).then((e=>{this._urlStorageKey=e}))}_sendRequest(e){return yt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}function gt(e){return Object.entries(e).map((e=>{let[t,i]=e;return`${t} ${Ke(String(i))}`})).join(",")}function xt(e,t){return e>=t&&e<t+100}function vt(e,t,i){const s=i.httpStack.createRequest(e,t);s.setHeader("Tus-Resumable","1.0.0");const o=i.headers||{};if(Object.entries(o).forEach((e=>{let[t,i]=e;s.setHeader(t,i)})),i.addRequestId){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));s.setHeader("X-Request-ID",e)}return s}async function yt(e,t,i){"function"==typeof i.onBeforeRequest&&await i.onBeforeRequest(e);const s=await e.send(t);return"function"==typeof i.onAfterResponse&&await i.onAfterResponse(e,s),s}function _t(e,t,i){return!(null==i.retryDelays||t>=i.retryDelays.length||null==e.originalRequest)&&(i&&"function"==typeof i.onShouldRetry?i.onShouldRetry(e,t,i):bt(e))}function bt(e){const t=e.originalResponse?e.originalResponse.getStatus():0;return(!xt(t,400)||409===t||423===t)&&function(){let e=!0;return"undefined"!=typeof navigator&&!1===navigator.onLine&&(e=!1),e}()}function Et(e,t){return new dt(t,e).toString()}mt.defaultOptions=ft;let St=!1;try{St="localStorage"in window;const e="tusSupport",t=localStorage.getItem(e);localStorage.setItem(e,t),null===t&&localStorage.removeItem(e)}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;St=!1}const Rt=St;class wt{constructor(e,t){this._xhr=new XMLHttpRequest,this._xhr.open(e,t,!0),this._method=e,this._url=t,this._headers={}}getMethod(){return this._method}getURL(){return this._url}setHeader(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}getHeader(e){return this._headers[e]}setProgressHandler(e){"upload"in this._xhr&&(this._xhr.upload.onprogress=t=>{t.lengthComputable&&e(t.loaded)})}send(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(((t,i)=>{this._xhr.onload=()=>{t(new At(this._xhr))},this._xhr.onerror=e=>{i(e)},this._xhr.send(e)}))}abort(){return this._xhr.abort(),Promise.resolve()}getUnderlyingObject(){return this._xhr}}class At{constructor(e){this._xhr=e}getStatus(){return this._xhr.status}getHeader(e){return this._xhr.getResponseHeader(e)}getBody(){return this._xhr.responseText}getUnderlyingObject(){return this._xhr}}const kt=()=>"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Ct{constructor(e){this._file=e,this.size=e.size}slice(e,t){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return i=this._file.slice(e,t),new Promise(((e,t)=>{const s=new FileReader;s.onload=()=>{const t=new Uint8Array(s.result);e({value:t})},s.onerror=e=>{t(e)},s.readAsArrayBuffer(i)}));var i;const s=this._file.slice(e,t),o=t>=this.size;return Promise.resolve({value:s,done:o})}close(){}}function Ut(e){return void 0===e?0:void 0!==e.size?e.size:e.length}class Tt{constructor(e){this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}slice(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}_readUntilEnoughDataOrDone(e,t){const i=t<=this._bufferOffset+Ut(this._buffer);if(this._done||i){const i=this._getDataFromBuffer(e,t),s=null==i&&this._done;return Promise.resolve({value:i,done:s})}return this._reader.read().then((i=>{let{value:s,done:o}=i;return o?this._done=!0:void 0===this._buffer?this._buffer=s:this._buffer=function(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){const i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i}throw new Error("Unknown data type")}(this._buffer,s),this._readUntilEnoughDataOrDone(e,t)}))}_getDataFromBuffer(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);const i=0===Ut(this._buffer);return this._done&&i?null:this._buffer.slice(0,t-e)}close(){this._reader.cancel&&this._reader.cancel()}}const $t={...mt.defaultOptions,httpStack:new class{createRequest(e,t){return new wt(e,t)}getName(){return"XHRHttpStack"}},fileReader:new class{async openFile(e,t){if(kt()&&e&&void 0!==e.uri)try{const t=await(i=e.uri,new Promise(((e,t)=>{const s=new XMLHttpRequest;s.responseType="blob",s.onload=()=>{const t=s.response;e(t)},s.onerror=e=>{t(e)},s.open("GET",i),s.send()})));return new Ct(t)}catch(e){throw new Error(`tus: cannot fetch \`file.uri\` as Blob, make sure the uri is correct and accessible. ${e}`)}var i;return"function"==typeof e.slice&&void 0!==e.size?Promise.resolve(new Ct(e)):"function"==typeof e.read?(t=Number(t),Number.isFinite(t)?Promise.resolve(new Tt(e,t)):Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment"))}},urlStorage:Rt?new class{findAllUploads(){const e=this._findEntries("tus::");return Promise.resolve(e)}findUploadsByFingerprint(e){const t=this._findEntries(`tus::${e}::`);return Promise.resolve(t)}removeUpload(e){return localStorage.removeItem(e),Promise.resolve()}addUpload(e,t){const i=`tus::${e}::${Math.round(1e12*Math.random())}`;return localStorage.setItem(i,JSON.stringify(t)),Promise.resolve(i)}_findEntries(e){const t=[];for(let i=0;i<localStorage.length;i++){const s=localStorage.key(i);if(0===s.indexOf(e))try{const e=JSON.parse(localStorage.getItem(s));e.urlStorageKey=s,t.push(e)}catch(e){}}return t}}:new class{listAllUploads(){return Promise.resolve([])}findUploadsByFingerprint(e){return Promise.resolve([])}removeUpload(e){return Promise.resolve()}addUpload(e,t){return Promise.resolve(null)}},fingerprint:function(e,t){return kt()?Promise.resolve(function(e,t){const i=e.exif?function(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++){t=(t<<5)-t+e.charCodeAt(i),t&=t}return t}(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",i,t.endpoint].join("/")}(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}};class It extends mt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t={...$t,...t},super(e,t)}static terminate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t={...$t,...t},mt.terminate(e,t)}}class Ht extends ye{constructor(e){let{chunkSize:t,csrfToken:i,fieldName:o,file:n,formId:r,retryDelays:a,uploadIndex:l,uploadUrl:p}=e;super({name:n.name,status:"uploading",type:"tus",uploadIndex:l}),s(this,"onError",void 0),s(this,"onProgress",void 0),s(this,"onSuccess",void 0),s(this,"id",void 0),s(this,"upload",void 0),s(this,"csrfToken",void 0),s(this,"handleError",(e=>{if(!this.onError)throw e;this.onError(e)})),s(this,"handleProgress",((e,t)=>{this.onProgress&&this.onProgress(e,t)})),s(this,"handleSucces",(()=>{this.onSuccess&&this.onSuccess()})),s(this,"addCsrTokenToRequest",(e=>{e.setHeader("X-CSRFToken",this.csrfToken)})),s(this,"handleAfterReponse",((e,t)=>{const i=t.getHeader("ResourceId");i&&(this.id=i)})),this.csrfToken=i,this.upload=new It(n,{chunkSize:t,endpoint:p,metadata:{fieldName:o,filename:n.name,formId:r},onAfterResponse:this.handleAfterReponse,onBeforeRequest:this.addCsrTokenToRequest,onError:this.handleError,onProgress:this.handleProgress,onSuccess:this.handleSucces,retryDelays:a||[0,1e3,3e3,5e3]}),this.onError=void 0,this.onProgress=void 0,this.onSuccess=void 0}async abort(){await this.upload.abort(!0)}async delete(){if(!this.upload.url)return Promise.resolve();await Se(this.upload.url,this.csrfToken)}getId(){return this.id}getSize(){return this.upload.file.size}start(){this.upload.start()}getInitialFile(){return{id:this.id,name:this.name,size:this.getSize(),type:"tus",url:""}}}class Lt{constructor(e){let{callbacks:t,chunkSize:i,csrfToken:o,eventEmitter:n,fieldName:r,form:a,formId:l,initial:p,input:c,multiple:u,parent:d,prefix:h,retryDelays:m,s3UploadDir:g,skipRequired:x,supportDropArea:v,translations:y,uploadUrl:_}=e;s(this,"acceptedFileTypes",void 0),s(this,"callbacks",void 0),s(this,"chunkSize",void 0),s(this,"csrfToken",void 0),s(this,"eventEmitter",void 0),s(this,"fieldName",void 0),s(this,"form",void 0),s(this,"formId",void 0),s(this,"multiple",void 0),s(this,"nextUploadIndex",void 0),s(this,"prefix",void 0),s(this,"renderer",void 0),s(this,"retryDelays",void 0),s(this,"s3UploadDir",void 0),s(this,"supportDropArea",void 0),s(this,"uploads",void 0),s(this,"uploadUrl",void 0),s(this,"uploadFiles",(async e=>{if(0!==e.length){if(this.multiple)for await(const t of e)await this.uploadFile(t);else{for(const e of this.uploads)this.renderer.deleteFile(e.uploadIndex);this.uploads=[];const t=e[0];t&&await this.uploadFile(t)}this.checkDropHint()}})),s(this,"onChange",(e=>{const t=e.target.files||[],i=[],s=[];for(const e of t)this.acceptedFileTypes.isAccepted(e.name)?i.push(e):s.push(e);s&&this.handleInvalidFiles([...s]),i&&this.uploadFiles([...i]),this.renderer.clearInput()})),s(this,"handleInvalidFiles",(e=>{this.renderer.setErrorInvalidFiles(e)})),s(this,"handleClick",(e=>{const t=e.target,i=()=>{const e=t.getAttribute("data-index");if(!e)return;const i=parseInt(e,10);return this.getUploadByIndex(i)};if(t.classList.contains("dff-delete")&&!t.classList.contains("dff-disabled")){e.preventDefault();const t=i();t&&this.removeExistingUpload(t)}else if(t.classList.contains("dff-cancel")){e.preventDefault();const t=i();t&&this.handleCancel(t)}else if(t.classList.contains("dff-filename")){e.preventDefault();const t=i();"done"===t?.status&&this.callbacks.onClick&&this.callbacks.onClick({fileName:t.name,fieldName:this.fieldName,id:t.getId(),type:t.type})}})),s(this,"handleProgress",((e,t,i)=>{const s=(t/i*100).toFixed(2);this.renderer.updateProgress(e.uploadIndex,s);const{onProgress:o}=this.callbacks;o&&e instanceof Ht&&o(t,i,e)})),s(this,"handleError",((e,t)=>{this.renderer.setError(e.uploadIndex),e.status="error";const{onError:i}=this.callbacks;i&&e instanceof Ht&&i(t,e)})),s(this,"handleSuccess",(e=>{const{renderer:t}=this;this.updatePlaceholderInput(),t.clearInput(),t.setSuccess(e.uploadIndex,e.getSize()),e.status="done";const{onSuccess:i}=this.callbacks,s=this.renderer.findFileDiv(e.uploadIndex);this.emitEvent("uploadComplete",s,e),i&&"tus"===e.type&&i(e)})),this.callbacks=t,this.chunkSize=i,this.csrfToken=o,this.eventEmitter=n,this.fieldName=r,this.form=a,this.formId=l,this.multiple=u,this.prefix=h,this.retryDelays=m,this.s3UploadDir=g,this.supportDropArea=v&&!c.disabled,this.uploadUrl=_,this.acceptedFileTypes=new fe(c.accept),this.uploads=[],this.nextUploadIndex=0,this.renderer=new f({parent:d,input:c,skipRequired:x,translations:y});const b=this.renderer.container;v&&this.initDropArea(b,c.accept),p&&this.addInitialFiles(p),this.checkDropHint(),c.addEventListener("change",this.onChange),b.addEventListener("click",this.handleClick)}addInitialFiles(e){if(0===e.length)return;const{multiple:t,renderer:i}=this,s=e=>{const{size:t}=e,s="s3"===e.type&&e.original_name?e.original_name:e.name,o=i.addUploadedFile(s,this.nextUploadIndex,t),n=(e=>{let{csrfToken:t,initialFile:i,uploadIndex:s,uploadUrl:o}=e;switch(i.type){case"existing":return new ke(i,s);case"placeholder":return new we(i,s);case"s3":return new Ae(i,s);case"tus":return new Ce({csrfToken:t,initialFile:i,uploadUrl:o,uploadIndex:s})}})({csrfToken:this.csrfToken,initialFile:e,uploadIndex:this.nextUploadIndex,uploadUrl:this.uploadUrl});this.uploads.push(n),this.emitEvent("addUpload",o,n)};if(t)e.forEach((e=>{s(e),this.nextUploadIndex+=1}));else{const t=e[0];t&&s(t)}}async uploadFile(e){const{fieldName:t,formId:i,renderer:s,uploadUrl:o}=this,n=e.name,r=this.findUploadByName(n),a=r?r.uploadIndex:this.nextUploadIndex;r||(this.nextUploadIndex+=1),r&&await this.removeExistingUpload(r);const l=(()=>{const{csrfToken:s,s3UploadDir:n}=this;return null!=n?new Ee({csrfToken:s,endpoint:o,file:e,s3UploadDir:n,uploadIndex:a}):new Ht({chunkSize:this.chunkSize,csrfToken:this.csrfToken,fieldName:t,file:e,formId:i,retryDelays:this.retryDelays,uploadIndex:a,uploadUrl:o})})();l.onError=e=>this.handleError(l,e),l.onProgress=(e,t)=>this.handleProgress(l,e,t),l.onSuccess=()=>this.handleSuccess(l),l.start(),this.uploads.push(l);const p=s.addNewUpload(n,a);this.emitEvent("addUpload",p,l)}getUploadByIndex(e){return this.uploads.find((t=>t.uploadIndex===e))}findUploadByName(e){return this.uploads.find((t=>t.name===e))}async removeExistingUpload(e){const t=this.renderer.findFileDiv(e.uploadIndex);if(t&&this.emitEvent("removeUpload",t,e),"uploading"===e.status)this.renderer.disableCancel(e.uploadIndex),await e.abort();else if("done"===e.status){this.renderer.disableDelete(e.uploadIndex);try{await e.delete()}catch{return void this.renderer.setDeleteFailed(e.uploadIndex)}}this.removeUploadFromList(e),this.updatePlaceholderInput()}removeUploadFromList(e){this.renderer.deleteFile(e.uploadIndex);const t=this.uploads.indexOf(e);t>=0&&this.uploads.splice(t,1),this.checkDropHint();const{onDelete:i}=this.callbacks;i&&i(e)}async handleCancel(e){this.renderer.disableCancel(e.uploadIndex),await e.abort(),this.removeUploadFromList(e)}initDropArea(e,t){new ve({container:e,inputAccept:t,onUploadFiles:this.uploadFiles,renderer:this.renderer})}checkDropHint(){if(!this.supportDropArea)return;0===this.uploads.filter((e=>e)).length?this.renderer.renderDropHint():this.renderer.removeDropHint()}updatePlaceholderInput(){const e=r(this.form,a(this.fieldName,this.prefix),this.prefix);if(!e)return;const t=this.uploads.map((e=>e.getInitialFile()));e.value=JSON.stringify(t)}getMetaDataField(){return r(this.form,(e=this.fieldName,t=this.prefix,`${n(e,t)}-metadata`),this.prefix);var e,t}emitEvent(e,t,i){this.eventEmitter&&this.eventEmitter.emit(e,{element:t,fieldName:this.fieldName,fileName:i.name,metaDataField:this.getMetaDataField(),upload:i})}}const Dt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=()=>t&&t.prefix?t.prefix:null,s=t=>l(e,t,i()),o=s("upload_url"),n=s("form_id"),p=s("s3_upload_dir"),c=t.skipRequired||!1,u=i(),d=r(e,"csrfmiddlewaretoken",null)?.value;if(!d)throw Error("Csrf token not found");n&&o&&e.querySelectorAll(".dff-uploader").forEach((r=>{const l=r.querySelector(".dff-container");if(!l)return;const h=l.querySelector("input[type=file]");if(!h||!(e=>!t||!t.prefix||e.startsWith(`${t.prefix}-`))(h.name))return;const f=h.name,{multiple:m}=h,g=(e=>{const t=s(a(e,i()));return t?JSON.parse(t):[]})(f),x=l.getAttribute("data-translations"),v=x?JSON.parse(x):{},y=!(!1===t.supportDropArea);new Lt({callbacks:t.callbacks||{},chunkSize:t.chunkSize||2621440,csrfToken:d,eventEmitter:t.eventEmitter,fieldName:f,form:e,formId:n,s3UploadDir:p||null,initial:g,input:h,multiple:m,parent:l,prefix:u,retryDelays:t.retryDelays||null,skipRequired:c,supportDropArea:y,translations:v,uploadUrl:o})}))};window.autoInitFileForms=()=>{const t=window.initUploadFields;var i;(i=Array.from(document.querySelectorAll(".dff-uploader")).map(e),Array.from(new Set(i).values())).forEach(t)},window.initFormSet=(e,t)=>{let i;i="string"==typeof t?{prefix:t}:t;const s=i.prefix||"form",n=l(e,"TOTAL_FORMS",s);if(!n)return;const r=parseInt(n,10);for(let t=0;t<r;t+=1){const n=o(`${t}`,null);Dt(e,{...i,prefix:`${s}-${n}`})}},window.initUploadFields=Dt}();
//# sourceMappingURL=file_form.min.js.map
